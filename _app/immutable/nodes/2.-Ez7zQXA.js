var Dt=Object.defineProperty;var ot=i=>{throw TypeError(i)};var Nt=(i,t,e)=>t in i?Dt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var B=(i,t,e)=>Nt(i,typeof t!="symbol"?t+"":t,e),ct=(i,t,e)=>t.has(i)||ot("Cannot "+e);var n=(i,t,e)=>(ct(i,t,"read from private field"),e?e.call(i):t.get(i)),Y=(i,t,e)=>t.has(i)?ot("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),$=(i,t,e,s)=>(ct(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);import{t as _e,a as pe}from"../chunks/B413fvgw.js";import{s as dt,j as vt,m as Lt,o as tt,p as Ft,b as Ot,v as Je,h as j,w as Rt,z as Ut,P as A,af as Bt,a6 as Gt,a7 as ut,t as Ze,f as Ue,A as Wt,a8 as _t,d as bt,a9 as Vt,ar as Qe,F as mt,am as Ht,$ as ft,k as Yt,as as lt,at as Xt,D as $t,au as qt,e as Kt,av as nt,aw as Jt,r as Zt,ax as wt,ac as Qt,ay as ht,az as jt,aA as ei,aB as ti,a5 as ii,aC as si,aD as ai,a as Tt,ab as St,I as Fe,ap as ge,V as p,X as r,W as h,U as Be,a2 as Q,J as Oe,g as rt,R as li,u as qe,aE as ni}from"../chunks/DXjSzVAu.js";import{d as Ye,s as xt,a as ri}from"../chunks/CZth_J7-.js";import{p as We,b as le,a as V,i as Et}from"../chunks/BDzuGfd0.js";import{o as Ke}from"../chunks/BMF9-ZhM.js";let yt=!1;function kt(){yt||(yt=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var t;if(!i.defaultPrevented)for(const e of i.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function oi(i){var t=Lt,e=tt;dt(null),vt(null);try{return i()}finally{dt(t),vt(e)}}function zt(i,t,e,s=e){i.addEventListener(t,()=>oi(e));const a=i.__on_r;a?i.__on_r=()=>{a(),s(!0)}:i.__on_r=()=>s(!0),kt()}function ci(i,t){return t}function di(i,t,e,s){for(var a=[],l=t.length,v=0;v<l;v++)Xt(t[v].e,a,!0);var u=l>0&&a.length===0&&e!==null;if(u){var T=e.parentNode;$t(T),T.append(e),s.clear(),we(i,t[0].prev,t[l-1].next)}qt(a,()=>{for(var g=0;g<l;g++){var _=t[g];u||(s.delete(_.k),we(i,_.prev,_.next)),Kt(_.e,!u)}})}function it(i,t,e,s,a,l=null){var v=i,u={flags:t,items:new Map,first:null},T=(t&wt)!==0;if(T){var g=i;v=j?Je(Rt(g)):g.appendChild(Ft())}j&&Ut();var _=null,w=!1,o=Bt(()=>{var f=e();return Yt(f)?f:f==null?[]:mt(f)});Ot(()=>{var f=A(o),d=f.length;if(w&&d===0)return;w=d===0;let M=!1;if(j){var k=v.data===Gt;k!==(d===0)&&(v=ut(),Je(v),Ze(!1),M=!0)}if(j){for(var D=null,N,L=0;L<d;L++){if(Ue.nodeType===8&&Ue.data===Wt){v=Ue,M=!0,Ze(!1);break}var x=f[L],S=s(x,L);N=At(Ue,u,D,null,x,S,L,a,t,e),u.items.set(S,N),D=N}d>0&&Je(ut())}j||vi(f,u,v,a,t,s,e),l!==null&&(d===0?_?_t(_):_=bt(()=>l(v)):_!==null&&Vt(_,()=>{_=null})),M&&Ze(!0),A(o)}),j&&(v=Ue)}function vi(i,t,e,s,a,l,v){var H,ie,J,X;var u=(a&jt)!==0,T=(a&(nt|lt))!==0,g=i.length,_=t.items,w=t.first,o=w,f,d=null,M,k=[],D=[],N,L,x,S;if(u)for(S=0;S<g;S+=1)N=i[S],L=l(N,S),x=_.get(L),x!==void 0&&((H=x.a)==null||H.measure(),(M??(M=new Set)).add(x));for(S=0;S<g;S+=1){if(N=i[S],L=l(N,S),x=_.get(L),x===void 0){var K=o?o.e.nodes_start:e;d=At(K,t,d,d===null?t.first:d.next,N,L,S,s,a,v),_.set(L,d),k=[],D=[],o=d.next;continue}if(T&&ui(x,N,S,a),x.e.f&Qe&&(_t(x.e),u&&((ie=x.a)==null||ie.unfix(),(M??(M=new Set)).delete(x))),x!==o){if(f!==void 0&&f.has(x)){if(k.length<D.length){var ne=D[0],b;d=ne.prev;var E=k[0],C=k[k.length-1];for(b=0;b<k.length;b+=1)pt(k[b],ne,e);for(b=0;b<D.length;b+=1)f.delete(D[b]);we(t,E.prev,C.next),we(t,d,E),we(t,C,ne),o=ne,d=C,S-=1,k=[],D=[]}else f.delete(x),pt(x,o,e),we(t,x.prev,x.next),we(t,x,d===null?t.first:d.next),we(t,d,x),d=x;continue}for(k=[],D=[];o!==null&&o.k!==L;)o.e.f&Qe||(f??(f=new Set)).add(o),D.push(o),o=o.next;if(o===null)continue;x=o}k.push(x),d=x,o=x.next}if(o!==null||f!==void 0){for(var I=f===void 0?[]:mt(f);o!==null;)o.e.f&Qe||I.push(o),o=o.next;var te=I.length;if(te>0){var re=a&wt&&g===0?e:null;if(u){for(S=0;S<te;S+=1)(J=I[S].a)==null||J.measure();for(S=0;S<te;S+=1)(X=I[S].a)==null||X.fix()}di(t,I,re,_)}}u&&Qt(()=>{var Z;if(M!==void 0)for(x of M)(Z=x.a)==null||Z.apply()}),tt.first=t.first&&t.first.e,tt.last=d&&d.e}function ui(i,t,e,s){s&nt&&ht(i.v,t),s&lt?ht(i.i,e):i.i=e}function At(i,t,e,s,a,l,v,u,T,g){var _=(T&nt)!==0,w=(T&Jt)===0,o=_?w?Ht(a):ft(a):a,f=T&lt?ft(v):v,d={i:f,v:o,k:l,a:null,e:null,prev:e,next:s};try{return d.e=bt(()=>u(i,o,f,g),j),d.e.prev=e&&e.e,d.e.next=s&&s.e,e===null?t.first=d:(e.next=d,e.e.next=d.e),s!==null&&(s.prev=d,s.e.prev=d.e),d}finally{}}function pt(i,t,e){for(var s=i.next?i.next.e.nodes_start:e,a=t?t.e.nodes_start:e,l=i.e.nodes_start;l!==s;){var v=Zt(l);a.before(l),l=v}}function we(i,t,e){t===null?i.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function q(i){if(j){var t=!1,e=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var s=i.value;Ve(i,"value",null),i.value=s}if(i.hasAttribute("checked")){var a=i.checked;Ve(i,"checked",null),i.checked=a}}};i.__on_r=e,ei(e),kt()}}function Ve(i,t,e,s){var a=i.__attributes??(i.__attributes={});j&&(a[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||a[t]!==(a[t]=e)&&(t==="style"&&"__styles"in i&&(i.__styles={}),t==="loading"&&(i[ti]=e),e==null?i.removeAttribute(t):typeof e!="string"&&fi(i).includes(t)?i[t]=e:i.setAttribute(t,e))}var gt=new Map;function fi(i){var t=gt.get(i.nodeName);if(t)return t;gt.set(i.nodeName,t=[]);for(var e,s=i,a=Element.prototype;a!==s;){e=si(s);for(var l in e)e[l].set&&t.push(l);s=ii(s)}return t}function hi(i,t,e){var s=i.__className,a=xi(t);j&&i.className===a?i.__className=a:(s!==a||j&&i.className!==a)&&(t==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function xi(i,t){return(i??"")+""}function st(i,t,e){if(e){if(i.classList.contains(t))return;i.classList.add(t)}else{if(!i.classList.contains(t))return;i.classList.remove(t)}}function yi(i,t,e,s){var a=i.__styles??(i.__styles={});a[t]!==e&&(a[t]=e,e==null?i.style.removeProperty(t):i.style.setProperty(t,e,""))}function oe(i,t,e=t){var s=ai();zt(i,"input",a=>{var l=a?i.defaultValue:i.value;if(l=je(i)?et(l):l,e(l),s&&l!==(l=t())){var v=i.selectionStart,u=i.selectionEnd;i.value=l??"",u!==null&&(i.selectionStart=v,i.selectionEnd=Math.min(u,i.value.length))}}),(j&&i.defaultValue!==i.value||Tt(t)==null&&i.value)&&e(je(i)?et(i.value):i.value),St(()=>{var a=t();je(i)&&a===et(i.value)||i.type==="date"&&!a&&!i.value||a!==i.value&&(i.value=a??"")})}function at(i,t,e=t){zt(i,"change",s=>{var a=s?i.defaultChecked:i.checked;e(a)}),(j&&i.defaultChecked!==i.checked||Tt(t)==null)&&e(i.checked),St(()=>{var s=t();i.checked=!!s})}function je(i){var t=i.type;return t==="number"||t==="range"}function et(i){return i===""?null:+i}var ae=(i=>(i[i.UNSET=0]="UNSET",i[i.SAME=1]="SAME",i[i.DIFFERENT=2]="DIFFERENT",i))(ae||{}),F,ze,De,He,Ae,ye,Te,Ne;const Ge=class Ge{constructor(t,e={},s=t){Y(this,F);Y(this,ze);Y(this,De);Y(this,He);Y(this,Ae);Y(this,ye,{x:0,y:0});Y(this,Te,{x:0,y:0});Y(this,Ne);if(Ge.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");$(this,De,t),$(this,F,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...e}),$(this,ze,s),this.loadImg()}async loadImg(){if(n(this,Ae))return n(this,Ae);const t=document.createElement("img");return $(this,Ae,new Promise(e=>{t.addEventListener("load",()=>{$(this,ye,{x:t.naturalWidth,y:t.naturalHeight}),e()})})),t.src=n(this,De),$(this,He,t),n(this,Ae)}get img(){return n(this,He)}get src(){return n(this,De)}get id(){return n(this,ze)}get dimensions(){return structuredClone(n(this,ye))}get tileAmount(){return structuredClone(n(this,Te))}get settings(){return n(this,F)}set settings(t){$(this,F,t)}getTile(t){}getTilePosition(t){let e=typeof t=="number"?t:t.indexInAtlas;return{x:n(this,F).startOffset.x+(n(this,F).tileSize.x+n(this,F).tileGap.x)*(e%n(this,Te).x),y:n(this,F).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(e/n(this,Te).x),w:n(this,F).tileSize.x,h:n(this,F).tileSize.y}}createTiles(){if(n(this,F).tileSize.x<1||n(this,F).tileSize.y<1)return[];let t=0,e=0;const s=[];let a=0,l=0;for(let v=n(this,F).startOffset.y;v<n(this,ye).y&&v+n(this,F).tileSize.y<=n(this,ye).y;v+=n(this,F).tileSize.y+n(this,F).tileGap.y){a=0;for(let u=n(this,F).startOffset.x;u<n(this,ye).x&&u+n(this,F).tileSize.x<=n(this,ye).x;u+=n(this,F).tileSize.x+n(this,F).tileGap.x)s.push({type:"basic",id:t++,atlasId:n(this,ze),indexInAtlas:e++,name:`${n(this,ze)}_${e}`}),a++;l++}return n(this,Te).x=a,n(this,Te).y=l,$(this,Ne,[...s]),s}getTiles(){return n(this,Ne)||this.createTiles(),n(this,Ne)}};F=new WeakMap,ze=new WeakMap,De=new WeakMap,He=new WeakMap,Ae=new WeakMap,ye=new WeakMap,Te=new WeakMap,Ne=new WeakMap,B(Ge,"existingIDs",new Set),B(Ge,"selectedTiles",[]);let R=Ge;var Ie,Ce,ue;class pi{constructor(t,e){Y(this,Ie,[]);Y(this,Ce,{x:20,y:20});Y(this,ue,{x:64,y:64});this.mapSize=t,this.tileSize=e}get mapSize(){return n(this,Ce)}set mapSize(t){$(this,Ce,t)}get tileSize(){return n(this,ue)}set tileSize(t){$(this,ue,t)}setTile(t,e){n(this,Ie)[e.y]||(n(this,Ie)[e.y]=[]),n(this,Ie)[e.y][e.x]=t}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<n(this,Ce).y;e++)for(let s=0;s<n(this,Ce).x;s++){const a=this.getTile({x:s,y:e});if(!a)continue;const l={x:n(this,ue).x*s,y:n(this,ue).y*e};a.type==="basic"?ee.drawTile(a,t,l,n(this,ue)):a.type==="rule"&&(ee.drawTile(a.default,t,l,n(this,ue)),this.drawRuleOverlay(t,l,n(this,ue)))}}getTile(t){var e;return(e=n(this,Ie)[t.y])==null?void 0:e[t.x]}drawRuleOverlay(t,e,s){t.strokeStyle="white",t.fillStyle="black",t.font=`bold ${s.y*.8}px sans-serif`,t.strokeText("⚙",e.x+1,e.y+s.y-1,s.x),t.fillText("⚙",e.x+1,e.y+s.y-1,s.x)}}Ie=new WeakMap,Ce=new WeakMap,ue=new WeakMap;var Se,Me,Le;class gi{constructor(t,e,s){Y(this,Se);Y(this,Me);Y(this,Le);$(this,Se,t),$(this,Me,e),$(this,Le,s.map(a=>typeof a=="number"?ee.getTile(a):a))}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<n(this,Se).x;e++)for(let s=0;s<n(this,Se).y;s++){const a=this.getTile(e,s);a&&ee.drawTile(a,t,{x:n(this,Me).x*e,y:n(this,Me).y*e},n(this,Me))}}getTile(t,e){return n(this,Le)[e*n(this,Se).x+t]}setTile(t,e,s){n(this,Le)[e*n(this,Se).x+t]=s}}Se=new WeakMap,Me=new WeakMap,Le=new WeakMap;const G=class G{constructor(){if(G.Instance)return G.Instance;G.renderMethod.set("basic",G.drawBasicTile),G.renderMethod.set("rule",G.drawRuleTile)}static setAtlantes(t){this.atlantes.clear();for(const e of t)this.atlantes.set(e.id,e);this.recalculateTileIds()}static recalculateTileIds(){console.log("recalc");let t=1;const e=new Map;for(let s of this.atlantes.values())s.getTiles().forEach(l=>{l.id=t++,e.set(l.id,l)});for(let s of this.tileIndex.values())s.type!=="basic"&&(s.id=e.size+1,e.set(s.id,s));this.tileIndex=e}static addTile(t){this.tileIndex.set(t.id,t)}static newTile(t,e=""){console.log("new tile");let s=this.tileIndex.size;for(;this.tileIndex.has(s);)s++;let a={type:t,default:void 0,id:s,name:e,rules:[]};return this.addTile(a),a}static getTile(t){return this.tileIndex.get(t)}static drawTile(t,e,s,a){var l;if(typeof t=="number"&&(t=this.tileIndex.get(t)),!!t){if(!G.renderMethod.has(t.type))throw new Error(`Cannot draw tile type "${t.type}": No known renderer.`);(l=G.renderMethod.get(t.type))==null||l(t,e,s,a)}}static drawRuleTile(t,e,s,a){}};B(G,"renderMethod",new Map),B(G,"atlantes",new Map),B(G,"tileIndex",new Map),B(G,"drawBasicTile",(t,e,s,a)=>{const l=G.atlantes.get(t.atlasId);if(!l){e.fillStyle="red",e.textAlign="center",e.font=`bold ${a.y*.8}px sans-serif`,e.fillText("!",s.x+.5*a.x,s.y+a.y*.8,a.x),console.error(`Atlas "${t.atlasId}" not found.`);return}let{x:v,y:u,w:T,h:g}=l.getTilePosition(t.indexInAtlas);e.drawImage(l.img,v,u,T,g,s.x,s.y,a.x,a.y)}),B(G,"Instance",new G);let ee=G;class It extends EventTarget{constructor(e){super();B(this,"canvas");B(this,"ctx");B(this,"translation",{x:0,y:0});B(this,"scale",1);B(this,"scaleSettings",{factor:2,min:1/16,max:16});B(this,"syncedCtx",new Set);B(this,"pointerdown",e=>{switch(e.button){}this.dispatchEventFromEvent(e),e.preventDefault()});B(this,"pointermove",e=>{e.preventDefault();const s=this.getButtonsFromEvent(e);s.includes(0),s.includes(1),s.includes(2)&&(this.translation.x+=e.movementX,this.translation.y+=e.movementY,this.draw()),this.dispatchEventFromEvent(e)});B(this,"pointerup",e=>{switch(this.dispatchEventFromEvent(e),e.button){}e.preventDefault()});B(this,"zoom",e=>{e.preventDefault();const s=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!1),a=-Math.sign(e.deltaY),l=this.scale,v=Math.min(this.scaleSettings.max,Math.max(this.scaleSettings.min,this.scale*Math.pow(this.scaleSettings.factor,a))),u=v/l;this.translation.x=s.x+(this.translation.x-s.x)*u,this.translation.y=s.y+(this.translation.y-s.y)*u,this.scale=v,this.draw()});this.canvas=e,this.ctx=e.getContext("2d"),this.installListeners();const s=e.getBoundingClientRect();e.width=s.width,e.height=s.height,this.syncedCtx.add(this.ctx)}installListeners(){this.canvas.addEventListener("pointerdown",this.pointerdown),this.canvas.addEventListener("pointermove",this.pointermove),this.canvas.addEventListener("pointerup",this.pointerup),this.canvas.addEventListener("wheel",this.zoom),this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}getButtonsFromEvent(e){const s=[];for(let a=0;a<5;a++)e.buttons&1<<a&&s.push(a);return s}dispatchEventFromEvent(e){const s=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!0);this.dispatchEvent(new CustomEvent(e.type,{detail:{pos:s,event:e}}))}canvasPosFromMousePos(e,s){const a=this.canvas.getBoundingClientRect(),l={x:e.x-a.left,y:e.y-a.top};return s&&(l.x=(l.x-this.translation.x)/this.scale,l.y=(l.y-this.translation.y)/this.scale),l}draw(){for(let e of this.syncedCtx.values())e.clearRect(0,0,e.canvas.width,e.canvas.height),e.reset(),e.translate(this.translation.x,this.translation.y),e.scale(this.scale,this.scale);this.dispatchEvent(new CustomEvent("draw"))}reset(){this.scale=1,this.translation.x=0,this.translation.y=0,this.draw()}addCtxToSync(e){this.syncedCtx.add(e)}}var _i=(i,t,e)=>{t.remove(e())},bi=_e('<fieldset class="atlas-display svelte-n7a098"><img class="img-preview svelte-n7a098" alt=""> <div class="canvas-wrapper svelte-n7a098"><canvas></canvas> <canvas class="canvas-overlay svelte-n7a098"></canvas></div> <div class="settings-wrapper svelte-n7a098"><fieldset class="svelte-n7a098"><legend>Tile Size</legend> <label>width <input type="number" min="0" class="svelte-n7a098"></label> <label>height <input type="number" min="0" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Tile Gap</legend> <label>width <input type="number" class="svelte-n7a098"></label> <label>height <input type="number" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Offset</legend> <label>width <input type="number" class="svelte-n7a098"></label> <label>height <input type="number" width="5" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset> <fieldset class="svelte-n7a098"><legend>Danger Zone</legend> <button>Remove</button></fieldset></div></fieldset>');function mi(i,t){Fe(t,!0);let e=We(t,"atlas",15),s,a,l,v,u,T,g,_=[],w=new Set,o,f=ge(!1),d=ge(!0);Ke(()=>{v.addEventListener("click",()=>{t.active||(t.activate(e()),M())}),g=new It(l),g.addEventListener("draw",k),g.addEventListener("pointermove",D),g.addEventListener("pointerup",L),l.addEventListener("pointerleave",N),u=l.getContext("2d"),T=a.getContext("2d"),g.addCtxToSync(T),ne(),g.draw()});function M(){if(w.size==0)return R.selectedTiles=[],g.draw();const y=e().tileAmount,z={x:1/0,y:1/0},W={x:-1/0,y:-1/0};w.forEach(U=>{const O={x:U.indexInAtlas%y.x,y:Math.floor(U.indexInAtlas/y.x)};z.x>O.x&&(z.x=O.x),z.y>O.y&&(z.y=O.y),W.x<O.x&&(W.x=O.x),W.y<O.y&&(W.y=O.y)}),R.selectedTiles=Array.from({length:W.y-z.y+1},()=>[]),w.forEach(U=>{const O={x:U.indexInAtlas%y.x-z.x,y:Math.floor(U.indexInAtlas/y.x)-z.y};R.selectedTiles[O.y][O.x]=U}),g.draw()}function k(){T.imageSmoothingEnabled=!1,T.drawImage(e().img,0,0),T.lineWidth=1,T.strokeStyle="rgba(0, 0, 0, 0.5)",T.textAlign="right",_=e().getTiles();for(let y of _){let{x:z,y:W,w:U,h:O}=e().getTilePosition(y);A(d)&&T.strokeRect(z,W,U,O),A(f)&&T.fillText(y.id.toString(),z+U-1,W+O-1,U)}x()}function D(y){const z=S(y.detail.pos.x,y.detail.pos.y);if(!z)return N();o=z,g.draw()}function N(){o=void 0,g.draw()}function L(y){if(y.detail.event.button!==0)return;const z=S(y.detail.pos.x,y.detail.pos.y);if(!z)return w.clear(),M();y.detail.event.ctrlKey?w.has(z)?w.delete(z):w.add(z):w.has(z)&&w.size===1?w.clear():(w.clear(),w.add(z)),M()}function x(){if(o){u.fillStyle="rgba(255, 255, 255, 0.5)";let{x:y,y:z,w:W,h:U}=e().getTilePosition(o);u.fillRect(y,z,W,U)}for(let y of w.values()){u.strokeStyle="rgba(255, 0, 0, 1)",u.fillStyle="rgba(255, 0, 0, 0.25)",u.lineWidth=1;let{x:z,y:W,w:U,h:O}=e().getTilePosition(y);u.fillRect(z,W,U,O),u.strokeRect(z,W,U,O)}}function S(y,z){for(let W of _){let{x:U,y:O,w:Mt,h:Pt}=e().getTilePosition(W);if(y>U&&y<U+Mt&&z>O&&z<O+Pt)return W}}function K(){e().createTiles(),g.draw()}function ne(){a.width=s.clientWidth,a.height=s.clientHeight,l.width=s.clientWidth,l.height=s.clientHeight}function b(){ne(),g.reset()}var E=bi(),C=p(E),I=r(C,2),te=p(I);le(te,y=>a=y,()=>a);var re=r(te,2);le(re,y=>l=y,()=>l),h(I),le(I,y=>s=y,()=>s);var H=r(I,2),ie=p(H),J=r(p(ie),2),X=r(p(J));q(X),X.__input=K,h(J);var Z=r(J,2),fe=r(p(Z));q(fe),fe.__input=K,h(Z),h(ie);var ce=r(ie,2),he=r(p(ce),2),be=r(p(he));q(be),be.__input=K,h(he);var xe=r(he,2),de=r(p(xe));q(de),de.__input=K,h(xe),h(ce);var Ee=r(ce,2),se=r(p(Ee),2),ke=r(p(se));q(ke),ke.__input=K,h(se);var ve=r(se,2),me=r(p(ve));q(me),me.__input=K,h(ve),h(Ee);var Pe=r(Ee,2),Re=r(p(Pe),2),Xe=r(p(Re));q(Xe),h(Re);var c=r(Re,2),m=r(p(c));q(m),h(c);var P=r(c,2);P.__click=b,h(Pe);var $e=r(Pe,2),Ct=r(p($e),2);Ct.__click=[_i,t,e],h($e),h(H),h(E),le(E,y=>v=y,()=>v),Be(()=>{st(E,"active",t.active),Ve(C,"src",e().src)}),oe(X,()=>e().settings.tileSize.x,y=>e(e().settings.tileSize.x=y,!0)),oe(fe,()=>e().settings.tileSize.y,y=>e(e().settings.tileSize.y=y,!0)),oe(be,()=>e().settings.tileGap.x,y=>e(e().settings.tileGap.x=y,!0)),oe(de,()=>e().settings.tileGap.y,y=>e(e().settings.tileGap.y=y,!0)),oe(ke,()=>e().settings.startOffset.x,y=>e(e().settings.startOffset.x=y,!0)),oe(me,()=>e().settings.startOffset.y,y=>e(e().settings.startOffset.y=y,!0)),at(Xe,()=>A(f),y=>Q(f,y)),at(m,()=>A(d),y=>Q(d,y)),pe(i,E),Oe()}Ye(["input","click"]);var wi=_e('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function Ti(i,t){Fe(t,!0);let e,s=We(t,"atlantes",27,()=>V([])),a=We(t,"activeAtlas",15);async function l(o){if(e.files)for(let f of e.files){let d=await v(f),M=V({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const k=new R(d,M,f.name);await k.loadImg(),s().push(k),a(k)}}async function v(o){return new Promise(f=>{const d=new FileReader;d.onload=()=>f(d.result),d.readAsDataURL(o)})}function u(o){a(o)}function T(o){o==a()&&(R.selectedTiles=[]);let f=s().indexOf(o);if(!(f<0)){for(s().splice(f,1);f>=s().length;)f--;f<0||a(s()[f])}}var g=wi(),_=rt(g);_.__change=l,le(_,o=>e=o,()=>e);var w=r(_,2);it(w,20,s,o=>o,(o,f)=>{const d=li(()=>a()==f);mi(o,{get atlas(){return f},activate:u,remove:T,get active(){return A(d)}})}),h(w),pe(i,g),Oe()}Ye(["change"]);function Si(i,t){const e=V({neighborFilter:[ae.UNSET,ae.UNSET,ae.UNSET,ae.UNSET,ae.UNSET,ae.UNSET,ae.UNSET,ae.UNSET]});t().rules.push(e)}var Ei=(i,t)=>{t()},ki=(i,t,e)=>{t(e,-1)},zi=(i,t,e)=>{t(e,1)},Ai=(i,t,e)=>{t(e)},Ii=_e("<button></button>"),Ci=_e('<div class="tile-rule svelte-12k3xl0"><div class="tile-rule-order svelte-12k3xl0"><button>^</button> <button>v</button></div> <div class="tile-rule-data"><div class="tile-rule-image svelte-12k3xl0"></div> <button>set tile</button></div> <div class="tile-neighbors svelte-12k3xl0"></div></div>'),Mi=_e('<button>set tile</button> <div class="tile-rules"></div> <button>Add Rule</button>',1),Pi=_e('<div class="tile-info svelte-12k3xl0"><div class="tile-base-info svelte-12k3xl0"><span class="tile-id svelte-12k3xl0"> </span> <span class="tile-type svelte-12k3xl0"> </span> <span class="tile-name svelte-12k3xl0">name: <input type="text"></span> <div class="tile-preview svelte-12k3xl0"><canvas width="64" height="64"></canvas></div></div> <!></div>');function Di(i,t){Fe(t,!0);let e=We(t,"tile",15),s,a;Ke(()=>{a=s.getContext("2d"),a.imageSmoothingEnabled=!1,a.clearRect(0,0,s.width,s.height)}),qe(()=>{e().type==="basic"?l(ee.drawTile,e()):e().type==="rule"&&l(ee.drawTile,e().default)});function l(b,E){a.clearRect(0,0,s.width,s.height);const C={x:0,y:0},I={x:s.width,y:s.height};b(E,a,C,I)}function v(b){return b===ae.SAME?"same":b===ae.DIFFERENT?"different":"none"}function u(b,E){b[E]=(b[E]+1)%Object.keys(ae).filter(C=>isNaN(Number(C))).length}function T(b,E){if(e().type!=="rule")return;let C=e().rules.indexOf(b);C<0||e().rules.splice(C+E,0,...e().rules.splice(C,1))}function g(b){if(!b)return"";let E=ee.atlantes.get(b.atlasId);if(!E)return"";let C=E.getTilePosition(b.indexInAtlas),I={x:50/E.settings.tileSize.x,y:50/E.settings.tileSize.y};return`background-image: url(${E.src}); background-position: -${C.x*I.x}px -${C.y*I.y}px; background-size: ${E.dimensions.x*I.x}px ${E.dimensions.y*I.y}px`}function _(b){if(R.selectedTiles.length<=0)return;let E=R.selectedTiles[0][0];E&&(b.tile=E)}function w(){if(e().type!=="rule"||R.selectedTiles.length<=0)return;let b=R.selectedTiles[0][0];b&&(e(e().default=b,!0),l(ee.drawTile,e().default))}var o=Pi(),f=p(o),d=p(f),M=p(d);h(d);var k=r(d,2),D=p(k);h(k);var N=r(k,2),L=r(p(N));q(L),h(N);var x=r(N,2),S=p(x);le(S,b=>s=b,()=>s),h(x),h(f);var K=r(f,2);{var ne=b=>{var E=Mi(),C=rt(E);C.__click=[Ei,w];var I=r(C,2);it(I,22,()=>e().rules,re=>re,(re,H,ie)=>{var J=Ci(),X=p(J),Z=p(X);Z.__click=[ki,T,H];var fe=r(Z,2);fe.__click=[zi,T,H],h(X);var ce=r(X,2),he=p(ce),be=r(he,2);be.__click=[Ai,_,H],h(ce);var xe=r(ce,2);it(xe,21,()=>H.neighborFilter,ci,(de,Ee,se,ke)=>{var ve=Ii();ve.__click=()=>u(H.neighborFilter,se),Ve(ve,"aria-label",`change neighbor rule ${se??""}`),Be(me=>{hi(ve,`tile-rule-button ${me??""} svelte-12k3xl0`),yi(ve,"grid-area","b"+se)},[()=>v(A(Ee))]),pe(de,ve)}),h(xe),h(J),Be(de=>{Z.disabled=A(ie)===0,fe.disabled=A(ie)===e().rules.length-1,Ve(he,"style",de)},[()=>g(H.tile)]),pe(re,J)}),h(I);var te=r(I,2);te.__click=[Si,e],pe(b,E)};Et(K,b=>{e().type==="rule"&&b(ne)})}h(o),Be(()=>{xt(M,`id: ${e().id??""}`),xt(D,`type: ${e().type??""}`)}),oe(L,()=>e().name,b=>e(e().name=b,!0)),pe(i,o),Oe()}Ye(["click"]);var Ni=_e('<div id="sheet-wrapper" class="svelte-cnh3hz"><fieldset class="svelte-cnh3hz"><fieldset class="svelte-cnh3hz"><legend>Tile Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset class="svelte-cnh3hz"><legend>Sheet Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset class="svelte-cnh3hz"><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-cnh3hz"><canvas id="sheet-canvas" class="svelte-cnh3hz"></canvas> <canvas id="overlay-canvas" class="svelte-cnh3hz"></canvas></div> <div id="tile-info-wrapper" class="svelte-cnh3hz"><div id="tile-info" class="svelte-cnh3hz"><!></div></div></div>');function Li(i,t){Fe(t,!0);let e=V({x:20,y:20}),s=V({x:16,y:16}),a=We(t,"sheet",27,()=>V(new pi(e,s))),l,v,u,T,g,_,w=ge(void 0),o=ge(void 0),f=ge(!0),d=ge(V({x:0,y:0})),M=!1,k=!1;Ke(()=>{_=new It(v),_.addEventListener("draw",K),_.addEventListener("pointerdown",D),_.addEventListener("pointermove",N),_.addEventListener("pointerup",L),T=v.getContext("2d"),b(),g=u.getContext("2d"),_.addCtxToSync(g),K()});function D(c){if(c.detail.event.button===0)M=!0;else if(c.detail.event.button===2){k=!0;const m=S(c.detail.pos);m&&a().setTile(void 0,m)}}function N(c){if(Q(d,V(c.detail.pos)),k){const m=S(c.detail.pos);m&&a().setTile(void 0,m)}M&&x(),_.draw()}function L(c){c.detail.event.button===0?(M=!1,x()):c.detail.event.button===2&&(k=!1),_.draw()}function x(){const c=S(A(d));if(!c){Q(w,void 0);return}if(R.selectedTiles.length>0)for(let m=0;m<R.selectedTiles.length;m++)for(let P=0;P<R.selectedTiles[m].length;P++)R.selectedTiles[m][P]&&(c.x+P>=a().mapSize.x||c.y+m>=a().mapSize.y||a().setTile(R.selectedTiles[m][P],{x:c.x+P,y:c.y+m}));else{let m=a().getTile(c);if(m)Q(w,V(m));else{let P=V(ee.newTile("rule"));a().setTile(P,c),Q(w,V(P))}Q(o,V(c))}}function S(c){const m={x:Math.floor(c.x/s.x),y:Math.floor(c.y/s.y)};if(!(m.x<0||m.y<0)&&!(m.x>=a().mapSize.x||m.y>=a().mapSize.y))return m}function K(){a().render(T),T.strokeStyle="rgba(0, 0, 0, 1)",T.lineWidth=1;const c=new Path2D;for(let m=0;m<e.y;m++)for(let P=0;P<e.x;P++)c.moveTo(P*s.x,m*s.y+s.y),c.lineTo(P*s.x,m*s.y),c.lineTo(P*s.x+s.x,m*s.y);c.moveTo(0,e.y*s.y),c.lineTo(e.x*s.x,e.y*s.y),c.lineTo(e.x*s.x,0),A(f)&&T.stroke(c),ne()}function ne(){const c=S(A(d));if(c){g.imageSmoothingEnabled=!1;for(let m=0;m<R.selectedTiles.length;m++)for(let P=0;P<R.selectedTiles[m].length;P++){if(c.x+P>=a().mapSize.x||c.y+m>=a().mapSize.y)continue;const $e={x:(c.x+P)*a().tileSize.x,y:(c.y+m)*a().tileSize.y};ee.drawTile(R.selectedTiles[m][P],g,$e,s)}}A(w)&&A(o)&&(g.fillStyle="rgba(255, 0, 0, 0.5)",g.fillRect(A(o).x*a().tileSize.x,A(o).y*a().tileSize.y,a().tileSize.x,a().tileSize.y))}function b(){v.width=l.clientWidth,u.width=l.clientWidth,v.height=l.clientHeight,u.height=l.clientHeight}function E(){b(),_.reset()}var C=Ni(),I=p(C),te=p(I),re=r(p(te),2),H=r(p(re));q(H),h(re);var ie=r(re,2),J=r(p(ie));q(J),h(ie),h(te);var X=r(te,2),Z=r(p(X),2),fe=r(p(Z));q(fe),h(Z);var ce=r(Z,2),he=r(p(ce));q(he),h(ce),h(X);var be=r(X,2),xe=r(p(be),2),de=r(p(xe));q(de),h(xe);var Ee=r(xe,2);Ee.__click=E,h(be),h(I);var se=r(I,2),ke=p(se);le(ke,c=>v=c,()=>v);var ve=r(ke,2);le(ve,c=>u=c,()=>u),h(se),le(se,c=>l=c,()=>l);var me=r(se,2),Pe=p(me),Re=p(Pe);{var Xe=c=>{Di(c,{get tile(){return A(w)},set tile(m){Q(w,V(m))}})};Et(Re,c=>{A(w)&&c(Xe)})}h(Pe),h(me),h(C),oe(H,()=>s.x,c=>s.x=c),oe(J,()=>s.y,c=>s.y=c),oe(fe,()=>e.x,c=>e.x=c),oe(he,()=>e.y,c=>e.y=c),at(de,()=>A(f),c=>Q(f,c)),pe(i,C),Oe()}Ye(["click"]);var Fi=_e('<button>update</button> <canvas width="500" height="500"></canvas>',1);function Oi(i,t){Fe(t,!0);let e,s;Ke(()=>{s=e.getContext("2d")}),qe(()=>{t.map.render(s)});function a(){t.map.render(s)}var l=Fi(),v=rt(l);v.__click=a;var u=r(v,2);le(u,T=>e=T,()=>e),pe(i,l),Oe()}Ye(["click"]);var Ri=_e('<div id="outer-wrapper" class="svelte-1ctsb4x"><h1 class="svelte-1ctsb4x"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1ctsb4x"><div class="tab svelte-1ctsb4x" id="tab-atlas"><h2 class="svelte-1ctsb4x">Tile Atlas</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab shown svelte-1ctsb4x" id="tab-sheet"><h2 class="svelte-1ctsb4x">Tile Sheet</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab svelte-1ctsb4x" id="tab-map"><h2 class="svelte-1ctsb4x">Tile Map</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div></div></div>');function Yi(i,t){Fe(t,!0);let e=ge(V([])),s,a=ge(!0),l,v=ge(void 0),u;qe(()=>{s.addEventListener("pointerup",()=>{Q(a,!0)}),l.addEventListener("pointerup",()=>{Q(a,!1),R.selectedTiles=[]})});let T=new gi({x:5,y:5},{x:64,y:64},[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);qe(()=>{ee.setAtlantes(A(e))});var g=Ri();ri(x=>{ni.title="FUDGE Tilemap Editor"});var _=r(p(g),2),w=p(_),o=r(p(w),2),f=p(o);Ti(f,{get atlantes(){return A(e)},set atlantes(x){Q(e,V(x))},get activeAtlas(){return A(v)},set activeAtlas(x){Q(v,V(x))}}),h(o),h(w),le(w,x=>s=x,()=>s);var d=r(w,2),M=r(p(d),2),k=p(M);Li(k,{get sheet(){return u},get selectedAtlas(){return A(v)}}),h(M),h(d);var D=r(d,2),N=r(p(D),2),L=p(N);Oi(L,{map:T}),h(N),h(D),le(D,x=>l=x,()=>l),h(_),h(g),Be(()=>{st(w,"shown",A(a)),st(D,"shown",!A(a))}),pe(i,g),Oe()}export{Yi as component};
