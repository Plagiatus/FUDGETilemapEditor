var Se=Object.defineProperty;var ne=a=>{throw TypeError(a)};var Ee=(a,e,t)=>e in a?Se(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var le=(a,e,t)=>Ee(a,typeof e!="symbol"?e+"":e,t),fe=(a,e,t)=>e.has(a)||ne("Cannot "+t);var l=(a,e,t)=>(fe(a,e,"read from private field"),t?t.call(a):e.get(a)),z=(a,e,t)=>e.has(a)?ne("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),k=(a,e,t,r)=>(fe(a,e,"write to private field"),r?r.call(a,t):e.set(a,t),t);import{t as te,b as ae}from"../chunks/BRocQdD-.js";import{s as ue,a as oe,b as Te,c as j,D as ze,y as E,l as ke,N as X,a1 as Ge,aj as Oe,ak as ve,k as de,j as J,m as q,n as De,al as ye,v as pe,am as Ne,aq as Q,r as me,ar as Re,a4 as Le,L as he,as as Me,at as Ce,q as He,au as Pe,G as Ve,av as qe,aw as Ye,f as We,i as Be,ax as Ue,ay as Xe,R as Fe,az as Ke,aA as Je,C as Qe,V as Ze,w as re,A as $e,ag as I,ai as m,ah as A,af as je,z as se,I as xe,ao as et,O as tt}from"../chunks/Ce_LYVoD.js";import{p as be,b as we,a as Y}from"../chunks/FZ3rsrI9.js";import{o as at}from"../chunks/CDeefaM5.js";import{d as rt}from"../chunks/DT9xDJXp.js";let ce=!1;function Ie(){ce||(ce=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function st(a){var e=Te,t=j;ue(null),oe(null);try{return a()}finally{ue(e),oe(t)}}function it(a,e,t,r=t){a.addEventListener(e,()=>st(t));const s=a.__on_r;s?a.__on_r=()=>{s(),r(!0)}:a.__on_r=()=>r(!0),Ie()}function nt(a,e){return e}function lt(a,e,t,r){for(var s=[],n=e.length,f=0;f<n;f++)Ce(e[f].e,s,!0);var h=n>0&&s.length===0&&t!==null;if(h){var g=t.parentNode;He(g),g.append(t),r.clear(),G(a,e[0].prev,e[n-1].next)}Pe(s,()=>{for(var y=0;y<n;y++){var i=e[y];h||(r.delete(i.k),G(a,i.prev,i.next)),Ve(i.e,!h)}})}function ft(a,e,t,r,s,n=null){var f=a,h={flags:e,items:new Map,first:null};E&&ke();var g=null,y=!1,i=Ge(()=>{var v=t();return Be(v)?v:v==null?[]:me(v)});ze(()=>{var v=X(i),u=v.length;if(y&&u===0)return;y=u===0;let c=!1;if(E){var _=f.data===Oe;_!==(u===0)&&(f=ve(),de(f),J(!1),c=!0)}if(E){for(var w=null,b,d=0;d<u;d++){if(q.nodeType===8&&q.data===De){f=q,c=!0,J(!1);break}var x=v[d],O=r(x,d);b=Ae(q,h,w,null,x,O,d,s,e,t),h.items.set(O,b),w=b}u>0&&de(ve())}E||ut(v,h,f,s,e,r,t),n!==null&&(u===0?g?ye(g):g=pe(()=>n(f)):g!==null&&Ne(g,()=>{g=null})),c&&J(!0),X(i)}),E&&(f=q)}function ut(a,e,t,r,s,n,f){var h=a.length,g=e.items,y=e.first,i=y,v,u=null,c=[],_=[],w,b,d,x;for(x=0;x<h;x+=1){if(w=a[x],b=n(w,x),d=g.get(b),d===void 0){var O=i?i.e.nodes_start:t;u=Ae(O,e,u,u===null?e.first:u.next,w,b,x,r,s,f),g.set(b,u),c=[],_=[],i=u.next;continue}if(ot(d,w,x),d.e.f&Q&&ye(d.e),d!==i){if(v!==void 0&&v.has(d)){if(c.length<_.length){var T=_[0],o;u=T.prev;var B=c[0],L=c[c.length-1];for(o=0;o<c.length;o+=1)_e(c[o],T,t);for(o=0;o<_.length;o+=1)v.delete(_[o]);G(e,B.prev,L.next),G(e,u,B),G(e,L,T),i=T,u=L,x-=1,c=[],_=[]}else v.delete(d),_e(d,i,t),G(e,d.prev,d.next),G(e,d,u===null?e.first:u.next),G(e,u,d),u=d;continue}for(c=[],_=[];i!==null&&i.k!==b;)i.e.f&Q||(v??(v=new Set)).add(i),_.push(i),i=i.next;if(i===null)continue;d=i}c.push(d),u=d,i=d.next}if(i!==null||v!==void 0){for(var M=v===void 0?[]:me(v);i!==null;)i.e.f&Q||M.push(i),i=i.next;var U=M.length;if(U>0){var V=null;lt(e,M,V,g)}}j.first=e.first&&e.first.e,j.last=u&&u.e}function ot(a,e,t,r){Re(a.v,e),a.i=t}function Ae(a,e,t,r,s,n,f,h,g,y){var i=(g&qe)!==0,v=(g&Ye)===0,u=i?v?Le(s):he(s):s,c=g&Me?he(f):f,_={i:c,v:u,k:n,a:null,e:null,prev:t,next:r};try{return _.e=pe(()=>h(a,u,c,y),E),_.e.prev=t&&t.e,_.e.next=r&&r.e,t===null?e.first=_:(t.next=_,t.e.next=_.e),r!==null&&(r.prev=_,r.e.prev=_.e),_}finally{}}function _e(a,e,t){for(var r=a.next?a.next.e.nodes_start:t,s=e?e.e.nodes_start:t,n=a.e.nodes_start;n!==r;){var f=We(n);s.before(n),n=f}}function G(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function C(a){if(E){var e=!1,t=()=>{if(!e){if(e=!0,a.hasAttribute("value")){var r=a.value;F(a,"value",null),a.value=r}if(a.hasAttribute("checked")){var s=a.checked;F(a,"checked",null),a.checked=s}}};a.__on_r=t,Ue(t),Ie()}}function F(a,e,t,r){var s=a.__attributes??(a.__attributes={});E&&(s[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="style"&&"__styles"in a&&(a.__styles={}),e==="loading"&&(a[Xe]=t),t==null?a.removeAttribute(e):typeof t!="string"&&vt(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var ge=new Map;function vt(a){var e=ge.get(a.nodeName);if(e)return e;ge.set(a.nodeName,e=[]);for(var t,r=a,s=Element.prototype;s!==r;){t=Ke(r);for(var n in t)t[n].set&&e.push(n);r=Fe(r)}return e}function H(a,e,t=e){var r=Je();it(a,"input",s=>{var n=s?a.defaultValue:a.value;if(n=Z(a)?$(n):n,t(n),r&&n!==(n=e())){var f=a.selectionStart,h=a.selectionEnd;a.value=n??"",h!==null&&(a.selectionStart=f,a.selectionEnd=Math.min(h,a.value.length))}}),(E&&a.defaultValue!==a.value||Qe(e)==null&&a.value)&&t(Z(a)?$(a.value):a.value),Ze(()=>{var s=e();Z(a)&&s===$(a.value)||a.type==="date"&&!s&&!a.value||s!==a.value&&(a.value=s??"")})}function Z(a){var e=a.type;return e==="number"||e==="range"}function $(a){return a===""?null:+a}var p,D,P,W,N,S,R;const K=class K{constructor(e,t={},r=e){z(this,p);z(this,D);z(this,P);z(this,W);z(this,N);z(this,S,{x:0,y:0});z(this,R,{x:0,y:0});if(K.existingIDs.has(r))throw Error("A Tile Atlas with this ID already exists.");k(this,P,e),k(this,p,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),k(this,D,r),this.loadImg()}async loadImg(){if(l(this,N))return l(this,N);const e=document.createElement("img");return k(this,N,new Promise(t=>{e.addEventListener("load",()=>{k(this,S,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=l(this,P),k(this,W,e),l(this,N)}get img(){return l(this,W)}get src(){return l(this,P)}get id(){return l(this,D)}get dimensions(){return structuredClone(l(this,S))}get settings(){return l(this,p)}set settings(e){k(this,p,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:l(this,p).startOffset.x+(l(this,p).tileSize.x+l(this,p).tileGap.x)*(t%l(this,R).x),y:l(this,p).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/l(this,R).x),dx:l(this,p).tileSize.x,dy:l(this,p).tileSize.y}}createTiles(e){let t=0;const r=[];let s=0,n=0;for(let f=l(this,p).startOffset.y;f<l(this,S).y&&f+l(this,p).tileSize.y<=l(this,S).y;f+=l(this,p).tileSize.y+l(this,p).tileGap.y){s=0;for(let h=l(this,p).startOffset.x;h<l(this,S).x&&h+l(this,p).tileSize.x<=l(this,S).x;h+=l(this,p).tileSize.x+l(this,p).tileGap.x)r.push({type:"basic",id:e++,atlasId:l(this,D),indexInAtlas:t++,name:`${l(this,D)}_${t}`}),s++;n++}return l(this,R).x=s,l(this,R).y=n,r}};p=new WeakMap,D=new WeakMap,P=new WeakMap,W=new WeakMap,N=new WeakMap,S=new WeakMap,R=new WeakMap,le(K,"existingIDs",new Set);let ee=K;var dt=te('<div class="atlas-display"><fieldset><legend>Tile Size</legend> <label>width <input type="number" min="0"></label> <label>height <input type="number" min="0"></label></fieldset> <fieldset><legend>Tile Gap</legend> <label>width <input type="number"></label> <label>height <input type="number"></label></fieldset> <fieldset><legend>Offset</legend> <label>width <input type="number"></label> <label>height <input type="number"></label></fieldset> <canvas></canvas></div>');function ht(a,e){re(e,!0);let t=be(e,"atlas",15),r;$e(()=>{const o=r.getContext("2d");o.clearRect(0,0,r.width,r.height),o.drawImage(t().img,0,0),o.lineWidth=1,o.strokeStyle="rgba(0, 0, 0, 0.5)",o.textAlign="right";const B=t().createTiles(1);for(let L of B){let{x:M,y:U,dx:V,dy:ie}=t().getTilePosition(L);o.strokeRect(M,U,V,ie),o.fillText(L.id.toString(),M+V-1,U+ie-1,V)}});var s=dt(),n=I(s),f=m(I(n),2),h=m(I(f));C(h),A(f);var g=m(f,2),y=m(I(g));C(y),A(g),A(n);var i=m(n,2),v=m(I(i),2),u=m(I(v));C(u),A(v);var c=m(v,2),_=m(I(c));C(_),A(c),A(i);var w=m(i,2),b=m(I(w),2),d=m(I(b));C(d),A(b);var x=m(b,2),O=m(I(x));C(O),A(x),A(w);var T=m(w,2);we(T,o=>r=o,()=>r),A(s),je(()=>{F(T,"width",t().img.naturalWidth),F(T,"height",t().img.naturalHeight)}),H(h,()=>t().settings.tileSize.x,o=>t(t().settings.tileSize.x=o,!0)),H(y,()=>t().settings.tileSize.y,o=>t(t().settings.tileSize.y=o,!0)),H(u,()=>t().settings.tileGap.x,o=>t(t().settings.tileGap.x=o,!0)),H(_,()=>t().settings.tileGap.y,o=>t(t().settings.tileGap.y=o,!0)),H(d,()=>t().settings.startOffset.x,o=>t(t().settings.startOffset.x=o,!0)),H(O,()=>t().settings.startOffset.y,o=>t(t().settings.startOffset.y=o,!0)),ae(a,s),se()}var ct=te('<input type="file" name="import" id="import" accept="image/png" multiple> <!>',1);function _t(a,e){re(e,!0);let t,r=be(e,"atlantes",27,()=>Y([]));async function s(y){if(t.files)for(let i of t.files){let v=await n(i),u=Y({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const c=new ee(v,u,Math.random().toString());await c.loadImg(),r().push(c)}}async function n(y){return new Promise(i=>{const v=new FileReader;v.onload=()=>i(v.result),v.readAsDataURL(y)})}var f=ct(),h=xe(f);h.__change=s,we(h,y=>t=y,()=>t);var g=m(h,2);ft(g,17,r,nt,(y,i)=>{ht(y,{get atlas(){return X(i)}})}),ae(a,f),se()}rt(["change"]);var gt=te("<h1>Tilemap Generator</h1> <!>",1);function It(a,e){re(e,!0),Y([]);let t=et(Y([]));at(async()=>{});var r=gt(),s=m(xe(r),2);_t(s,{get atlantes(){return X(t)},set atlantes(n){tt(t,Y(n))}}),ae(a,r),se()}export{It as component};
