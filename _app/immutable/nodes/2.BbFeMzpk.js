var kt=Object.defineProperty;var st=i=>{throw TypeError(i)};var At=(i,t,e)=>t in i?kt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var B=(i,t,e)=>At(i,typeof t!="symbol"?t+"":t,e),at=(i,t,e)=>t.has(i)||st("Cannot "+e);var c=(i,t,e)=>(at(i,t,"read from private field"),e?e.call(i):t.get(i)),H=(i,t,e)=>t.has(i)?st("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),X=(i,t,e,s)=>(at(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);import{t as de,a as ce}from"../chunks/B413fvgw.js";import{s as nt,j as lt,m as It,o as Xe,p as zt,b as Ct,v as Be,h as Z,w as Mt,z as Ft,P as h,af as Nt,a6 as Dt,a7 as rt,t as Ve,f as Pe,A as Pt,a8 as ut,d as ht,a9 as Lt,ar as We,F as gt,am as Rt,$ as ot,k as Ot,as as et,at as Ut,D as jt,au as Bt,e as Vt,av as tt,aw as Wt,r as Gt,ax as yt,ac as Ht,ay as ct,az as Yt,aA as Xt,aB as qt,a5 as Kt,aC as Jt,aD as Zt,a as xt,ab as pt,I as ke,X as b,U as ze,J as Ae,V as E,W as T,ap as Q,a2 as V,g as _t,R as Qt,u as qe,aE as $t}from"../chunks/DXjSzVAu.js";import{d as Ue,s as Ke,a as ei}from"../chunks/CZth_J7-.js";import{p as Ne,a as D,b as se,i as bt}from"../chunks/BDzuGfd0.js";import{o as je}from"../chunks/BMF9-ZhM.js";let dt=!1;function wt(){dt||(dt=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var t;if(!i.defaultPrevented)for(const e of i.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function ti(i){var t=It,e=Xe;nt(null),lt(null);try{return i()}finally{nt(t),lt(e)}}function mt(i,t,e,s=e){i.addEventListener(t,()=>ti(e));const a=i.__on_r;a?i.__on_r=()=>{a(),s(!0)}:i.__on_r=()=>s(!0),wt()}function ii(i,t){return t}function si(i,t,e,s){for(var a=[],n=t.length,v=0;v<n;v++)Ut(t[v].e,a,!0);var u=n>0&&a.length===0&&e!==null;if(u){var m=e.parentNode;jt(m),m.append(e),s.clear(),ge(i,t[0].prev,t[n-1].next)}Bt(a,()=>{for(var g=0;g<n;g++){var f=t[g];u||(s.delete(f.k),ge(i,f.prev,f.next)),Vt(f.e,!u)}})}function Je(i,t,e,s,a,n=null){var v=i,u={flags:t,items:new Map,first:null},m=(t&yt)!==0;if(m){var g=i;v=Z?Be(Mt(g)):g.appendChild(zt())}Z&&Ft();var f=null,p=!1,o=Nt(()=>{var y=e();return Ot(y)?y:y==null?[]:gt(y)});Ct(()=>{var y=h(o),r=y.length;if(p&&r===0)return;p=r===0;let P=!1;if(Z){var C=v.data===Dt;C!==(r===0)&&(v=rt(),Be(v),Ve(!1),P=!0)}if(Z){for(var L=null,R,O=0;O<r;O++){if(Pe.nodeType===8&&Pe.data===Pt){v=Pe,P=!0,Ve(!1);break}var _=y[O],I=s(_,O);R=Tt(Pe,u,L,null,_,I,O,a,t,e),u.items.set(I,R),L=R}r>0&&Be(rt())}Z||ai(y,u,v,a,t,s,e),n!==null&&(r===0?f?ut(f):f=ht(()=>n(v)):f!==null&&Lt(f,()=>{f=null})),P&&Ve(!0),h(o)}),Z&&(v=Pe)}function ai(i,t,e,s,a,n,v){var ie,G,ae,K;var u=(a&Yt)!==0,m=(a&(tt|et))!==0,g=i.length,f=t.items,p=t.first,o=p,y,r=null,P,C=[],L=[],R,O,_,I;if(u)for(I=0;I<g;I+=1)R=i[I],O=n(R,I),_=f.get(O),_!==void 0&&((ie=_.a)==null||ie.measure(),(P??(P=new Set)).add(_));for(I=0;I<g;I+=1){if(R=i[I],O=n(R,I),_=f.get(O),_===void 0){var $=o?o.e.nodes_start:e;r=Tt($,t,r,r===null?t.first:r.next,R,O,I,s,a,v),f.set(O,r),C=[],L=[],o=r.next;continue}if(m&&ni(_,R,I,a),_.e.f&We&&(ut(_.e),u&&((G=_.a)==null||G.unfix(),(P??(P=new Set)).delete(_))),_!==o){if(y!==void 0&&y.has(_)){if(C.length<L.length){var ee=L[0],S;r=ee.prev;var A=C[0],U=C[C.length-1];for(S=0;S<C.length;S+=1)vt(C[S],ee,e);for(S=0;S<L.length;S+=1)y.delete(L[S]);ge(t,A.prev,U.next),ge(t,r,A),ge(t,U,ee),o=ee,r=U,I-=1,C=[],L=[]}else y.delete(_),vt(_,o,e),ge(t,_.prev,_.next),ge(t,_,r===null?t.first:r.next),ge(t,r,_),r=_;continue}for(C=[],L=[];o!==null&&o.k!==O;)o.e.f&We||(y??(y=new Set)).add(o),L.push(o),o=o.next;if(o===null)continue;_=o}C.push(_),r=_,o=_.next}if(o!==null||y!==void 0){for(var N=y===void 0?[]:gt(y);o!==null;)o.e.f&We||N.push(o),o=o.next;var te=N.length;if(te>0){var ve=a&yt&&g===0?e:null;if(u){for(I=0;I<te;I+=1)(ae=N[I].a)==null||ae.measure();for(I=0;I<te;I+=1)(K=N[I].a)==null||K.fix()}si(t,N,ve,f)}}u&&Ht(()=>{var J;if(P!==void 0)for(_ of P)(J=_.a)==null||J.apply()}),Xe.first=t.first&&t.first.e,Xe.last=r&&r.e}function ni(i,t,e,s){s&tt&&ct(i.v,t),s&et?ct(i.i,e):i.i=e}function Tt(i,t,e,s,a,n,v,u,m,g){var f=(m&tt)!==0,p=(m&Wt)===0,o=f?p?Rt(a):ot(a):a,y=m&et?ot(v):v,r={i:y,v:o,k:n,a:null,e:null,prev:e,next:s};try{return r.e=ht(()=>u(i,o,y,g),Z),r.e.prev=e&&e.e,r.e.next=s&&s.e,e===null?t.first=r:(e.next=r,e.e.next=r.e),s!==null&&(s.prev=r,s.e.prev=r.e),r}finally{}}function vt(i,t,e){for(var s=i.next?i.next.e.nodes_start:e,a=t?t.e.nodes_start:e,n=i.e.nodes_start;n!==s;){var v=Gt(n);a.before(n),n=v}}function ge(i,t,e){t===null?i.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function De(i){if(Z){var t=!1,e=()=>{if(!t){if(t=!0,i.hasAttribute("value")){var s=i.value;Re(i,"value",null),i.value=s}if(i.hasAttribute("checked")){var a=i.checked;Re(i,"checked",null),i.checked=a}}};i.__on_r=e,Xt(e),wt()}}function Re(i,t,e,s){var a=i.__attributes??(i.__attributes={});Z&&(a[t]=i.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&i.nodeName==="LINK")||a[t]!==(a[t]=e)&&(t==="style"&&"__styles"in i&&(i.__styles={}),t==="loading"&&(i[qt]=e),e==null?i.removeAttribute(t):typeof e!="string"&&li(i).includes(t)?i[t]=e:i.setAttribute(t,e))}var ft=new Map;function li(i){var t=ft.get(i.nodeName);if(t)return t;ft.set(i.nodeName,t=[]);for(var e,s=i,a=Element.prototype;a!==s;){e=Jt(s);for(var n in e)e[n].set&&t.push(n);s=Kt(s)}return t}function ri(i,t,e){var s=i.__className,a=oi(t);Z&&i.className===a?i.__className=a:(s!==a||Z&&i.className!==a)&&(t==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function oi(i,t){return(i??"")+""}function Ze(i,t,e){if(e){if(i.classList.contains(t))return;i.classList.add(t)}else{if(!i.classList.contains(t))return;i.classList.remove(t)}}function ci(i,t,e,s){var a=i.__styles??(i.__styles={});a[t]!==e&&(a[t]=e,e==null?i.style.removeProperty(t):i.style.setProperty(t,e,""))}function Qe(i,t,e=t){var s=Zt();mt(i,"input",a=>{var n=a?i.defaultValue:i.value;if(n=Ge(i)?He(n):n,e(n),s&&n!==(n=t())){var v=i.selectionStart,u=i.selectionEnd;i.value=n??"",u!==null&&(i.selectionStart=v,i.selectionEnd=Math.min(u,i.value.length))}}),(Z&&i.defaultValue!==i.value||xt(t)==null&&i.value)&&e(Ge(i)?He(i.value):i.value),pt(()=>{var a=t();Ge(i)&&a===He(i.value)||i.type==="date"&&!a&&!i.value||a!==i.value&&(i.value=a??"")})}function $e(i,t,e=t){mt(i,"change",s=>{var a=s?i.defaultChecked:i.checked;e(a)}),(Z&&i.defaultChecked!==i.checked||xt(t)==null)&&e(i.checked),pt(()=>{var s=t();i.checked=!!s})}function Ge(i){var t=i.type;return t==="number"||t==="range"}function He(i){return i===""?null:+i}var Y=(i=>(i[i.UNSET=0]="UNSET",i[i.SAME=1]="SAME",i[i.DIFFERENT=2]="DIFFERENT",i))(Y||{}),j,be,Ce,Oe,we,ue,ye,Me;const Le=class Le{constructor(t,e={},s=t){H(this,j);H(this,be);H(this,Ce);H(this,Oe);H(this,we);H(this,ue,{x:0,y:0});H(this,ye,{x:0,y:0});H(this,Me);if(Le.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");X(this,Ce,t),X(this,j,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...e}),X(this,be,s),this.loadImg()}async loadImg(){if(c(this,we))return c(this,we);const t=document.createElement("img");return X(this,we,new Promise(e=>{t.addEventListener("load",()=>{X(this,ue,{x:t.naturalWidth,y:t.naturalHeight}),e()})})),t.src=c(this,Ce),X(this,Oe,t),c(this,we)}get img(){return c(this,Oe)}get src(){return c(this,Ce)}get id(){return c(this,be)}get dimensions(){return structuredClone(c(this,ue))}get tileAmount(){return structuredClone(c(this,ye))}get settings(){return c(this,j)}set settings(t){X(this,j,t)}getTile(t){}getTilePosition(t){let e=typeof t=="number"?t:t.indexInAtlas;return{x:c(this,j).startOffset.x+(c(this,j).tileSize.x+c(this,j).tileGap.x)*(e%c(this,ye).x),y:c(this,j).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(e/c(this,ye).x),w:c(this,j).tileSize.x,h:c(this,j).tileSize.y}}createTiles(){if(c(this,j).tileSize.x<1||c(this,j).tileSize.y<1)return[];let t=0,e=0;const s=[];let a=0,n=0;for(let v=c(this,j).startOffset.y;v<c(this,ue).y&&v+c(this,j).tileSize.y<=c(this,ue).y;v+=c(this,j).tileSize.y+c(this,j).tileGap.y){a=0;for(let u=c(this,j).startOffset.x;u<c(this,ue).x&&u+c(this,j).tileSize.x<=c(this,ue).x;u+=c(this,j).tileSize.x+c(this,j).tileGap.x)s.push({type:"basic",id:t++,atlasId:c(this,be),indexInAtlas:e++,name:`${c(this,be)}_${e}`}),a++;n++}return c(this,ye).x=a,c(this,ye).y=n,X(this,Me,[...s]),s}getTiles(){return c(this,Me)||this.createTiles(),c(this,Me)}};j=new WeakMap,be=new WeakMap,Ce=new WeakMap,Oe=new WeakMap,we=new WeakMap,ue=new WeakMap,ye=new WeakMap,Me=new WeakMap,B(Le,"existingIDs",new Set),B(Le,"selectedTiles",[]);let z=Le;var me,Te,oe;class di{constructor(t,e){H(this,me,[]);H(this,Te,{x:20,y:20});H(this,oe,{x:64,y:64});this.mapSize=t,this.tileSize=e}get mapSize(){return c(this,Te)}set mapSize(t){X(this,Te,t)}get tileSize(){return c(this,oe)}set tileSize(t){X(this,oe,t)}setTile(t,e){c(this,me)[e.y]||(c(this,me)[e.y]=[]),c(this,me)[e.y][e.x]=t}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<c(this,Te).y;e++)for(let s=0;s<c(this,Te).x;s++){const a=this.getTile({x:s,y:e});if(!a)continue;const n={x:c(this,oe).x*s,y:c(this,oe).y*e};a.type==="basic"?q.drawTile(a,t,n,c(this,oe)):a.type==="rule"&&(q.drawTile(a.default,t,n,c(this,oe)),this.drawRuleOverlay(t,n,c(this,oe)))}}getTile(t){var e;return(e=c(this,me)[t.y])==null?void 0:e[t.x]}drawRuleOverlay(t,e,s){t.strokeStyle="white",t.fillStyle="black",t.font=`bold ${s.y*.8}px sans-serif`,t.strokeText("⚙",e.x+1,e.y+s.y-1,s.x),t.fillText("⚙",e.x+1,e.y+s.y-1,s.x)}}me=new WeakMap,Te=new WeakMap,oe=new WeakMap;var xe,Se,Fe;class vi{constructor(t,e,s){H(this,xe);H(this,Se);H(this,Fe);X(this,xe,t),X(this,Se,e),X(this,Fe,s.map(a=>typeof a=="number"?q.getTile(a):a))}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<c(this,xe).x;e++)for(let s=0;s<c(this,xe).y;s++){const a=this.getTile(e,s);a&&q.drawTile(a,t,{x:c(this,Se).x*e,y:c(this,Se).y*e},c(this,Se))}}getTile(t,e){return c(this,Fe)[e*c(this,xe).x+t]}setTile(t,e,s){c(this,Fe)[e*c(this,xe).x+t]=s}}xe=new WeakMap,Se=new WeakMap,Fe=new WeakMap;const W=class W{constructor(){if(W.Instance)return W.Instance;W.renderMethod.set("basic",W.drawBasicTile),W.renderMethod.set("rule",W.drawRuleTile)}static setAtlantes(t){this.atlantes.clear();for(const e of t)this.atlantes.set(e.id,e);this.recalculateTileIds()}static recalculateTileIds(){console.log("recalc");let t=1;const e=new Map;for(let s of this.atlantes.values())s.getTiles().forEach(n=>{n.id=t++,e.set(n.id,n)});for(let s of this.tileIndex.values())s.type!=="basic"&&(s.id=e.size+1,e.set(s.id,s));this.tileIndex=e}static addTile(t){this.tileIndex.set(t.id,t)}static newTile(t,e=""){console.log("new tile");let s=this.tileIndex.size;for(;this.tileIndex.has(s);)s++;let a={type:t,default:void 0,id:s,name:e,rules:[]};return this.addTile(a),a}static getTile(t){return this.tileIndex.get(t)}static drawTile(t,e,s,a){var n;if(typeof t=="number"&&(t=this.tileIndex.get(t)),!!t){if(!W.renderMethod.has(t.type))throw new Error(`Cannot draw tile type "${t.type}": No known renderer.`);(n=W.renderMethod.get(t.type))==null||n(t,e,s,a)}}static drawRuleTile(t,e,s,a){}};B(W,"renderMethod",new Map),B(W,"atlantes",new Map),B(W,"tileIndex",new Map),B(W,"drawBasicTile",(t,e,s,a)=>{const n=W.atlantes.get(t.atlasId);if(!n){e.fillStyle="red",e.textAlign="center",e.font=`bold ${a.y*.8}px sans-serif`,e.fillText("!",s.x+.5*a.x,s.y+a.y*.8,a.x),console.error(`Atlas "${t.atlasId}" not found.`);return}let{x:v,y:u,w:m,h:g}=n.getTilePosition(t.indexInAtlas);e.drawImage(n.img,v,u,m,g,s.x,s.y,a.x,a.y)}),B(W,"Instance",new W);let q=W;class it extends EventTarget{constructor(e){super();B(this,"canvas");B(this,"ctx");B(this,"translation",{x:0,y:0});B(this,"scale",1);B(this,"scaleSettings",{factor:2,min:1/16,max:16});B(this,"syncedCtx",new Set);B(this,"pointerdown",e=>{switch(e.button){}this.dispatchEventFromEvent(e),e.preventDefault()});B(this,"pointermove",e=>{e.preventDefault();const s=this.getButtonsFromEvent(e);s.includes(0),s.includes(1),s.includes(2)&&(this.translation.x+=e.movementX,this.translation.y+=e.movementY,this.draw()),this.dispatchEventFromEvent(e)});B(this,"pointerup",e=>{switch(this.dispatchEventFromEvent(e),e.button){}e.preventDefault()});B(this,"zoom",e=>{e.preventDefault();const s=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!1),a=-Math.sign(e.deltaY),n=this.scale,v=Math.min(this.scaleSettings.max,Math.max(this.scaleSettings.min,this.scale*Math.pow(this.scaleSettings.factor,a))),u=v/n;this.translation.x=s.x+(this.translation.x-s.x)*u,this.translation.y=s.y+(this.translation.y-s.y)*u,this.scale=v,this.draw()});this.canvas=e,this.ctx=e.getContext("2d"),this.installListeners();const s=e.getBoundingClientRect();e.width=s.width,e.height=s.height,this.syncedCtx.add(this.ctx)}installListeners(){this.canvas.addEventListener("pointerdown",this.pointerdown),this.canvas.addEventListener("pointermove",this.pointermove),this.canvas.addEventListener("pointerup",this.pointerup),this.canvas.addEventListener("wheel",this.zoom),this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}getButtonsFromEvent(e){const s=[];for(let a=0;a<5;a++)e.buttons&1<<a&&s.push(a);return s}dispatchEventFromEvent(e){const s=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!0);this.dispatchEvent(new CustomEvent(e.type,{detail:{pos:s,event:e}}))}canvasPosFromMousePos(e,s){const a=this.canvas.getBoundingClientRect(),n={x:e.x-a.left,y:e.y-a.top};return s&&(n.x=(n.x-this.translation.x)/this.scale,n.y=(n.y-this.translation.y)/this.scale),n}draw(){for(let e of this.syncedCtx.values())e.clearRect(0,0,e.canvas.width,e.canvas.height),e.reset(),e.translate(this.translation.x,this.translation.y),e.scale(this.scale,this.scale);this.dispatchEvent(new CustomEvent("draw"))}reset(){this.scale=1,this.translation.x=0,this.translation.y=0,this.draw()}addCtxToSync(e){this.syncedCtx.add(e)}}var fi=de('<fieldset><legend> </legend> <label>width <input type="number" min="0" class="svelte-1ljzpu2"></label> <label>height <input type="number" min="0" class="svelte-1ljzpu2"></label></fieldset>');function Ee(i,t){ke(t,!0);let e=Ne(t,"vector",31,()=>D({x:0,y:0}));var s=fi(),a=E(s),n=E(a,!0);T(a);var v=b(a,2),u=b(E(v));De(u),u.__change=function(...f){var p;(p=t.change)==null||p.apply(this,f)},T(v);var m=b(v,2),g=b(E(m));De(g),g.__change=function(...f){var p;(p=t.change)==null||p.apply(this,f)},T(m),T(s),ze(()=>Ke(n,t.legend)),Qe(u,()=>e().x,f=>e(e().x=f,!0)),Qe(g,()=>e().y,f=>e(e().y=f,!0)),ce(i,s),Ae()}Ue(["change"]);var ui=(i,t,e)=>{t.remove(e())},hi=de('<fieldset class="atlas-display svelte-kpjacb"><img class="img-preview svelte-kpjacb" alt=""> <div class="canvas-wrapper svelte-kpjacb"><canvas></canvas> <canvas class="canvas-overlay svelte-kpjacb"></canvas></div> <div class="settings-wrapper svelte-kpjacb"><!> <!> <!> <fieldset class="svelte-kpjacb"><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset> <fieldset class="svelte-kpjacb"><legend>Danger Zone</legend> <button>Remove</button></fieldset></div></fieldset>');function gi(i,t){ke(t,!0);let e=Ne(t,"atlas",15),s,a,n,v,u,m,g,f=[],p=new Set,o,y=Q(!1),r=Q(!0);je(()=>{v.addEventListener("click",()=>{t.active||(t.activate(e()),P())}),g=new it(n),g.addEventListener("draw",C),g.addEventListener("pointermove",L),g.addEventListener("pointerup",O),n.addEventListener("pointerleave",R),u=n.getContext("2d"),m=a.getContext("2d"),g.addCtxToSync(m),ee(),g.draw()});function P(){if(p.size==0)return z.selectedTiles=[],g.draw();const w=e().tileAmount,l={x:1/0,y:1/0},d={x:-1/0,y:-1/0};p.forEach(x=>{const M={x:x.indexInAtlas%w.x,y:Math.floor(x.indexInAtlas/w.x)};l.x>M.x&&(l.x=M.x),l.y>M.y&&(l.y=M.y),d.x<M.x&&(d.x=M.x),d.y<M.y&&(d.y=M.y)}),z.selectedTiles=Array.from({length:d.y-l.y+1},()=>[]),p.forEach(x=>{const M={x:x.indexInAtlas%w.x-l.x,y:Math.floor(x.indexInAtlas/w.x)-l.y};z.selectedTiles[M.y][M.x]=x}),g.draw()}function C(){m.imageSmoothingEnabled=!1,m.drawImage(e().img,0,0),m.lineWidth=1,m.strokeStyle="rgba(0, 0, 0, 0.5)",m.textAlign="right",f=e().getTiles();for(let w of f){let{x:l,y:d,w:x,h:M}=e().getTilePosition(w);h(r)&&m.strokeRect(l,d,x,M),h(y)&&m.fillText(w.id.toString(),l+x-1,d+M-1,x)}_()}function L(w){const l=I(w.detail.pos.x,w.detail.pos.y);if(!l)return R();o=l,g.draw()}function R(){o=void 0,g.draw()}function O(w){if(w.detail.event.button!==0)return;const l=I(w.detail.pos.x,w.detail.pos.y);if(!l)return p.clear(),P();w.detail.event.ctrlKey?p.has(l)?p.delete(l):p.add(l):p.has(l)&&p.size===1?p.clear():(p.clear(),p.add(l)),P()}function _(){if(o){u.fillStyle="rgba(255, 255, 255, 0.5)";let{x:w,y:l,w:d,h:x}=e().getTilePosition(o);u.fillRect(w,l,d,x)}for(let w of p.values()){u.strokeStyle="rgba(255, 0, 0, 1)",u.fillStyle="rgba(255, 0, 0, 0.25)",u.lineWidth=1;let{x:l,y:d,w:x,h:M}=e().getTilePosition(w);u.fillRect(l,d,x,M),u.strokeRect(l,d,x,M)}}function I(w,l){for(let d of f){let{x,y:M,w:St,h:Et}=e().getTilePosition(d);if(w>x&&w<x+St&&l>M&&l<M+Et)return d}}function $(){e().createTiles(),g.draw()}function ee(){a.width=s.clientWidth,a.height=s.clientHeight,n.width=s.clientWidth,n.height=s.clientHeight}function S(){ee(),g.reset()}var A=hi(),U=E(A),N=b(U,2),te=E(N);se(te,w=>a=w,()=>a);var ve=b(te,2);se(ve,w=>n=w,()=>n),T(N),se(N,w=>s=w,()=>s);var ie=b(N,2),G=E(ie);Ee(G,{legend:"Tile Size",change:$,get vector(){return e().settings.tileSize},set vector(w){e(e().settings.tileSize=w,!0)}});var ae=b(G,2);Ee(ae,{legend:"Tile Gap",change:$,get vector(){return e().settings.tileGap},set vector(w){e(e().settings.tileGap=w,!0)}});var K=b(ae,2);Ee(K,{legend:"Offset",change:$,get vector(){return e().settings.startOffset},set vector(w){e(e().settings.startOffset=w,!0)}});var J=b(K,2),fe=b(E(J),2),le=b(E(fe));De(le),T(fe);var re=b(fe,2),pe=b(E(re));De(pe),T(re);var Ie=b(re,2);Ie.__click=S,T(J);var he=b(J,2),_e=b(E(he),2);_e.__click=[ui,t,e],T(he),T(ie),T(A),se(A,w=>v=w,()=>v),ze(()=>{Ze(A,"active",t.active),Re(U,"src",e().src)}),$e(le,()=>h(y),w=>V(y,w)),$e(pe,()=>h(r),w=>V(r,w)),ce(i,A),Ae()}Ue(["click"]);var yi=de('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function xi(i,t){ke(t,!0);let e,s=Ne(t,"atlantes",27,()=>D([])),a=Ne(t,"activeAtlas",15);async function n(o){if(e.files)for(let y of e.files){let r=await v(y),P=D({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const C=new z(r,P,y.name);await C.loadImg(),s().push(C),a(C)}}async function v(o){return new Promise(y=>{const r=new FileReader;r.onload=()=>y(r.result),r.readAsDataURL(o)})}function u(o){a(o)}function m(o){o==a()&&(z.selectedTiles=[]);let y=s().indexOf(o);if(!(y<0)){for(s().splice(y,1);y>=s().length;)y--;y<0||a(s()[y])}}var g=yi(),f=_t(g);f.__change=n,se(f,o=>e=o,()=>e);var p=b(f,2);Je(p,20,s,o=>o,(o,y)=>{const r=Qt(()=>a()==y);gi(o,{get atlas(){return y},activate:u,remove:m,get active(){return h(r)}})}),T(p),ce(i,g),Ae()}Ue(["change"]);function pi(i,t){const e=D({neighborFilter:[Y.UNSET,Y.UNSET,Y.UNSET,Y.UNSET,Y.UNSET,Y.UNSET,Y.UNSET,Y.UNSET]});t().rules.push(e)}var _i=(i,t)=>{t()},bi=(i,t,e)=>{t(e,-1)},wi=(i,t,e)=>{t(e,1)},mi=(i,t,e)=>{t(e)},Ti=de("<button></button>"),Si=de('<div class="tile-rule svelte-2d6hni"><div class="tile-rule-order svelte-2d6hni"><button>^</button> <button>v</button></div> <div class="tile-rule-data"><div class="tile-rule-image svelte-2d6hni"></div> <button>set tile</button></div> <div class="tile-neighbors svelte-2d6hni"></div></div>'),Ei=de('<button>set tile</button> <div class="tile-rules svelte-2d6hni">Rules <!></div> <button>Add Rule</button>',1),ki=de('<div class="tile-info svelte-2d6hni"><div class="tile-base-info svelte-2d6hni"><span class="tile-id svelte-2d6hni"> </span> <span class="tile-type svelte-2d6hni"> </span> <span class="tile-name svelte-2d6hni">name: <input type="text"></span> <div class="tile-preview svelte-2d6hni"><canvas width="64" height="64"></canvas></div></div> <!></div>');function Ai(i,t){ke(t,!0);let e=Ne(t,"tile",15),s,a;je(()=>{a=s.getContext("2d"),a.imageSmoothingEnabled=!1,a.clearRect(0,0,s.width,s.height)}),qe(()=>{e().type==="basic"?n(q.drawTile,e()):e().type==="rule"&&n(q.drawTile,e().default)});function n(S,A){a.clearRect(0,0,s.width,s.height);const U={x:0,y:0},N={x:s.width,y:s.height};S(A,a,U,N)}function v(S){return S===Y.SAME?"same":S===Y.DIFFERENT?"different":"none"}function u(S,A){S[A]=(S[A]+1)%Object.keys(Y).filter(U=>isNaN(Number(U))).length}function m(S,A){if(e().type!=="rule")return;let U=e().rules.indexOf(S);U<0||e().rules.splice(U+A,0,...e().rules.splice(U,1))}function g(S){if(!S)return"";let A=q.atlantes.get(S.atlasId);if(!A)return"";let U=A.getTilePosition(S.indexInAtlas),N={x:50/A.settings.tileSize.x,y:50/A.settings.tileSize.y};return`background-image: url(${A.src}); background-position: -${U.x*N.x}px -${U.y*N.y}px; background-size: ${A.dimensions.x*N.x}px ${A.dimensions.y*N.y}px`}function f(S){if(z.selectedTiles.length<=0)return;let A=z.selectedTiles[0][0];A&&(S.tile=A)}function p(){if(e().type!=="rule"||z.selectedTiles.length<=0)return;let S=z.selectedTiles[0][0];S&&(e(e().default=S,!0),n(q.drawTile,e().default))}var o=ki(),y=E(o),r=E(y),P=E(r);T(r);var C=b(r,2),L=E(C);T(C);var R=b(C,2),O=b(E(R));De(O),T(R);var _=b(R,2),I=E(_);se(I,S=>s=S,()=>s),T(_),T(y);var $=b(y,2);{var ee=S=>{var A=Ei(),U=_t(A);U.__click=[_i,p];var N=b(U,2),te=b(E(N));Je(te,18,()=>e().rules,ie=>ie,(ie,G,ae)=>{var K=Si(),J=E(K),fe=E(J);fe.__click=[bi,m,G];var le=b(fe,2);le.__click=[wi,m,G],T(J);var re=b(J,2),pe=E(re),Ie=b(pe,2);Ie.__click=[mi,f,G],T(re);var he=b(re,2);Je(he,21,()=>G.neighborFilter,ii,(_e,w,l,d)=>{var x=Ti();x.__click=()=>u(G.neighborFilter,l),Re(x,"aria-label",`change neighbor rule ${l??""}`),ze(M=>{ri(x,`tile-rule-button ${M??""} svelte-2d6hni`),ci(x,"grid-area","b"+l)},[()=>v(h(w))]),ce(_e,x)}),T(he),T(K),ze(_e=>{fe.disabled=h(ae)===0,le.disabled=h(ae)===e().rules.length-1,Re(pe,"style",_e)},[()=>g(G.tile)]),ce(ie,K)}),T(N);var ve=b(N,2);ve.__click=[pi,e],ce(S,A)};bt($,S=>{e().type==="rule"&&S(ee)})}T(o),ze(()=>{Ke(P,`id: ${e().id??""}`),Ke(L,`type: ${e().type??""}`)}),Qe(O,()=>e().name,S=>e(e().name=S,!0)),ce(i,o),Ae()}Ue(["click"]);const k=Y.UNSET,F=Y.SAME,ne=Y.DIFFERENT;function Ii(i){const t=z.selectedTiles;if(Ye(9)){let e=q.newTile("rule");return e.default=t[1][1],e.rules=[{tile:t[0][0],neighborFilter:[k,ne,k,ne,F,k,F,k]},{tile:t[0][1],neighborFilter:[k,ne,k,F,F,k,F,k]},{tile:t[0][2],neighborFilter:[k,ne,k,F,F,k,F,k]},{tile:t[1][0],neighborFilter:[k,F,k,ne,F,k,F,k]},{tile:t[1][1],neighborFilter:[k,F,k,F,F,k,F,k]},{tile:t[1][2],neighborFilter:[k,F,k,F,ne,k,F,k]},{tile:t[2][0],neighborFilter:[k,F,k,ne,F,k,ne,k]},{tile:t[2][1],neighborFilter:[k,F,k,F,F,k,ne,k]},{tile:t[2][2],neighborFilter:[k,F,k,F,ne,k,ne,k]}],e}else Ye(16)||Ye(20)}function Ye(i){switch(i){case 9:{if(z.selectedTiles.length!==3||z.selectedTiles[0].length!==3)return!1;for(let t=0;t<3;t++)for(let e=0;e<3;e++)if(!z.selectedTiles[t]||!z.selectedTiles[t][e])return!1;return!0}case 16:{if(z.selectedTiles.length!==4||z.selectedTiles[0].length!==4)return!1;for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(!z.selectedTiles[t]||!z.selectedTiles[t][e])return!1;return!0}}return!1}var zi=de('<div id="sheet-wrapper" class="svelte-1hp3cgj"><fieldset class="svelte-1hp3cgj"><!> <!> <fieldset class="svelte-1hp3cgj"><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-1hp3cgj"><canvas id="sheet-canvas" class="svelte-1hp3cgj"></canvas> <canvas id="overlay-canvas" class="svelte-1hp3cgj"></canvas></div> <div id="tile-info-wrapper" class="svelte-1hp3cgj"><div id="tile-info" class="svelte-1hp3cgj"><!></div></div></div>');function Ci(i,t){ke(t,!0);let e=Q(D({x:20,y:20})),s=Q(D({x:16,y:16})),a=Ne(t,"sheet",27,()=>D(new di(h(e),h(s)))),n,v,u,m,g,f,p=Q(void 0),o=Q(void 0),y=Q(!0),r=Q(D({x:0,y:0})),P=!1,C=!1;je(()=>{f=new it(v),f.addEventListener("draw",ee),f.addEventListener("pointerdown",L),f.addEventListener("pointermove",R),f.addEventListener("pointerup",O),m=v.getContext("2d"),A(),g=u.getContext("2d"),f.addCtxToSync(g),ee()});function L(l){if(l.detail.event.button===0)P=!0;else if(l.detail.event.button===2){C=!0;const d=$(l.detail.pos);d&&a().setTile(void 0,d)}}function R(l){if(V(r,D(l.detail.pos)),C){const d=$(l.detail.pos);d&&a().setTile(void 0,d)}P&&_(l),f.draw()}function O(l){l.detail.event.button===0?(P=!1,_(l)):l.detail.event.button===2&&(C=!1),f.draw()}function _(l){const d=$(h(r));if(!d){V(p,void 0);return}if(z.selectedTiles.length>0)if(l.detail.event.shiftKey){const x=Ii(a());if(!x)return;a().setTile(x,d),V(p,D(x))}else I(d);else{let x=a().getTile(d);if(x)V(p,D(x));else{let M=D(q.newTile("rule"));a().setTile(M,d),V(p,D(M))}V(o,D(d))}}function I(l){for(let d=0;d<z.selectedTiles.length;d++)for(let x=0;x<z.selectedTiles[d].length;x++)z.selectedTiles[d][x]&&(l.x+x>=a().mapSize.x||l.y+d>=a().mapSize.y||a().setTile(z.selectedTiles[d][x],{x:l.x+x,y:l.y+d}))}function $(l){const d={x:Math.floor(l.x/h(s).x),y:Math.floor(l.y/h(s).y)};if(!(d.x<0||d.y<0)&&!(d.x>=a().mapSize.x||d.y>=a().mapSize.y))return d}function ee(){a().render(m),m.strokeStyle="rgba(0, 0, 0, 1)",m.lineWidth=1;const l=new Path2D;for(let d=0;d<h(e).y;d++)for(let x=0;x<h(e).x;x++)l.moveTo(x*h(s).x,d*h(s).y+h(s).y),l.lineTo(x*h(s).x,d*h(s).y),l.lineTo(x*h(s).x+h(s).x,d*h(s).y);l.moveTo(0,h(e).y*h(s).y),l.lineTo(h(e).x*h(s).x,h(e).y*h(s).y),l.lineTo(h(e).x*h(s).x,0),h(y)&&m.stroke(l),S()}function S(){const l=$(h(r));if(l){g.imageSmoothingEnabled=!1;for(let d=0;d<z.selectedTiles.length;d++)for(let x=0;x<z.selectedTiles[d].length;x++){if(l.x+x>=a().mapSize.x||l.y+d>=a().mapSize.y)continue;const M={x:(l.x+x)*a().tileSize.x,y:(l.y+d)*a().tileSize.y};q.drawTile(z.selectedTiles[d][x],g,M,h(s))}}h(p)&&h(o)&&(g.fillStyle="rgba(255, 0, 0, 0.5)",g.fillRect(h(o).x*a().tileSize.x,h(o).y*a().tileSize.y,a().tileSize.x,a().tileSize.y))}function A(){v.width=n.clientWidth,u.width=n.clientWidth,v.height=n.clientHeight,u.height=n.clientHeight}function U(){A(),f.reset()}function N(){f.draw()}var te=zi(),ve=E(te),ie=E(ve);Ee(ie,{legend:"Tile Size",change:N,get vector(){return h(s)},set vector(l){V(s,D(l))}});var G=b(ie,2);Ee(G,{legend:"Sheet Size",change:N,get vector(){return h(e)},set vector(l){V(e,D(l))}});var ae=b(G,2),K=b(E(ae),2),J=b(E(K));De(J),T(K);var fe=b(K,2);fe.__click=U,T(ae),T(ve);var le=b(ve,2),re=E(le);se(re,l=>v=l,()=>v);var pe=b(re,2);se(pe,l=>u=l,()=>u),T(le),se(le,l=>n=l,()=>n);var Ie=b(le,2),he=E(Ie),_e=E(he);{var w=l=>{Ai(l,{get tile(){return h(p)},set tile(d){V(p,D(d))}})};bt(_e,l=>{h(p)&&l(w)})}T(he),T(Ie),T(te),$e(J,()=>h(y),l=>V(y,l)),ce(i,te),Ae()}Ue(["click"]);var Mi=de('<div id="map-display"><div class="map-display-settings"><!> <!></div> <canvas width="500" height="500"></canvas></div>');function Fi(i,t){ke(t,!0);let e=Q(D({x:20,y:20})),s=Q(D({x:16,y:16})),a,n,v;je(()=>{v=new it(a),v.addEventListener("draw",u),n=a.getContext("2d")});function u(){t.map.render(n)}function m(){v.draw()}var g=Mi(),f=E(g),p=E(f);Ee(p,{legend:"Map Size",change:m,get vector(){return h(e)},set vector(r){V(e,D(r))}});var o=b(p,2);Ee(o,{legend:"Tile Size",change:m,get vector(){return h(s)},set vector(r){V(s,D(r))}}),T(f);var y=b(f,2);se(y,r=>a=r,()=>a),T(g),ce(i,g),Ae()}var Ni=de('<div id="outer-wrapper" class="svelte-1ctsb4x"><h1 class="svelte-1ctsb4x"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1ctsb4x"><div class="tab svelte-1ctsb4x" id="tab-atlas"><h2 class="svelte-1ctsb4x">Tile Atlas</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab shown svelte-1ctsb4x" id="tab-sheet"><h2 class="svelte-1ctsb4x">Tile Sheet</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab svelte-1ctsb4x" id="tab-map"><h2 class="svelte-1ctsb4x">Tile Map</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div></div></div>');function ji(i,t){ke(t,!0);let e=Q(D([])),s,a=Q(!0),n,v=Q(void 0),u;qe(()=>{s.addEventListener("pointerup",()=>{V(a,!0)}),n.addEventListener("pointerup",()=>{V(a,!1),z.selectedTiles=[]})});let m=new vi({x:5,y:5},{x:64,y:64},[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);qe(()=>{q.setAtlantes(h(e))});var g=Ni();ei(_=>{$t.title="FUDGE Tilemap Editor"});var f=b(E(g),2),p=E(f),o=b(E(p),2),y=E(o);xi(y,{get atlantes(){return h(e)},set atlantes(_){V(e,D(_))},get activeAtlas(){return h(v)},set activeAtlas(_){V(v,D(_))}}),T(o),T(p),se(p,_=>s=_,()=>s);var r=b(p,2),P=b(E(r),2),C=E(P);Ci(C,{get sheet(){return u},get selectedAtlas(){return h(v)}}),T(P),T(r);var L=b(r,2),R=b(E(L),2),O=E(R);Fi(O,{map:m}),T(R),T(L),se(L,_=>n=_,()=>n),T(f),T(g),ze(()=>{Ze(p,"shown",h(a)),Ze(L,"shown",!h(a))}),ce(i,g),Ae()}export{ji as component};
