var vt=Object.defineProperty;var We=a=>{throw TypeError(a)};var ft=(a,e,t)=>e in a?vt(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var je=(a,e,t)=>ft(a,typeof e!="symbol"?e+"":e,t),Fe=(a,e,t)=>e.has(a)||We("Cannot "+t);var l=(a,e,t)=>(Fe(a,e,"read from private field"),t?t.call(a):e.get(a)),A=(a,e,t)=>e.has(a)?We("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),D=(a,e,t,s)=>(Fe(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{t as fe,b as ce}from"../chunks/CAqvofdj.js";import{w as Ue,x as Ve,z as ct,t as Ae,n as ht,A as ut,c as xe,p as O,g as gt,h as _t,O as I,$ as pt,ak as yt,al as Ye,s as be,d as te,e as mt,am as Ze,o as $e,an as xt,ar as we,l as et,as as bt,a6 as wt,M as qe,y as Tt,at as Et,au as At,k as St,av as It,I as kt,aw as Lt,ax as zt,a as Mt,ay as Dt,az as Ot,T as Ct,aA as Gt,aB as Rt,E as tt,W as at,q as he,C as se,ap as oe,ah as w,aj as p,ai as m,ag as st,u as ue,P as ae,J as it,_ as Pt,aC as Nt}from"../chunks/CbumMmjs.js";import{d as lt,c as Bt}from"../chunks/DrCbz4V6.js";import{p as Se,b as q,a as de}from"../chunks/Bd0Ut62N.js";import{o as Ht}from"../chunks/CuAyAQA-.js";let Xe=!1;function rt(){Xe||(Xe=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Wt(a){var e=ct,t=Ae;Ue(null),Ve(null);try{return a()}finally{Ue(e),Ve(t)}}function nt(a,e,t,s=t){a.addEventListener(e,()=>Wt(t));const i=a.__on_r;i?a.__on_r=()=>{i(),s(!0)}:a.__on_r=()=>s(!0),rt()}function jt(a,e){return e}function Ft(a,e,t,s){for(var i=[],r=e.length,o=0;o<r;o++)At(e[o].e,i,!0);var c=r>0&&i.length===0&&t!==null;if(c){var u=t.parentNode;St(u),u.append(t),s.clear(),P(a,e[0].prev,e[r-1].next)}It(i,()=>{for(var h=0;h<r;h++){var d=e[h];c||(s.delete(d.k),P(a,d.prev,d.next)),kt(d.e,!c)}})}function Ut(a,e,t,s,i,r=null){var o=a,c={flags:e,items:new Map,first:null};{var u=a;o=O?xe(gt(u)):u.appendChild(ht())}O&&_t();var h=null,d=!1,g=pt(()=>{var v=t();return Tt(v)?v:v==null?[]:et(v)});ut(()=>{var v=I(g),f=v.length;if(d&&f===0)return;d=f===0;let _=!1;if(O){var x=o.data===yt;x!==(f===0)&&(o=Ye(),xe(o),be(!1),_=!0)}if(O){for(var k=null,y,T=0;T<f;T++){if(te.nodeType===8&&te.data===mt){o=te,_=!0,be(!1);break}var H=v[T],L=s(H,T);y=ot(te,c,k,null,H,L,T,i,e,t),c.items.set(L,y),k=y}f>0&&xe(Ye())}O||Vt(v,c,o,i,e,s,t),r!==null&&(f===0?h?Ze(h):h=$e(()=>r(o)):h!==null&&xt(h,()=>{h=null})),_&&be(!0),I(g)}),O&&(o=te)}function Vt(a,e,t,s,i,r,o){var c=a.length,u=e.items,h=e.first,d=h,g,v=null,f=[],_=[],x,k,y,T;for(T=0;T<c;T+=1){if(x=a[T],k=r(x,T),y=u.get(k),y===void 0){var H=d?d.e.nodes_start:t;v=ot(H,e,v,v===null?e.first:v.next,x,k,T,s,i,o),u.set(k,v),f=[],_=[],d=v.next;continue}if(Yt(y,x,T),y.e.f&we&&Ze(y.e),y!==d){if(g!==void 0&&g.has(y)){if(f.length<_.length){var L=_[0],S;v=L.prev;var X=f[0],K=f[f.length-1];for(S=0;S<f.length;S+=1)Ke(f[S],L,t);for(S=0;S<_.length;S+=1)g.delete(_[S]);P(e,X.prev,K.next),P(e,v,X),P(e,K,L),d=L,v=K,T-=1,f=[],_=[]}else g.delete(y),Ke(y,d,t),P(e,y.prev,y.next),P(e,y,v===null?e.first:v.next),P(e,v,y),v=y;continue}for(f=[],_=[];d!==null&&d.k!==k;)d.e.f&we||(g??(g=new Set)).add(d),_.push(d),d=d.next;if(d===null)continue;y=d}f.push(y),v=y,d=y.next}if(d!==null||g!==void 0){for(var W=g===void 0?[]:et(g);d!==null;)d.e.f&we||W.push(d),d=d.next;var ee=W.length;if(ee>0){var re=c===0?t:null;Ft(e,W,re,u)}}Ae.first=e.first&&e.first.e,Ae.last=v&&v.e}function Yt(a,e,t,s){bt(a.v,e),a.i=t}function ot(a,e,t,s,i,r,o,c,u,h){var d=(u&Lt)!==0,g=(u&zt)===0,v=d?g?wt(i):qe(i):i,f=u&Et?qe(o):o,_={i:f,v,k:r,a:null,e:null,prev:t,next:s};try{return _.e=$e(()=>c(a,v,f,h),O),_.e.prev=t&&t.e,_.e.next=s&&s.e,t===null?e.first=_:(t.next=_,t.e.next=_.e),s!==null&&(s.prev=_,s.e.prev=_.e),_}finally{}}function Ke(a,e,t){for(var s=a.next?a.next.e.nodes_start:t,i=e?e.e.nodes_start:t,r=a.e.nodes_start;r!==s;){var o=Mt(r);i.before(r),r=o}}function P(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function R(a){if(O){var e=!1,t=()=>{if(!e){if(e=!0,a.hasAttribute("value")){var s=a.value;j(a,"value",null),a.value=s}if(a.hasAttribute("checked")){var i=a.checked;j(a,"checked",null),a.checked=i}}};a.__on_r=t,Dt(t),rt()}}function j(a,e,t,s){var i=a.__attributes??(a.__attributes={});O&&(i[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="style"&&"__styles"in a&&(a.__styles={}),e==="loading"&&(a[Ot]=t),t==null?a.removeAttribute(e):typeof t!="string"&&qt(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var Je=new Map;function qt(a){var e=Je.get(a.nodeName);if(e)return e;Je.set(a.nodeName,e=[]);for(var t,s=a,i=Element.prototype;i!==s;){t=Gt(s);for(var r in t)t[r].set&&e.push(r);s=Ct(s)}return e}function Ie(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function J(a,e,t=e){var s=Rt();nt(a,"input",i=>{var r=i?a.defaultValue:a.value;if(r=Te(a)?Ee(r):r,t(r),s&&r!==(r=e())){var o=a.selectionStart,c=a.selectionEnd;a.value=r??"",c!==null&&(a.selectionStart=o,a.selectionEnd=Math.min(c,a.value.length))}}),(O&&a.defaultValue!==a.value||tt(e)==null&&a.value)&&t(Te(a)?Ee(a.value):a.value),at(()=>{var i=e();Te(a)&&i===Ee(a.value)||a.type==="date"&&!i&&!a.value||i!==a.value&&(a.value=i??"")})}function Qe(a,e,t=e){nt(a,"change",s=>{var i=s?a.defaultChecked:a.checked;t(i)}),(O&&a.defaultChecked!==a.checked||tt(e)==null)&&t(a.checked),at(()=>{var s=e();a.checked=!!s})}function Te(a){var e=a.type;return e==="number"||e==="range"}function Ee(a){return a===""?null:+a}var E,F,Q,ie,U,C,V;const ve=class ve{constructor(e,t={},s=e){A(this,E);A(this,F);A(this,Q);A(this,ie);A(this,U);A(this,C,{x:0,y:0});A(this,V,{x:0,y:0});if(ve.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");D(this,Q,e),D(this,E,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),D(this,F,s),this.loadImg()}async loadImg(){if(l(this,U))return l(this,U);const e=document.createElement("img");return D(this,U,new Promise(t=>{e.addEventListener("load",()=>{D(this,C,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=l(this,Q),D(this,ie,e),l(this,U)}get img(){return l(this,ie)}get src(){return l(this,Q)}get id(){return l(this,F)}get dimensions(){return structuredClone(l(this,C))}get settings(){return l(this,E)}set settings(e){D(this,E,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:l(this,E).startOffset.x+(l(this,E).tileSize.x+l(this,E).tileGap.x)*(t%l(this,V).x),y:l(this,E).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/l(this,V).x),w:l(this,E).tileSize.x,h:l(this,E).tileSize.y}}createTiles(e){let t=0;const s=[];let i=0,r=0;for(let o=l(this,E).startOffset.y;o<l(this,C).y&&o+l(this,E).tileSize.y<=l(this,C).y;o+=l(this,E).tileSize.y+l(this,E).tileGap.y){i=0;for(let c=l(this,E).startOffset.x;c<l(this,C).x&&c+l(this,E).tileSize.x<=l(this,C).x;c+=l(this,E).tileSize.x+l(this,E).tileGap.x)s.push({type:"basic",id:e++,atlasId:l(this,F),indexInAtlas:t++,name:`${l(this,F)}_${t}`}),i++;r++}return l(this,V).x=i,l(this,V).y=r,s}};E=new WeakMap,F=new WeakMap,Q=new WeakMap,ie=new WeakMap,U=new WeakMap,C=new WeakMap,V=new WeakMap,je(ve,"existingIDs",new Set);let ke=ve;var N,B,Z,$,Y,le;class Xt{constructor(e,t,s,i){A(this,N);A(this,B);A(this,Z);A(this,$,new Map);A(this,Y,new Map);A(this,le,new Map);D(this,N,e),D(this,B,t),D(this,Z,i),this.setAtlantes(s),l(this,le).set("basic",this.drawBasicTile)}setAtlantes(e){for(let s of e)l(this,Y).set(s.id,s);l(this,$).clear();let t=1;for(let s of l(this,Y).values()){let i=s.createTiles(t);t+=i.length,i.forEach(r=>l(this,$).set(r.id,r))}}async loadAtlantes(){const e=[];for(let t of l(this,Y).values())e.push(t.loadImg());await Promise.all(e)}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<l(this,N).x;t++)for(let s=0;s<l(this,N).y;s++){const i=this.getTile(t,s);i&&(i.type=="basic"?l(this,le).get("basic").call(this,e,i,s,t):i.type)}}getTile(e,t){return l(this,$).get(l(this,Z)[t*l(this,N).x+e])}setTile(e,t,s){let i=typeof s=="number"?s:s.id;l(this,Z)[t*l(this,N).x+e]=i}drawBasicTile(e,t,s,i){const r=l(this,Y).get(t.atlasId);let{x:o,y:c,w:u,h}=r.getTilePosition(t.indexInAtlas);e.drawImage(r.img,o,c,u,h,l(this,B).x*i,l(this,B).y*s,l(this,B).x,l(this,B).y)}}N=new WeakMap,B=new WeakMap,Z=new WeakMap,$=new WeakMap,Y=new WeakMap,le=new WeakMap;var Kt=fe('<fieldset class="atlas-display svelte-ejh76h"><img class="img-preview svelte-ejh76h" alt=""> <div class="canvas-wrapper svelte-ejh76h"><canvas></canvas> <canvas class="canvas-overlay svelte-ejh76h"></canvas></div> <div class="settings-wrapper svelte-ejh76h"><fieldset><legend>Tile Size</legend> <label>width <input type="number" min="0" class="svelte-ejh76h"></label> <label>height <input type="number" min="0" class="svelte-ejh76h"></label></fieldset> <fieldset><legend>Tile Gap</legend> <label>width <input type="number" class="svelte-ejh76h"></label> <label>height <input type="number" class="svelte-ejh76h"></label></fieldset> <fieldset><legend>Offset</legend> <label>width <input type="number" class="svelte-ejh76h"></label> <label>height <input type="number" width="5" class="svelte-ejh76h"></label></fieldset> <fieldset><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label></fieldset></div></fieldset>');function Jt(a,e){he(e,!0);let t=Se(e,"atlas",15),s,i,r,o,c=[],u=new Set,h,d=oe(!0),g=oe(!0);se(()=>{r.addEventListener("click",()=>{e.activate(t())}),i.addEventListener("pointermove",v),i.addEventListener("pointerleave",f),i.addEventListener("pointerup",_),i.addEventListener("contextmenu",n=>n.preventDefault()),o=i.getContext("2d")}),se(()=>{const n=s.getContext("2d");n.clearRect(0,0,s.width,s.height),n.drawImage(t().img,0,0),n.lineWidth=1,n.strokeStyle="rgba(0, 0, 0, 0.5)",n.textAlign="right",c=t().createTiles(1);for(let b of c){let{x:z,y:M,w:G,h:ne}=t().getTilePosition(b);I(g)&&n.strokeRect(z,M,G,ne),I(d)&&n.fillText(b.id.toString(),z+G-1,M+ne-1,G)}});function v(n){const b=k(n);if(!b)return f();h=b,x()}function f(){h=void 0,x()}function _(n){const b=k(n);b&&(n.ctrlKey?u.has(b)?u.delete(b):u.add(b):(u.clear(),u.add(b)),x())}function x(){if(o.clearRect(0,0,i.width,i.height),h){o.fillStyle="rgba(255, 255, 255, 0.5)";let{x:n,y:b,w:z,h:M}=t().getTilePosition(h);o.fillRect(n,b,z,M)}for(let n of u.values()){o.strokeStyle="rgba(255, 0, 0, 1)",o.lineWidth=1;let{x:b,y:z,w:M,h:G}=t().getTilePosition(n);o.strokeRect(b,z,M,G)}}function k(n){const b=i.getBoundingClientRect(),z=n.clientX-b.left,M=n.clientY-b.top;return y(z,M)}function y(n,b){for(let z of c){let{x:M,y:G,w:ne,h:dt}=t().getTilePosition(z);if(n>M&&n<M+ne&&b>G&&b<G+dt)return z}}var T=Kt(),H=w(T),L=p(H,2),S=w(L);q(S,n=>s=n,()=>s);var X=p(S,2);q(X,n=>i=n,()=>i),m(L);var K=p(L,2),W=w(K),ee=p(w(W),2),re=p(w(ee));R(re),m(ee);var Le=p(ee,2),ze=p(w(Le));R(ze),m(Le),m(W);var ge=p(W,2),_e=p(w(ge),2),Me=p(w(_e));R(Me),m(_e);var De=p(_e,2),Oe=p(w(De));R(Oe),m(De),m(ge);var pe=p(ge,2),ye=p(w(pe),2),Ce=p(w(ye));R(Ce),m(ye);var Ge=p(ye,2),Re=p(w(Ge));R(Re),m(Ge),m(pe);var Pe=p(pe,2),me=p(w(Pe),2),Ne=p(w(me));R(Ne),m(me);var Be=p(me,2),He=p(w(Be));R(He),m(Be),m(Pe),m(K),m(T),q(T,n=>r=n,()=>r),st(()=>{Ie(T,"active",e.active),j(H,"src",t().src),j(S,"width",t().img.naturalWidth),j(S,"height",t().img.naturalHeight),j(X,"width",t().img.naturalWidth),j(X,"height",t().img.naturalHeight)}),J(re,()=>t().settings.tileSize.x,n=>t(t().settings.tileSize.x=n,!0)),J(ze,()=>t().settings.tileSize.y,n=>t(t().settings.tileSize.y=n,!0)),J(Me,()=>t().settings.tileGap.x,n=>t(t().settings.tileGap.x=n,!0)),J(Oe,()=>t().settings.tileGap.y,n=>t(t().settings.tileGap.y=n,!0)),J(Ce,()=>t().settings.startOffset.x,n=>t(t().settings.startOffset.x=n,!0)),J(Re,()=>t().settings.startOffset.y,n=>t(t().settings.startOffset.y=n,!0)),Qe(Ne,()=>I(d),n=>ae(d,n)),Qe(He,()=>I(g),n=>ae(g,n)),ce(a,T),ue()}var Qt=fe('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function Zt(a,e){he(e,!0);let t,s=Se(e,"atlantes",27,()=>de([])),i=Se(e,"activeAtlas",15);async function r(g){if(t.files)for(let v of t.files){let f=await o(v),_=de({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const x=new ke(f,_,Math.random().toString());await x.loadImg(),s().push(x),i(x)}}async function o(g){return new Promise(v=>{const f=new FileReader;f.onload=()=>v(f.result),f.readAsDataURL(g)})}function c(g){i(g)}var u=Qt(),h=it(u);h.__change=r,q(h,g=>t=g,()=>t);var d=p(h,2);Ut(d,21,s,jt,(g,v)=>{const f=Pt(()=>i()==I(v));Jt(g,{get atlas(){return I(v)},activate:c,get active(){return I(f)}})}),m(d),ce(a,u),ue()}lt(["change"]);var $t=fe('<button>update</button> <canvas width="500" height="500"></canvas>',1);function ea(a,e){he(e,!0);let t,s;Ht(()=>{s=t.getContext("2d")}),se(()=>{e.map.render(s)});function i(){e.map.render(s)}var r=$t(),o=it(r);o.__click=i;var c=p(o,2);q(c,u=>t=u,()=>t),ce(a,r),ue()}lt(["click"]);var ta=fe('<div id="outer-wrapper" class="svelte-1a6ydla"><h1 class="svelte-1a6ydla"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1a6ydla"><div class="tab svelte-1a6ydla" id="tab-atlas"><h2 class="svelte-1a6ydla">Tile Atlas</h2> <div class="tab-content svelte-1a6ydla"><!></div></div> <div class="tab shown svelte-1a6ydla" id="tab-sheet"><h2 class="svelte-1a6ydla">Tile Sheet</h2> <div class="tab-content svelte-1a6ydla"></div></div> <div class="tab svelte-1a6ydla" id="tab-map"><h2 class="svelte-1a6ydla">Tile Map</h2> <div class="tab-content svelte-1a6ydla"><!></div></div></div></div>');function oa(a,e){he(e,!0);let t=oe(de([])),s,i=oe(!0),r;se(()=>{s.addEventListener("pointerup",()=>{ae(i,!0)}),r.addEventListener("pointerup",()=>{ae(i,!1)})});let o=new Xt({x:5,y:5},{x:64,y:64},[],[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);se(()=>{o.setAtlantes(I(t))});var c=ta();Bt(x=>{Nt.title="FUDGE Tilemap Editor"});var u=p(w(c),2),h=w(u),d=p(w(h),2),g=w(d);Zt(g,{get atlantes(){return I(t)},set atlantes(x){ae(t,de(x))}}),m(d),m(h),q(h,x=>s=x,()=>s);var v=p(h,4),f=p(w(v),2),_=w(f);ea(_,{map:o}),m(f),m(v),q(v,x=>r=x,()=>r),m(u),m(c),st(()=>{Ie(h,"shown",I(i)),Ie(v,"shown",!I(i))}),ce(a,c),ue()}export{oa as component};
