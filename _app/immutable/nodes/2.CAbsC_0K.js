var Gt=Object.defineProperty;var gt=i=>{throw TypeError(i)};var Bt=(i,e,t)=>e in i?Gt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var W=(i,e,t)=>Bt(i,typeof e!="symbol"?e+"":e,t),yt=(i,e,t)=>e.has(i)||gt("Cannot "+t);var d=(i,e,t)=>(yt(i,e,"read from private field"),t?t.call(i):e.get(i)),K=(i,e,t)=>e.has(i)?gt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),Y=(i,e,t,s)=>(yt(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t);import{t as fe,a as ue}from"../chunks/BwxUIiUG.js";import{s as xt,g as pt,j as Vt,k as lt,l as Wt,b as Yt,q as Qe,h as ee,r as qt,v as Ht,Q as m,ai as Ut,a7 as Xt,a8 as _t,p as Ze,c as Be,w as Kt,a9 as kt,a as Et,aa as Jt,at as et,A as zt,af as Qt,a0 as bt,i as Zt,au as ft,av as ei,z as ti,aw as ii,d as si,ax as vt,ay as ai,o as li,az as At,ad as ni,aA as wt,aB as ri,aC as oi,aD as ci,a6 as ui,aE as di,aF as fi,G as He,ac as Ft,C as Pe,Y as y,V as Ne,F as Le,W as E,X as S,ar as te,a3 as Z,f as It,S as vi,J as nt,aG as hi}from"../chunks/DsVg9zyT.js";import{d as je,s as rt,a as gi}from"../chunks/CSUlgdZ8.js";import{p as Me,a as O,s as ye,c as yi,d as Ve,b as ie,e as Ge,i as Ct,m as xi}from"../chunks/D1FPw6M6.js";import{w as Mt,o as Ke,g as Dt}from"../chunks/BPnQOLfX.js";let mt=!1;function Pt(){mt||(mt=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function pi(i){var e=Vt,t=lt;xt(null),pt(null);try{return i()}finally{xt(e),pt(t)}}function Lt(i,e,t,s=t){i.addEventListener(e,()=>pi(t));const a=i.__on_r;a?i.__on_r=()=>{a(),s(!0)}:i.__on_r=()=>s(!0),Pt()}function _i(i,e){return e}function bi(i,e,t,s){for(var a=[],l=e.length,o=0;o<l;o++)ei(e[o].e,a,!0);var u=l>0&&a.length===0&&t!==null;if(u){var f=t.parentNode;ti(f),f.append(t),s.clear(),_e(i,e[0].prev,e[l-1].next)}ii(a,()=>{for(var C=0;C<l;C++){var g=e[C];u||(s.delete(g.k),_e(i,g.prev,g.next)),si(g.e,!u)}})}function ot(i,e,t,s,a,l=null){var o=i,u={flags:e,items:new Map,first:null},f=(e&At)!==0;if(f){var C=i;o=ee?Qe(qt(C)):C.appendChild(Wt())}ee&&Ht();var g=null,_=!1,v=Ut(()=>{var b=t();return Zt(b)?b:b==null?[]:zt(b)});Yt(()=>{var b=m(v),r=b.length;if(_&&r===0)return;_=r===0;let k=!1;if(ee){var z=o.data===Xt;z!==(r===0)&&(o=_t(),Qe(o),Ze(!1),k=!0)}if(ee){for(var L=null,$,P=0;P<r;P++){if(Be.nodeType===8&&Be.data===Kt){o=Be,k=!0,Ze(!1);break}var T=b[P],F=s(T,P);$=$t(Be,u,L,null,T,F,P,a,e,t),u.items.set(F,$),L=$}r>0&&Qe(_t())}ee||wi(b,u,o,a,e,s,t),l!==null&&(r===0?g?kt(g):g=Et(()=>l(o)):g!==null&&Jt(g,()=>{g=null})),k&&Ze(!0),m(v)}),ee&&(o=Be)}function wi(i,e,t,s,a,l,o){var A,R,ae,se;var u=(a&ri)!==0,f=(a&(vt|ft))!==0,C=i.length,g=e.items,_=e.first,v=_,b,r=null,k,z=[],L=[],$,P,T,F;if(u)for(F=0;F<C;F+=1)$=i[F],P=l($,F),T=g.get(P),T!==void 0&&((A=T.a)==null||A.measure(),(k??(k=new Set)).add(T));for(F=0;F<C;F+=1){if($=i[F],P=l($,F),T=g.get(P),T===void 0){var B=v?v.e.nodes_start:t;r=$t(B,e,r,r===null?e.first:r.next,$,P,F,s,a,o),g.set(P,r),z=[],L=[],v=r.next;continue}if(f&&mi(T,$,F,a),T.e.f&et&&(kt(T.e),u&&((R=T.a)==null||R.unfix(),(k??(k=new Set)).delete(T))),T!==v){if(b!==void 0&&b.has(T)){if(z.length<L.length){var X=L[0],V;r=X.prev;var q=z[0],Q=z[z.length-1];for(V=0;V<z.length;V+=1)St(z[V],X,t);for(V=0;V<L.length;V+=1)b.delete(L[V]);_e(e,q.prev,Q.next),_e(e,r,q),_e(e,Q,X),v=X,r=Q,F-=1,z=[],L=[]}else b.delete(T),St(T,v,t),_e(e,T.prev,T.next),_e(e,T,r===null?e.first:r.next),_e(e,r,T),r=T;continue}for(z=[],L=[];v!==null&&v.k!==P;)v.e.f&et||(b??(b=new Set)).add(v),L.push(v),v=v.next;if(v===null)continue;T=v}z.push(T),r=T,v=T.next}if(v!==null||b!==void 0){for(var I=b===void 0?[]:zt(b);v!==null;)v.e.f&et||I.push(v),v=v.next;var M=I.length;if(M>0){var j=a&At&&C===0?t:null;if(u){for(F=0;F<M;F+=1)(ae=I[F].a)==null||ae.measure();for(F=0;F<M;F+=1)(se=I[F].a)==null||se.fix()}bi(e,I,j,g)}}u&&ni(()=>{var H;if(k!==void 0)for(T of k)(H=T.a)==null||H.apply()}),lt.first=e.first&&e.first.e,lt.last=r&&r.e}function mi(i,e,t,s){s&vt&&wt(i.v,e),s&ft?wt(i.i,t):i.i=t}function $t(i,e,t,s,a,l,o,u,f,C){var g=(f&vt)!==0,_=(f&ai)===0,v=g?_?Qt(a):bt(a):a,b=f&ft?bt(o):o,r={i:b,v,k:l,a:null,e:null,prev:t,next:s};try{return r.e=Et(()=>u(i,v,b,C),ee),r.e.prev=t&&t.e,r.e.next=s&&s.e,t===null?e.first=r:(t.next=r,t.e.next=r.e),s!==null&&(s.prev=r,s.e.prev=r.e),r}finally{}}function St(i,e,t){for(var s=i.next?i.next.e.nodes_start:t,a=e?e.e.nodes_start:t,l=i.e.nodes_start;l!==s;){var o=li(l);a.before(l),l=o}}function _e(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function De(i){if(ee){var e=!1,t=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var s=i.value;We(i,"value",null),i.value=s}if(i.hasAttribute("checked")){var a=i.checked;We(i,"checked",null),i.checked=a}}};i.__on_r=t,oi(t),Pt()}}function We(i,e,t,s){var a=i.__attributes??(i.__attributes={});ee&&(a[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||a[e]!==(a[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[ci]=t),t==null?i.removeAttribute(e):typeof t!="string"&&Si(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var Tt=new Map;function Si(i){var e=Tt.get(i.nodeName);if(e)return e;Tt.set(i.nodeName,e=[]);for(var t,s=i,a=Element.prototype;a!==s;){t=di(s);for(var l in t)t[l].set&&e.push(l);s=ui(s)}return e}function Ti(i,e,t){var s=i.__className,a=ki(e);ee&&i.className===a?i.__className=a:(s!==a||ee&&i.className!==a)&&(e==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function ki(i,e){return(i??"")+""}function ct(i,e,t){if(t){if(i.classList.contains(e))return;i.classList.add(e)}else{if(!i.classList.contains(e))return;i.classList.remove(e)}}function Ei(i,e,t,s){var a=i.__styles??(i.__styles={});a[e]!==t&&(a[e]=t,t==null?i.style.removeProperty(e):i.style.setProperty(e,t,""))}function ut(i,e,t=e){var s=fi();Lt(i,"input",a=>{var l=a?i.defaultValue:i.value;if(l=tt(i)?it(l):l,t(l),s&&l!==(l=e())){var o=i.selectionStart,u=i.selectionEnd;i.value=l??"",u!==null&&(i.selectionStart=o,i.selectionEnd=Math.min(u,i.value.length))}}),(ee&&i.defaultValue!==i.value||He(e)==null&&i.value)&&t(tt(i)?it(i.value):i.value),Ft(()=>{var a=e();tt(i)&&a===it(i.value)||i.type==="date"&&!a&&!i.value||a!==i.value&&(i.value=a??"")})}function Ue(i,e,t=e){Lt(i,"change",s=>{var a=s?i.defaultChecked:i.checked;t(a)}),(ee&&i.defaultChecked!==i.checked||He(e)==null)&&t(i.checked),Ft(()=>{var s=e();i.checked=!!s})}function tt(i){var e=i.type;return e==="number"||e==="range"}function it(i){return i===""?null:+i}const de=Mt([]),ke=Mt();var me=(i=>(i[i.UNSET=0]="UNSET",i[i.SAME=1]="SAME",i[i.DIFFERENT=2]="DIFFERENT",i))(me||{}),G,Ee,Re,qe,ze,he,be,Oe;const Xe=class Xe{constructor(e,t={},s=e){K(this,G);K(this,Ee);K(this,Re);K(this,qe);K(this,ze);K(this,he,{x:0,y:0});K(this,be,{x:0,y:0});K(this,Oe);if(Xe.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");Y(this,Re,e),Y(this,G,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),Y(this,Ee,s),this.loadImg()}async loadImg(){if(d(this,ze))return d(this,ze);const e=document.createElement("img");return Y(this,ze,new Promise(t=>{e.addEventListener("load",()=>{Y(this,he,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=d(this,Re),Y(this,qe,e),d(this,ze)}get img(){return d(this,qe)}get src(){return d(this,Re)}get id(){return d(this,Ee)}get dimensions(){return structuredClone(d(this,he))}get tileAmount(){return structuredClone(d(this,be))}get settings(){return d(this,G)}set settings(e){Y(this,G,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:d(this,G).startOffset.x+(d(this,G).tileSize.x+d(this,G).tileGap.x)*(t%d(this,be).x),y:d(this,G).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/d(this,be).x),w:d(this,G).tileSize.x,h:d(this,G).tileSize.y}}createTiles(){if(d(this,G).tileSize.x<1||d(this,G).tileSize.y<1)return[];let e=0,t=0;const s=[];let a=0,l=0;for(let o=d(this,G).startOffset.y;o<d(this,he).y&&o+d(this,G).tileSize.y<=d(this,he).y;o+=d(this,G).tileSize.y+d(this,G).tileGap.y){a=0;for(let u=d(this,G).startOffset.x;u<d(this,he).x&&u+d(this,G).tileSize.x<=d(this,he).x;u+=d(this,G).tileSize.x+d(this,G).tileGap.x)s.push({type:"basic",id:e++,atlasId:d(this,Ee),indexInAtlas:t++,name:`${d(this,Ee)}_${t}`}),a++;l++}return d(this,be).x=a,d(this,be).y=l,Y(this,Oe,[...s]),s}getTiles(){return d(this,Oe)||this.createTiles(),d(this,Oe)}};G=new WeakMap,Ee=new WeakMap,Re=new WeakMap,qe=new WeakMap,ze=new WeakMap,he=new WeakMap,be=new WeakMap,Oe=new WeakMap,W(Xe,"existingIDs",new Set);let dt=Xe;var Ae,Fe,ce;class zi{constructor(e,t){K(this,Ae,[]);K(this,Fe,{x:20,y:20});K(this,ce,{x:64,y:64});this.mapSize=e,this.tileSize=t}get mapSize(){return d(this,Fe)}set mapSize(e){Y(this,Fe,e)}get tileSize(){return d(this,ce)}set tileSize(e){Y(this,ce,e)}setTile(e,t){d(this,Ae)[t.y]||(d(this,Ae)[t.y]=[]),d(this,Ae)[t.y][t.x]=e}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<d(this,Fe).y;t++)for(let s=0;s<d(this,Fe).x;s++){const a=this.getTile({x:s,y:t});if(!a)continue;const l={x:d(this,ce).x*s,y:d(this,ce).y*t};a.type==="basic"?U.drawTile(a,e,l,d(this,ce)):a.type==="rule"&&(U.drawTile(a.default,e,l,d(this,ce)),this.drawRuleOverlay(e,l,d(this,ce)))}}getTile(e){var t;return(t=d(this,Ae)[e.y])==null?void 0:t[e.x]}drawRuleOverlay(e,t,s){e.strokeStyle="white",e.fillStyle="black",e.font=`bold ${s.y*.8}px sans-serif`,e.strokeText("⚙",t.x+1,t.y+s.y-1,s.x),e.fillText("⚙",t.x+1,t.y+s.y-1,s.x)}}Ae=new WeakMap,Fe=new WeakMap,ce=new WeakMap;var ge,we,Ie;class Ai{constructor(e,t,s){K(this,ge);K(this,we);K(this,Ie);Y(this,ge,e),Y(this,we,t),Y(this,Ie,s.map(a=>typeof a=="number"?U.getTile(a):a))}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<d(this,ge).x;t++)for(let s=0;s<d(this,ge).y;s++){let a=this.getTile(t,s);a&&(a.type==="rule"&&(a=this.getTileToDrawFromRuleTile(a,{x:t,y:s})),U.drawTile(a,e,{x:d(this,we).x*t,y:d(this,we).y*s},d(this,we)))}}getTile(e,t){return d(this,Ie)[t*d(this,ge).x+e]}setTile(e,t,s){d(this,Ie)[t*d(this,ge).x+e]=s}reset(){Y(this,Ie,[])}set tileSize(e){Y(this,we,e)}set mapSize(e){Y(this,ge,e)}getTileToDrawFromRuleTile(e,t){e:for(let s of e.rules){const a=Math.sqrt(s.neighborFilter.length),l=Math.floor(a/2);for(let o=0;o<a;o++)for(let u=0;u<a;u++)if(!this.checkRule(s.neighborFilter[o*a+u],{x:t.x+u-l,y:t.y+o-l},e.id))continue e;return s.tile}return e.default}checkRule(e,t,s){if(e===0)return!0;const a=this.getTile(t.x,t.y);return!!(e===1&&a&&a.id===s||e===2&&(!a||a.id!==s))}}ge=new WeakMap,we=new WeakMap,Ie=new WeakMap;const J=class J{constructor(){if(J.Instance)return J.Instance;J.renderMethod.set("basic",J.drawBasicTile)}static setAtlantes(e){this.atlantes.clear();for(const t of e)this.atlantes.set(t.id,t);this.recalculateTileIds()}static recalculateTileIds(){let e=1;const t=new Map;for(let s of this.atlantes.values())s.getTiles().forEach(l=>{l.id=e++,t.set(l.id,l)});for(let s of this.tileIndex.values())s.type!=="basic"&&(s.id=t.size+1,t.set(s.id,s));this.tileIndex=t}static addTile(e){this.tileIndex.set(e.id,e)}static newTile(e,t=""){console.log("new tile");let s=this.tileIndex.size;for(;this.tileIndex.has(s);)s++;let a={type:e,default:void 0,id:s,name:t,rules:[]};return this.addTile(a),a}static getTile(e){return this.tileIndex.get(e)}};W(J,"renderMethod",new Map),W(J,"atlantes",new Map),W(J,"tileIndex",new Map),W(J,"drawTile",(e,t,s,a)=>{e&&J.drawBasicTile(e,t,s,a)}),W(J,"drawBasicTile",(e,t,s,a)=>{const l=J.atlantes.get(e.atlasId);if(!l){t.fillStyle="red",t.textAlign="center",t.font=`bold ${a.y*.8}px sans-serif`,t.fillText("!",s.x+.5*a.x,s.y+a.y*.8,a.x),console.error(`Atlas "${e.atlasId}" not found.`);return}let{x:o,y:u,w:f,h:C}=l.getTilePosition(e.indexInAtlas);t.drawImage(l.img,o,u,f,C,s.x,s.y,a.x,a.y)}),W(J,"Instance",new J);let U=J;class ht extends EventTarget{constructor(t){super();W(this,"canvas");W(this,"ctx");W(this,"translation",{x:0,y:0});W(this,"scale",1);W(this,"scaleSettings",{factor:2,min:1/16,max:16});W(this,"syncedCtx",new Set);W(this,"pointerdown",t=>{switch(t.button){}this.dispatchEventFromEvent(t),t.preventDefault()});W(this,"pointermove",t=>{t.preventDefault();const s=this.getButtonsFromEvent(t);s.includes(0),s.includes(1),s.includes(2)&&(this.translation.x+=t.movementX,this.translation.y+=t.movementY,this.draw()),this.dispatchEventFromEvent(t)});W(this,"pointerup",t=>{switch(this.dispatchEventFromEvent(t),t.button){}t.preventDefault()});W(this,"zoom",t=>{t.preventDefault();const s=this.canvasPosFromMousePos({x:t.clientX,y:t.clientY},!1),a=-Math.sign(t.deltaY),l=this.scale,o=Math.min(this.scaleSettings.max,Math.max(this.scaleSettings.min,this.scale*Math.pow(this.scaleSettings.factor,a))),u=o/l;this.translation.x=s.x+(this.translation.x-s.x)*u,this.translation.y=s.y+(this.translation.y-s.y)*u,this.scale=o,this.draw()});this.canvas=t,this.ctx=t.getContext("2d"),this.installListeners();const s=t.getBoundingClientRect();t.width=s.width,t.height=s.height,this.syncedCtx.add(this.ctx)}installListeners(){this.canvas.addEventListener("pointerdown",this.pointerdown),this.canvas.addEventListener("pointermove",this.pointermove),this.canvas.addEventListener("pointerup",this.pointerup),this.canvas.addEventListener("wheel",this.zoom),this.canvas.addEventListener("contextmenu",t=>t.preventDefault())}getButtonsFromEvent(t){const s=[];for(let a=0;a<5;a++)t.buttons&1<<a&&s.push(a);return s}dispatchEventFromEvent(t){const s=this.canvasPosFromMousePos({x:t.clientX,y:t.clientY},!0);this.dispatchEvent(new CustomEvent(t.type,{detail:{pos:s,event:t}}))}canvasPosFromMousePos(t,s){const a=this.canvas.getBoundingClientRect(),l={x:t.x-a.left,y:t.y-a.top};return s&&(l.x=(l.x-this.translation.x)/this.scale,l.y=(l.y-this.translation.y)/this.scale),l}draw(){for(let t of this.syncedCtx.values())t.clearRect(0,0,t.canvas.width,t.canvas.height),t.reset(),t.translate(this.translation.x,this.translation.y),t.scale(this.scale,this.scale);this.dispatchEvent(new CustomEvent("draw"))}reset(){this.scale=1,this.translation.x=0,this.translation.y=0,this.draw()}addCtxToSync(t){this.syncedCtx.add(t)}}var Fi=fe('<fieldset class="svelte-mlfuo7"><legend> </legend> <label>width <input type="number" min="0" class="svelte-mlfuo7"></label> <label>height <input type="number" min="0" class="svelte-mlfuo7"></label></fieldset>');function Ce(i,e){Pe(e,!0);let t=Me(e,"vector",31,()=>O({x:0,y:0}));var s=Fi(),a=E(s),l=E(a,!0);S(a);var o=y(a,2),u=y(E(o));De(u),u.__change=function(...g){var _;(_=e.change)==null||_.apply(this,g)},S(o);var f=y(o,2),C=y(E(f));De(C),C.__change=function(...g){var _;(_=e.change)==null||_.apply(this,g)},S(f),S(s),Ne(()=>rt(l,e.legend)),ut(u,()=>t().x,g=>t(t().x=g,!0)),ut(C,()=>t().y,g=>t(t().y=g,!0)),ue(i,s),Le()}je(["change"]);function Nt(i,e){const t={lineWidth:1,style:"rgba(0, 0, 0, 1)",tileAmount:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:0,y:0},...e};i.strokeStyle=t.style,i.lineWidth=t.lineWidth;const s=new Path2D;for(let a=0;a<t.tileAmount.y;a++)for(let l=0;l<t.tileAmount.x;l++)s.moveTo(l*t.tileSize.x,a*t.tileSize.y+t.tileSize.y),s.lineTo(l*t.tileSize.x,a*t.tileSize.y),s.lineTo(l*t.tileSize.x+t.tileSize.x,a*t.tileSize.y);s.moveTo(0,t.tileAmount.y*t.tileSize.y),s.lineTo(t.tileAmount.x*t.tileSize.x,t.tileAmount.y*t.tileSize.y),s.lineTo(t.tileAmount.x*t.tileSize.x,0),i.stroke(s)}function Ye(i,e){i.width=e.clientWidth,i.height=e.clientHeight}var Ii=(i,e,t)=>{e.remove(t())},Ci=fe('<fieldset class="atlas-display svelte-kpjacb"><img class="img-preview svelte-kpjacb" alt=""> <div class="canvas-wrapper svelte-kpjacb"><canvas></canvas> <canvas class="canvas-overlay svelte-kpjacb"></canvas></div> <div class="settings-wrapper svelte-kpjacb"><!> <!> <!> <fieldset class="svelte-kpjacb"><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset> <fieldset class="svelte-kpjacb"><legend>Danger Zone</legend> <button>Remove</button></fieldset></div></fieldset>');function Mi(i,e){Pe(e,!0);const[t,s]=Ge(),a=()=>Ve(de,"$selectedTilesAtlas",t);let l=Me(e,"atlas",15),o,u,f,C,g,_,v,b=[],r=new Set,k,z=te(!1),L=te(!0);Ke(()=>{C.addEventListener("click",()=>{e.active||(e.activate(l()),$())}),v=new ht(f),v.addEventListener("draw",P),v.addEventListener("pointermove",T),v.addEventListener("pointerup",B),f.addEventListener("pointerleave",F),g=f.getContext("2d"),_=u.getContext("2d"),v.addCtxToSync(_),Q(),v.draw()});function $(){if(r.size==0)return ye(de,[]),v.draw();const w=l().tileAmount,c={x:1/0,y:1/0},h={x:-1/0,y:-1/0};r.forEach(p=>{const N={x:p.indexInAtlas%w.x,y:Math.floor(p.indexInAtlas/w.x)};c.x>N.x&&(c.x=N.x),c.y>N.y&&(c.y=N.y),h.x<N.x&&(h.x=N.x),h.y<N.y&&(h.y=N.y)}),ye(de,Array.from({length:h.y-c.y+1},()=>[])),r.forEach(p=>{const N={x:p.indexInAtlas%w.x-c.x,y:Math.floor(p.indexInAtlas/w.x)-c.y};yi(de,He(a)[N.y][N.x]=p,He(a))}),v.draw()}function P(){_.imageSmoothingEnabled=!1,_.drawImage(l().img,0,0),_.lineWidth=1,_.strokeStyle="rgba(0, 0, 0, 0.5)",_.textAlign="right",b=l().getTiles();for(let w of b){let{x:c,y:h,w:p,h:N}=l().getTilePosition(w);m(L)&&_.strokeRect(c,h,p,N),m(z)&&_.fillText(w.id.toString(),c+p-1,h+N-1,p)}X()}function T(w){const c=V(w.detail.pos.x,w.detail.pos.y);if(!c)return F();k=c,v.draw()}function F(){k=void 0,v.draw()}function B(w){if(w.detail.event.button!==0)return;const c=V(w.detail.pos.x,w.detail.pos.y);if(!c)return r.clear(),$();w.detail.event.ctrlKey?r.has(c)?r.delete(c):r.add(c):r.has(c)&&r.size===1?r.clear():(r.clear(),r.add(c)),$()}function X(){if(k){g.fillStyle="rgba(255, 255, 255, 0.5)";let{x:w,y:c,w:h,h:p}=l().getTilePosition(k);g.fillRect(w,c,h,p)}for(let w of r.values()){g.strokeStyle="rgba(255, 0, 0, 1)",g.fillStyle="rgba(255, 0, 0, 0.25)",g.lineWidth=1;let{x:c,y:h,w:p,h:N}=l().getTilePosition(w);g.fillRect(c,h,p,N),g.strokeRect(c,h,p,N)}}function V(w,c){for(let h of b){let{x:p,y:N,w:Je,h:jt}=l().getTilePosition(h);if(w>p&&w<p+Je&&c>N&&c<N+jt)return h}}function q(){l().createTiles(),v.draw()}function Q(){Ye(u,o),Ye(f,o)}function I(){Q(),v.reset()}var M=Ci(),j=E(M),A=y(j,2),R=E(A);ie(R,w=>u=w,()=>u);var ae=y(R,2);ie(ae,w=>f=w,()=>f),S(A),ie(A,w=>o=w,()=>o);var se=y(A,2),H=E(se);Ce(H,{legend:"Tile Size",change:q,get vector(){return l().settings.tileSize},set vector(w){l(l().settings.tileSize=w,!0)}});var xe=y(H,2);Ce(xe,{legend:"Tile Gap",change:q,get vector(){return l().settings.tileGap},set vector(w){l(l().settings.tileGap=w,!0)}});var le=y(xe,2);Ce(le,{legend:"Offset",change:q,get vector(){return l().settings.startOffset},set vector(w){l(l().settings.startOffset=w,!0)}});var ne=y(le,2),ve=y(E(ne),2),re=y(E(ve));De(re),S(ve);var oe=y(ve,2),Se=y(E(oe));De(Se),S(oe);var $e=y(oe,2);$e.__click=I,S(ne);var pe=y(ne,2),Te=y(E(pe),2);Te.__click=[Ii,e,l],S(pe),S(se),S(M),ie(M,w=>C=w,()=>C),Ne(()=>{ct(M,"active",e.active),We(j,"src",l().src)}),Ue(re,()=>m(z),w=>Z(z,w)),Ue(Se,()=>m(L),w=>Z(L,w)),ue(i,M),Le(),s()}je(["click"]);var Di=fe('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function Pi(i,e){Pe(e,!0);const[t,s]=Ge();let a,l=Me(e,"atlantes",27,()=>O([])),o=Me(e,"activeAtlas",15);async function u(r){if(a.files)for(let k of a.files){let z=await f(k),L=O({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const $=new dt(z,L,k.name);await $.loadImg(),l().push($),o($)}}async function f(r){return new Promise(k=>{const z=new FileReader;z.onload=()=>k(z.result),z.readAsDataURL(r)})}function C(r){o(r)}function g(r){r==o()&&ye(de,[]);let k=l().indexOf(r);if(!(k<0)){for(l().splice(k,1);k>=l().length;)k--;k<0||o(l()[k])}}var _=Di(),v=It(_);v.__change=u,ie(v,r=>a=r,()=>a);var b=y(v,2);ot(b,20,l,r=>r,(r,k)=>{const z=vi(()=>o()==k);Mi(r,{get atlas(){return k},activate:C,remove:g,get active(){return m(z)}})}),S(b),ue(i,_),Le(),s()}je(["change"]);function Li(i,e){const t=O({neighborFilter:Array(9).fill(me.UNSET)});e().rules.push(t)}var $i=(i,e)=>{e()},Ni=(i,e,t)=>{e(t,-1)},Ri=(i,e,t)=>{e(t,1)},Oi=(i,e,t)=>{e(t)},ji=fe("<button></button>"),Gi=fe('<div class="tile-rule svelte-1lu0swp"><div class="tile-rule-order svelte-1lu0swp"><button>^</button> <button>v</button></div> <div class="tile-rule-data"><div class="tile-rule-image svelte-1lu0swp"></div> <button>set tile</button></div> <div class="tile-neighbors svelte-1lu0swp"></div></div>'),Bi=fe('<button>set tile</button> <div class="tile-rules svelte-1lu0swp">Rules <!></div> <button>Add Rule</button>',1),Vi=fe('<div class="tile-info svelte-1lu0swp"><div class="tile-base-info svelte-1lu0swp"><span class="tile-id svelte-1lu0swp"> </span> <span class="tile-type svelte-1lu0swp"> </span> <span class="tile-name svelte-1lu0swp">name: <input type="text"></span> <div class="tile-preview svelte-1lu0swp"><canvas width="64" height="64"></canvas></div></div> <!></div>');function Wi(i,e){Pe(e,!0);const[t,s]=Ge(),a=()=>Ve(de,"$selectedTilesAtlas",t);let l=Me(e,"tile",15),o,u;Ke(()=>{u=o.getContext("2d"),u.imageSmoothingEnabled=!1,u.clearRect(0,0,o.width,o.height)}),nt(()=>{l().type==="basic"?f(U.drawTile,l()):l().type==="rule"&&f(U.drawTile,l().default)});function f(I,M){u.clearRect(0,0,o.width,o.height);const j={x:0,y:0},A={x:o.width,y:o.height};I(M,u,j,A)}function C(I){return I===me.SAME?"same":I===me.DIFFERENT?"different":"none"}function g(I,M){I[M]=(I[M]+1)%Object.keys(me).filter(j=>isNaN(Number(j))).length}function _(I,M){if(l().type!=="rule")return;let j=l().rules.indexOf(I);j<0||l().rules.splice(j+M,0,...l().rules.splice(j,1))}function v(I){if(!I)return"";let M=U.atlantes.get(I.atlasId);if(!M)return"";let j=M.getTilePosition(I.indexInAtlas),A={x:50/M.settings.tileSize.x,y:50/M.settings.tileSize.y};return`background-image: url(${M.src}); background-position: -${j.x*A.x}px -${j.y*A.y}px; background-size: ${M.dimensions.x*A.x}px ${M.dimensions.y*A.y}px`}function b(I){if(a().length<=0)return;let M=a()[0][0];M&&(I.tile=M)}function r(){if(l().type!=="rule"||a().length<=0)return;let I=a()[0][0];I&&(l(l().default=I,!0),f(U.drawTile,l().default))}var k=Vi(),z=E(k),L=E(z),$=E(L);S(L);var P=y(L,2),T=E(P);S(P);var F=y(P,2),B=y(E(F));De(B),S(F);var X=y(F,2),V=E(X);ie(V,I=>o=I,()=>o),S(X),S(z);var q=y(z,2);{var Q=I=>{var M=Bi(),j=It(M);j.__click=[$i,r];var A=y(j,2),R=y(E(A));ot(R,18,()=>l().rules,se=>se,(se,H,xe)=>{var le=Gi(),ne=E(le),ve=E(ne);ve.__click=[Ni,_,H];var re=y(ve,2);re.__click=[Ri,_,H],S(ne);var oe=y(ne,2),Se=E(oe),$e=y(Se,2);$e.__click=[Oi,b,H],S(oe);var pe=y(oe,2);ot(pe,21,()=>H.neighborFilter,_i,(Te,w,c,h)=>{var p=ji();p.__click=()=>g(H.neighborFilter,c),We(p,"aria-label",`change neighbor rule ${c??""}`),Ne((N,Je)=>{Ti(p,`tile-rule-button ${N??""} svelte-1lu0swp`),p.disabled=Je,Ei(p,"grid-area","b"+c)},[()=>C(m(w)),()=>c===Math.floor(H.neighborFilter.length/2)]),ue(Te,p)}),S(pe),S(le),Ne(Te=>{ve.disabled=m(xe)===0,re.disabled=m(xe)===l().rules.length-1,We(Se,"style",Te)},[()=>v(H.tile)]),ue(se,le)}),S(A);var ae=y(A,2);ae.__click=[Li,l],ue(I,M)};Ct(q,I=>{l().type==="rule"&&I(Q)})}S(k),Ne(()=>{rt($,`id: ${l().id??""}`),rt(T,`type: ${l().type??""}`)}),ut(B,()=>l().name,I=>l(l().name=I,!0)),ue(i,k),Le(),s()}je(["click"]);const n=me.UNSET,x=me.SAME,D=me.DIFFERENT;function Yi(){const i=Dt(de);if(st(20)){let e=U.newTile("rule");e.default=i[1][1];let t=O(qi(i));return e.rules=t,e}else if(st(16)){let e=U.newTile("rule");e.default=i[1][1];let t=O(Ot(i));return e.rules=t,e}else if(st(9)){let e=U.newTile("rule");e.default=i[1][1];let t=O(Rt(i));return e.rules=t,e}}function st(i){const e=Dt(de);switch(i){case 9:return e.length!==3||e[0].length!==3?!1:at(e,{start:{x:0,y:0},size:{x:3,y:3}});case 16:return e.length!==4||e[0].length!==4?!1:at(e,{start:{x:0,y:0},size:{x:4,y:4}});case 20:return e.length!==4||e[0].length!==6?!1:at(e,{start:{x:0,y:0},size:{x:4,y:4}},{start:{x:4,y:0},size:{x:2,y:2}})}return!1}function at(i,...e){for(let t of e)for(let s=t.start.y;s<t.start.y+t.size.y;s++)for(let a=t.start.x;a<t.start.x+t.size.x;a++)if(!i[s]||!i[s][a])return!1;return!0}function Rt(i){return[{tile:i[0][0],neighborFilter:[n,D,n,D,n,x,n,x,n]},{tile:i[0][1],neighborFilter:[n,D,n,x,n,x,n,x,n]},{tile:i[0][2],neighborFilter:[n,D,n,x,n,D,n,x,n]},{tile:i[1][0],neighborFilter:[n,x,n,D,n,x,n,x,n]},{tile:i[1][1],neighborFilter:[n,x,n,x,n,x,n,x,n]},{tile:i[1][2],neighborFilter:[n,x,n,x,n,D,n,x,n]},{tile:i[2][0],neighborFilter:[n,x,n,D,n,x,n,D,n]},{tile:i[2][1],neighborFilter:[n,x,n,x,n,x,n,D,n]},{tile:i[2][2],neighborFilter:[n,x,n,x,n,D,n,D,n]}]}function Ot(i){return[{tile:i[3][3],neighborFilter:[n,D,n,D,n,D,n,D,n]},{tile:i[0][3],neighborFilter:[n,D,n,D,n,D,n,x,n]},{tile:i[1][3],neighborFilter:[n,x,n,D,n,D,n,x,n]},{tile:i[2][3],neighborFilter:[n,x,n,D,n,D,n,D,n]},{tile:i[3][0],neighborFilter:[n,D,n,D,n,x,n,D,n]},{tile:i[3][1],neighborFilter:[n,D,n,x,n,x,n,D,n]},{tile:i[3][2],neighborFilter:[n,D,n,x,n,D,n,D,n]},...Rt(i)]}function qi(i){return[{tile:i[0][4],neighborFilter:[n,x,n,x,n,x,n,x,D]},{tile:i[0][5],neighborFilter:[n,x,n,x,n,x,D,x,n]},{tile:i[1][4],neighborFilter:[n,x,D,x,n,x,n,x,n]},{tile:i[1][5],neighborFilter:[D,x,n,x,n,x,n,x,n]},...Ot(i)]}var Hi=fe('<div id="sheet-wrapper" class="svelte-14bijwv"><fieldset class="svelte-14bijwv"><!> <!> <fieldset class="svelte-14bijwv"><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-14bijwv"><canvas id="sheet-canvas" class="svelte-14bijwv"></canvas> <canvas id="overlay-canvas" class="svelte-14bijwv"></canvas></div> <div id="tile-info-wrapper" class="svelte-14bijwv"><div id="tile-info" class="svelte-14bijwv"><!></div></div></div>');function Ui(i,e){Pe(e,!0);const[t,s]=Ge(),a=()=>Ve(ke,"$selectedTileSheet",t),l=()=>Ve(de,"$selectedTilesAtlas",t);let o=te(O({x:20,y:20})),u=te(O({x:16,y:16})),f=Me(e,"sheet",27,()=>O(new zi(m(o),m(u)))),C,g,_,v,b,r,k=te(void 0),z=te(!0),L=te(O({x:0,y:0})),$=!1,P=!1;Ke(()=>{r=new ht(g),r.addEventListener("draw",Q),r.addEventListener("pointerdown",T),r.addEventListener("pointermove",F),r.addEventListener("pointerup",B),v=g.getContext("2d"),M(),b=_.getContext("2d"),r.addCtxToSync(b),Q()});function T(c){if(c.detail.event.button===0)$=!0;else if(c.detail.event.button===2){P=!0;const h=q(c.detail.pos);h&&f().setTile(void 0,h)}}function F(c){if(Z(L,O(c.detail.pos)),P){const h=q(c.detail.pos);h&&f().setTile(void 0,h)}$&&X(c),r.draw()}function B(c){c.detail.event.button===0?($=!1,X(c)):c.detail.event.button===2&&(P=!1),r.draw()}function X(c){const h=q(m(L));if(!h){ye(ke,void 0);return}if(l().length>0)if(c.detail.event.shiftKey){const p=Yi();if(!p)return;f().setTile(p,h),ye(ke,p)}else V(h);else{let p=f().getTile(h);if(p)ye(ke,p);else{let N=O(U.newTile("rule"));f().setTile(N,h),ye(ke,N)}Z(k,O(h))}}function V(c){for(let h=0;h<l().length;h++)for(let p=0;p<l()[h].length;p++)l()[h][p]&&(c.x+p>=f().mapSize.x||c.y+h>=f().mapSize.y||f().setTile(l()[h][p],{x:c.x+p,y:c.y+h}))}function q(c){const h={x:Math.floor(c.x/m(u).x),y:Math.floor(c.y/m(u).y)};if(!(h.x<0||h.y<0)&&!(h.x>=f().mapSize.x||h.y>=f().mapSize.y))return h}function Q(){f().render(v),m(z)&&Nt(v,{tileSize:m(u),tileAmount:m(o)}),I()}function I(){const c=q(m(L));if(c){b.imageSmoothingEnabled=!1;for(let h=0;h<l().length;h++)for(let p=0;p<l()[h].length;p++){if(c.x+p>=f().mapSize.x||c.y+h>=f().mapSize.y)continue;const N={x:(c.x+p)*f().tileSize.x,y:(c.y+h)*f().tileSize.y};U.drawTile(l()[h][p],b,N,m(u))}}a()&&m(k)&&(b.fillStyle="rgba(255, 0, 0, 0.5)",b.fillRect(m(k).x*f().tileSize.x,m(k).y*f().tileSize.y,f().tileSize.x,f().tileSize.y))}function M(){Ye(_,C),Ye(g,C)}function j(){M(),r.reset()}function A(){r.draw()}var R=Hi(),ae=E(R),se=E(ae);Ce(se,{legend:"Tile Size",change:A,get vector(){return m(u)},set vector(c){Z(u,O(c))}});var H=y(se,2);Ce(H,{legend:"Sheet Size",change:A,get vector(){return m(o)},set vector(c){Z(o,O(c))}});var xe=y(H,2),le=y(E(xe),2),ne=y(E(le));De(ne),S(le);var ve=y(le,2);ve.__click=j,S(xe),S(ae);var re=y(ae,2),oe=E(re);ie(oe,c=>g=c,()=>g);var Se=y(oe,2);ie(Se,c=>_=c,()=>_),S(re),ie(re,c=>C=c,()=>C);var $e=y(re,2),pe=E($e),Te=E(pe);{var w=c=>{Wi(c,{get tile(){return xi(),a()},set tile(h){ye(ke,h)}})};Ct(Te,c=>{a()&&c(w)})}S(pe),S($e),S(R),Ue(ne,()=>m(z),c=>Z(z,c)),ue(i,R),Le(),s()}je(["click"]);function Xi(i,e){e().reset()}var Ki=fe('<div id="map-display" class="svelte-1tr63jx"><div class="map-display-settings"><!> <!> <fieldset><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button> <button>reset map</button></fieldset></div> <div id="map-display-canvas-wrapper" class="svelte-1tr63jx"><canvas></canvas></div></div>');function Ji(i,e){Pe(e,!0);const[t,s]=Ge(),a=()=>Ve(ke,"$selectedTileSheet",t);let l=Me(e,"map",7),o=te(O({x:20,y:20})),u=te(O({x:16,y:16})),f,C,g,_,v=te(!0);Ke(()=>{_=new ht(f),_.addEventListener("draw",k),_.addEventListener("pointerup",b),g=f.getContext("2d"),L(),z()});function b(A){if(A.detail.event.button===0){if(!a())return;const R=r(A.detail.pos);if(!R)return;l().setTile(R.x,R.y,a())}else if(A.detail.event.button===2){const R=r(A.detail.pos);if(!R)return;l().setTile(R.x,R.y,void 0)}_.draw()}function r(A){const R={x:Math.floor(A.x/m(u).x),y:Math.floor(A.y/m(u).y)};if(!(R.x<0||R.y<0)&&!(R.x>=m(o).x||R.y>=m(o).y))return R}function k(){l().render(g),m(v)&&Nt(g,{tileAmount:m(o),tileSize:m(u)})}function z(){l().tileSize=m(u),l().mapSize=m(o),_.draw()}function L(){Ye(f,C)}function $(){L(),_.reset()}var P=Ki(),T=E(P),F=E(T);Ce(F,{legend:"Tile Size",change:z,get vector(){return m(u)},set vector(A){Z(u,O(A))}});var B=y(F,2);Ce(B,{legend:"Map Size",change:z,get vector(){return m(o)},set vector(A){Z(o,O(A))}});var X=y(B,2),V=y(E(X),2),q=y(E(V));De(q),S(V);var Q=y(V,2);Q.__click=$;var I=y(Q,2);I.__click=[Xi,l],S(X),S(T);var M=y(T,2),j=E(M);ie(j,A=>f=A,()=>f),S(M),ie(M,A=>C=A,()=>C),S(P),Ue(q,()=>m(v),A=>Z(v,A)),ue(i,P),Le(),s()}je(["click"]);var Qi=fe('<div id="outer-wrapper" class="svelte-6c91tk"><h1 class="svelte-6c91tk"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-6c91tk"><div class="tab svelte-6c91tk" id="tab-atlas"><h2 class="svelte-6c91tk">Tile Atlas</h2> <div class="tab-content svelte-6c91tk"><!></div></div> <div class="tab shown svelte-6c91tk" id="tab-sheet"><h2 class="svelte-6c91tk">Tile Sheet</h2> <div class="tab-content svelte-6c91tk"><!></div></div> <div class="tab svelte-6c91tk" id="tab-map"><h2 class="svelte-6c91tk">Tile Map</h2> <div class="tab-content svelte-6c91tk"><!></div></div></div></div>');function ls(i,e){Pe(e,!0);const[t,s]=Ge();let a=te(O([])),l,o=te(!0),u,f=te(void 0),C;nt(()=>{l.addEventListener("pointerup",()=>{Z(o,!0)}),u.addEventListener("pointerup",()=>{Z(o,!1),ye(de,[])})});let g=new Ai({x:5,y:5},{x:64,y:64},[]);nt(()=>{U.setAtlantes(m(a))});var _=Qi();gi(B=>{hi.title="FUDGE Tilemap Editor"});var v=y(E(_),2),b=E(v),r=y(E(b),2),k=E(r);Pi(k,{get atlantes(){return m(a)},set atlantes(B){Z(a,O(B))},get activeAtlas(){return m(f)},set activeAtlas(B){Z(f,O(B))}}),S(r),S(b),ie(b,B=>l=B,()=>l);var z=y(b,2),L=y(E(z),2),$=E(L);Ui($,{get sheet(){return C}}),S(L),S(z);var P=y(z,2),T=y(E(P),2),F=E(T);Ji(F,{map:g}),S(T),S(P),ie(P,B=>u=B,()=>u),S(v),S(_),Ne(()=>{ct(b,"shown",m(o)),ct(P,"shown",!m(o))}),ue(i,_),Le(),s()}export{ls as component};
