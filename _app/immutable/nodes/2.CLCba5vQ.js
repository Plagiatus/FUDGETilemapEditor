var zt=Object.defineProperty;var st=s=>{throw TypeError(s)};var It=(s,t,e)=>t in s?zt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var P=(s,t,e)=>It(s,typeof t!="symbol"?t+"":t,e),at=(s,t,e)=>t.has(s)||st("Cannot "+e);var l=(s,t,e)=>(at(s,t,"read from private field"),e?e.call(s):t.get(s)),F=(s,t,e)=>t.has(s)?st("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),R=(s,t,e,i)=>(at(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);import{t as Ee,a as ze}from"../chunks/BCC5ZuJv.js";import{s as nt,j as lt,m as At,o as Ze,p as kt,b as Ct,v as Ue,h as U,w as Lt,z as Mt,P as k,af as Pt,a6 as Dt,a7 as rt,t as Xe,f as Ge,A as Ot,a8 as ft,d as ut,a9 as Ft,ar as qe,F as xt,am as Gt,$ as ot,k as Nt,as as Rt,at as Bt,D as Ht,au as Wt,e as Vt,av as Yt,aw as Ut,r as Xt,ax as qt,ay as Kt,a5 as Jt,az as Zt,aA as jt,a as yt,ab as gt,I as Ie,ap as ne,V as _,X as v,W as g,U as et,a2 as K,J as Ae,g as pt,R as Qt,u as We,aB as $t}from"../chunks/BIoUGQbI.js";import{d as Ve,s as ct,a as ei}from"../chunks/COfxPkzX.js";import{p as Re,b as H,a as X,i as ti}from"../chunks/DIAHynfl.js";import{o as tt}from"../chunks/Dp2TxcRe.js";let dt=!1;function _t(){dt||(dt=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{var t;if(!s.defaultPrevented)for(const e of s.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function ii(s){var t=At,e=Ze;nt(null),lt(null);try{return s()}finally{nt(t),lt(e)}}function mt(s,t,e,i=e){s.addEventListener(t,()=>ii(e));const a=s.__on_r;a?s.__on_r=()=>{a(),i(!0)}:s.__on_r=()=>i(!0),_t()}function si(s,t,e,i){for(var a=[],n=t.length,d=0;d<n;d++)Bt(t[d].e,a,!0);var f=n>0&&a.length===0&&e!==null;if(f){var m=e.parentNode;Ht(m),m.append(e),i.clear(),te(s,t[0].prev,t[n-1].next)}Wt(a,()=>{for(var p=0;p<n;p++){var c=t[p];f||(i.delete(c.k),te(s,c.prev,c.next)),Vt(c.e,!f)}})}function ai(s,t,e,i,a,n=null){var d=s,f={flags:t,items:new Map,first:null};{var m=s;d=U?Ue(Lt(m)):m.appendChild(kt())}U&&Mt();var p=null,c=!1,y=Pt(()=>{var r=e();return Nt(r)?r:r==null?[]:xt(r)});Ct(()=>{var r=k(y),u=r.length;if(c&&u===0)return;c=u===0;let h=!1;if(U){var C=d.data===Dt;C!==(u===0)&&(d=rt(),Ue(d),Xe(!1),h=!0)}if(U){for(var L=null,w,z=0;z<u;z++){if(Ge.nodeType===8&&Ge.data===Ot){d=Ge,h=!0,Xe(!1);break}var W=r[z],S=i(W,z);w=bt(Ge,f,L,null,W,S,z,a,t,e),f.items.set(S,w),L=w}u>0&&Ue(rt())}U||ni(r,f,d,a,t,i,e),n!==null&&(u===0?p?ft(p):p=ut(()=>n(d)):p!==null&&Ft(p,()=>{p=null})),h&&Xe(!0),k(y)}),U&&(d=Ge)}function ni(s,t,e,i,a,n,d){var f=s.length,m=t.items,p=t.first,c=p,y,r=null,u=[],h=[],C,L,w,z;for(z=0;z<f;z+=1){if(C=s[z],L=n(C,z),w=m.get(L),w===void 0){var W=c?c.e.nodes_start:e;r=bt(W,t,r,r===null?t.first:r.next,C,L,z,i,a,d),m.set(L,r),u=[],h=[],c=r.next;continue}if(w.e.f&qe&&ft(w.e),w!==c){if(y!==void 0&&y.has(w)){if(u.length<h.length){var S=h[0],N;r=S.prev;var V=u[0],J=u[u.length-1];for(N=0;N<u.length;N+=1)vt(u[N],S,e);for(N=0;N<h.length;N+=1)y.delete(h[N]);te(t,V.prev,J.next),te(t,r,V),te(t,J,S),c=S,r=J,z-=1,u=[],h=[]}else y.delete(w),vt(w,c,e),te(t,w.prev,w.next),te(t,w,r===null?t.first:r.next),te(t,r,w),r=w;continue}for(u=[],h=[];c!==null&&c.k!==L;)c.e.f&qe||(y??(y=new Set)).add(c),h.push(c),c=c.next;if(c===null)continue;w=c}u.push(w),r=w,c=w.next}if(c!==null||y!==void 0){for(var le=y===void 0?[]:xt(y);c!==null;)c.e.f&qe||le.push(c),c=c.next;var Y=le.length;if(Y>0){var Q=f===0?e:null;si(t,le,Q,m)}}Ze.first=t.first&&t.first.e,Ze.last=r&&r.e}function bt(s,t,e,i,a,n,d,f,m,p){var c=(m&Yt)!==0,y=(m&Ut)===0,r=c?y?Gt(a):ot(a):a,u=m&Rt?ot(d):d,h={i:u,v:r,k:n,a:null,e:null,prev:e,next:i};try{return h.e=ut(()=>f(s,r,u,p),U),h.e.prev=e&&e.e,h.e.next=i&&i.e,e===null?t.first=h:(e.next=h,e.e.next=h.e),i!==null&&(i.prev=h,i.e.prev=h.e),h}finally{}}function vt(s,t,e){for(var i=s.next?s.next.e.nodes_start:e,a=t?t.e.nodes_start:e,n=s.e.nodes_start;n!==i;){var d=Xt(n);a.before(n),n=d}}function te(s,t,e){t===null?s.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function B(s){if(U){var t=!1,e=()=>{if(!t){if(t=!0,s.hasAttribute("value")){var i=s.value;je(s,"value",null),s.value=i}if(s.hasAttribute("checked")){var a=s.checked;je(s,"checked",null),s.checked=a}}};s.__on_r=e,qt(e),_t()}}function je(s,t,e,i){var a=s.__attributes??(s.__attributes={});U&&(a[t]=s.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&s.nodeName==="LINK")||a[t]!==(a[t]=e)&&(t==="style"&&"__styles"in s&&(s.__styles={}),t==="loading"&&(s[Kt]=e),e==null?s.removeAttribute(t):typeof e!="string"&&li(s).includes(t)?s[t]=e:s.setAttribute(t,e))}var ht=new Map;function li(s){var t=ht.get(s.nodeName);if(t)return t;ht.set(s.nodeName,t=[]);for(var e,i=s,a=Element.prototype;a!==i;){e=Zt(i);for(var n in e)e[n].set&&t.push(n);i=Jt(i)}return t}function Qe(s,t,e){if(e){if(s.classList.contains(t))return;s.classList.add(t)}else{if(!s.classList.contains(t))return;s.classList.remove(t)}}function q(s,t,e=t){var i=jt();mt(s,"input",a=>{var n=a?s.defaultValue:s.value;if(n=Ke(s)?Je(n):n,e(n),i&&n!==(n=t())){var d=s.selectionStart,f=s.selectionEnd;s.value=n??"",f!==null&&(s.selectionStart=d,s.selectionEnd=Math.min(f,s.value.length))}}),(U&&s.defaultValue!==s.value||yt(t)==null&&s.value)&&e(Ke(s)?Je(s.value):s.value),gt(()=>{var a=t();Ke(s)&&a===Je(s.value)||s.type==="date"&&!a&&!s.value||a!==s.value&&(s.value=a??"")})}function $e(s,t,e=t){mt(s,"change",i=>{var a=i?s.defaultChecked:s.checked;e(a)}),(U&&s.defaultChecked!==s.checked||yt(t)==null)&&e(s.checked),gt(()=>{var i=t();s.checked=!!i})}function Ke(s){var t=s.type;return t==="number"||t==="range"}function Je(s){return s===""?null:+s}var E,de,we,Be,ve,Z,ie,Te;const Ne=class Ne{constructor(t,e={},i=t){F(this,E);F(this,de);F(this,we);F(this,Be);F(this,ve);F(this,Z,{x:0,y:0});F(this,ie,{x:0,y:0});F(this,Te);if(Ne.existingIDs.has(i))throw Error("A Tile Atlas with this ID already exists.");R(this,we,t),R(this,E,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...e}),R(this,de,i),this.loadImg()}async loadImg(){if(l(this,ve))return l(this,ve);const t=document.createElement("img");return R(this,ve,new Promise(e=>{t.addEventListener("load",()=>{R(this,Z,{x:t.naturalWidth,y:t.naturalHeight}),e()})})),t.src=l(this,we),R(this,Be,t),l(this,ve)}get img(){return l(this,Be)}get src(){return l(this,we)}get id(){return l(this,de)}get dimensions(){return structuredClone(l(this,Z))}get tileAmount(){return structuredClone(l(this,ie))}get settings(){return l(this,E)}set settings(t){R(this,E,t)}getTile(t){}getTilePosition(t){let e=typeof t=="number"?t:t.indexInAtlas;return{x:l(this,E).startOffset.x+(l(this,E).tileSize.x+l(this,E).tileGap.x)*(e%l(this,ie).x),y:l(this,E).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(e/l(this,ie).x),w:l(this,E).tileSize.x,h:l(this,E).tileSize.y}}createTiles(){if(l(this,E).tileSize.x<1||l(this,E).tileSize.y<1)return[];let t=0,e=0;const i=[];let a=0,n=0;for(let d=l(this,E).startOffset.y;d<l(this,Z).y&&d+l(this,E).tileSize.y<=l(this,Z).y;d+=l(this,E).tileSize.y+l(this,E).tileGap.y){a=0;for(let f=l(this,E).startOffset.x;f<l(this,Z).x&&f+l(this,E).tileSize.x<=l(this,Z).x;f+=l(this,E).tileSize.x+l(this,E).tileGap.x)i.push({type:"basic",id:t++,atlasId:l(this,de),indexInAtlas:e++,name:`${l(this,de)}_${e}`}),a++;n++}return l(this,ie).x=a,l(this,ie).y=n,R(this,Te,[...i]),i}getTiles(){return l(this,Te)||this.createTiles(),l(this,Te)}};E=new WeakMap,de=new WeakMap,we=new WeakMap,Be=new WeakMap,ve=new WeakMap,Z=new WeakMap,ie=new WeakMap,Te=new WeakMap,P(Ne,"existingIDs",new Set),P(Ne,"selectedTiles",[]);let G=Ne;var he,fe,se;class ri{constructor(t,e){F(this,he,[]);F(this,fe,{x:20,y:20});F(this,se,{x:64,y:64});this.mapSize=t,this.tileSize=e}get mapSize(){return l(this,fe)}set mapSize(t){R(this,fe,t)}get tileSize(){return l(this,se)}set tileSize(t){R(this,se,t)}setTile(t,e){l(this,he)[e.y]||(l(this,he)[e.y]=[]),l(this,he)[e.y][e.x]=t}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<l(this,fe).y;e++)for(let i=0;i<l(this,fe).x;i++){const a=this.getTile({x:i,y:e});a&&j.drawTile(a,t,{x:l(this,se).x*i,y:l(this,se).y*e},l(this,se))}}getTile(t){var e;return(e=l(this,he)[t.y])==null?void 0:e[t.x]}}he=new WeakMap,fe=new WeakMap,se=new WeakMap;var ae,ue,Se;class oi{constructor(t,e,i){F(this,ae);F(this,ue);F(this,Se);R(this,ae,t),R(this,ue,e),R(this,Se,i.map(a=>typeof a=="number"?j.getTile(a):a))}render(t){t.imageSmoothingEnabled=!1;for(let e=0;e<l(this,ae).x;e++)for(let i=0;i<l(this,ae).y;i++){const a=this.getTile(e,i);a&&j.drawTile(a,t,{x:l(this,ue).x*e,y:l(this,ue).y*e},l(this,ue))}}getTile(t,e){return l(this,Se)[e*l(this,ae).x+t]}setTile(t,e,i){l(this,Se)[e*l(this,ae).x+t]=i}}ae=new WeakMap,ue=new WeakMap,Se=new WeakMap;const D=class D{constructor(){if(D.Instance)return D.Instance;D.renderMethod.set("basic",D.drawBasicTile),D.renderMethod.set("rule",D.drawRuleTile)}static setAtlantes(t){this.atlantes.clear();for(const e of t)this.atlantes.set(e.id,e);this.recalculateTileIds()}static recalculateTileIds(){let t=1;const e=new Map;for(let i of this.atlantes.values())i.getTiles().forEach(n=>{n.id=t++,e.set(n.id,n)});for(let i of this.tileIndex.values())i.type!=="basic"&&(i.id=e.size+1,e.set(i.id,i));this.tileIndex=e}static addTile(t){this.tileIndex.set(t.id,t)}static newTile(t,e=""){this.recalculateTileIds();let i=this.tileIndex.size;for(;this.tileIndex.has(i);)i++;let a={type:t,default:void 0,id:i,name:e,rules:[]};return this.addTile(a),a}static getTile(t){return this.tileIndex.get(t)}static drawTile(t,e,i,a){var n;if(typeof t=="number"&&(t=this.tileIndex.get(t)),!!t){if(!D.renderMethod.has(t.type))throw new Error(`Cannot draw tile type "${t.type}": No known renderer.`);(n=D.renderMethod.get(t.type))==null||n(t,e,i,a)}}static drawRuleTile(t,e,i,a){}};P(D,"renderMethod",new Map),P(D,"atlantes",new Map),P(D,"tileIndex",new Map),P(D,"drawBasicTile",(t,e,i,a)=>{const n=D.atlantes.get(t.atlasId);if(!n){e.fillStyle="red",e.textAlign="center",e.font=`bold ${a.y*.8}px sans-serif`,e.fillText("!",i.x+.5*a.x,i.y+a.y*.8,a.x),console.error(`Atlas "${t.atlasId}" not found.`);return}let{x:d,y:f,w:m,h:p}=n.getTilePosition(t.indexInAtlas);e.drawImage(n.img,d,f,m,p,i.x,i.y,a.x,a.y)}),P(D,"Instance",new D);let j=D;class wt extends EventTarget{constructor(e){super();P(this,"canvas");P(this,"ctx");P(this,"translation",{x:0,y:0});P(this,"scale",1);P(this,"scaleSettings",{factor:2,min:1/16,max:16});P(this,"syncedCtx",new Set);P(this,"pointerdown",e=>{switch(e.button){}this.dispatchEventFromEvent(e),e.preventDefault()});P(this,"pointermove",e=>{e.preventDefault();const i=this.getButtonsFromEvent(e);i.includes(0),i.includes(1),i.includes(2)&&(this.translation.x+=e.movementX,this.translation.y+=e.movementY,this.draw()),this.dispatchEventFromEvent(e)});P(this,"pointerup",e=>{switch(this.dispatchEventFromEvent(e),e.button){}e.preventDefault()});P(this,"zoom",e=>{e.preventDefault();const i=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!1),a=-Math.sign(e.deltaY),n=this.scale,d=Math.min(this.scaleSettings.max,Math.max(this.scaleSettings.min,this.scale*Math.pow(this.scaleSettings.factor,a))),f=d/n;this.translation.x=i.x+(this.translation.x-i.x)*f,this.translation.y=i.y+(this.translation.y-i.y)*f,this.scale=d,this.draw()});this.canvas=e,this.ctx=e.getContext("2d"),this.installListeners();const i=e.getBoundingClientRect();e.width=i.width,e.height=i.height,this.syncedCtx.add(this.ctx)}installListeners(){this.canvas.addEventListener("pointerdown",this.pointerdown),this.canvas.addEventListener("pointermove",this.pointermove),this.canvas.addEventListener("pointerup",this.pointerup),this.canvas.addEventListener("wheel",this.zoom),this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}getButtonsFromEvent(e){const i=[];for(let a=0;a<5;a++)e.buttons&1<<a&&i.push(a);return i}dispatchEventFromEvent(e){const i=this.canvasPosFromMousePos({x:e.clientX,y:e.clientY},!0);this.dispatchEvent(new CustomEvent(e.type,{detail:{pos:i,event:e}}))}canvasPosFromMousePos(e,i){const a=this.canvas.getBoundingClientRect(),n={x:e.x-a.left,y:e.y-a.top};return i&&(n.x=(n.x-this.translation.x)/this.scale,n.y=(n.y-this.translation.y)/this.scale),n}draw(){for(let e of this.syncedCtx.values())e.clearRect(0,0,e.canvas.width,e.canvas.height),e.reset(),e.translate(this.translation.x,this.translation.y),e.scale(this.scale,this.scale);this.dispatchEvent(new CustomEvent("draw"))}reset(){this.scale=1,this.translation.x=0,this.translation.y=0,this.draw()}addCtxToSync(e){this.syncedCtx.add(e)}}var ci=(s,t,e)=>{t.remove(e())},di=Ee('<fieldset class="atlas-display svelte-n7a098"><img class="img-preview svelte-n7a098" alt=""> <div class="canvas-wrapper svelte-n7a098"><canvas></canvas> <canvas class="canvas-overlay svelte-n7a098"></canvas></div> <div class="settings-wrapper svelte-n7a098"><fieldset class="svelte-n7a098"><legend>Tile Size</legend> <label>width <input type="number" min="0" class="svelte-n7a098"></label> <label>height <input type="number" min="0" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Tile Gap</legend> <label>width <input type="number" class="svelte-n7a098"></label> <label>height <input type="number" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Offset</legend> <label>width <input type="number" class="svelte-n7a098"></label> <label>height <input type="number" width="5" class="svelte-n7a098"></label></fieldset> <fieldset class="svelte-n7a098"><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset> <fieldset class="svelte-n7a098"><legend>Danger Zone</legend> <button>Remove</button></fieldset></div></fieldset>');function vi(s,t){Ie(t,!0);let e=Re(t,"atlas",15),i,a,n,d,f,m,p,c=[],y=new Set,r,u=ne(!1),h=ne(!0);tt(()=>{d.addEventListener("click",()=>{t.active||(t.activate(e()),C())}),p=new wt(n),p.addEventListener("draw",L),p.addEventListener("pointermove",w),p.addEventListener("pointerup",W),n.addEventListener("pointerleave",z),f=n.getContext("2d"),m=a.getContext("2d"),p.addCtxToSync(m),J(),p.draw()});function C(){if(y.size==0)return G.selectedTiles=[],p.draw();const x=e().tileAmount,T={x:1/0,y:1/0},O={x:-1/0,y:-1/0};y.forEach(M=>{const A={x:M.indexInAtlas%x.x,y:Math.floor(M.indexInAtlas/x.x)};T.x>A.x&&(T.x=A.x),T.y>A.y&&(T.y=A.y),O.x<A.x&&(O.x=A.x),O.y<A.y&&(O.y=A.y)}),G.selectedTiles=Array.from({length:O.y-T.y+1},()=>[]),y.forEach(M=>{const A={x:M.indexInAtlas%x.x-T.x,y:Math.floor(M.indexInAtlas/x.x)-T.y};G.selectedTiles[A.y][A.x]=M}),p.draw()}function L(){m.imageSmoothingEnabled=!1,m.drawImage(e().img,0,0),m.lineWidth=1,m.strokeStyle="rgba(0, 0, 0, 0.5)",m.textAlign="right",c=e().getTiles();for(let x of c){let{x:T,y:O,w:M,h:A}=e().getTilePosition(x);k(h)&&m.strokeRect(T,O,M,A),k(u)&&m.fillText(x.id.toString(),T+M-1,O+A-1,M)}S()}function w(x){const T=N(x.detail.pos.x,x.detail.pos.y);if(!T)return z();r=T,p.draw()}function z(){r=void 0,p.draw()}function W(x){if(x.detail.event.button!==0)return;const T=N(x.detail.pos.x,x.detail.pos.y);if(!T)return y.clear(),C();x.detail.event.ctrlKey?y.has(T)?y.delete(T):y.add(T):y.has(T)&&y.size===1?y.clear():(y.clear(),y.add(T)),C()}function S(){if(r){f.fillStyle="rgba(255, 255, 255, 0.5)";let{x,y:T,w:O,h:M}=e().getTilePosition(r);f.fillRect(x,T,O,M)}for(let x of y.values()){f.strokeStyle="rgba(255, 0, 0, 1)",f.fillStyle="rgba(255, 0, 0, 0.25)",f.lineWidth=1;let{x:T,y:O,w:M,h:A}=e().getTilePosition(x);f.fillRect(T,O,M,A),f.strokeRect(T,O,M,A)}}function N(x,T){for(let O of c){let{x:M,y:A,w:St,h:Et}=e().getTilePosition(O);if(x>M&&x<M+St&&T>A&&T<A+Et)return O}}function V(){e().createTiles(),p.draw()}function J(){a.width=i.clientWidth,a.height=i.clientHeight,n.width=i.clientWidth,n.height=i.clientHeight}function le(){J(),p.reset()}var Y=di(),Q=_(Y),$=v(Q,2),xe=_($);H(xe,x=>a=x,()=>a);var He=v(xe,2);H(He,x=>n=x,()=>n),g($),H($,x=>i=x,()=>i);var ke=v($,2),ye=_(ke),re=v(_(ye),2),oe=v(_(re));B(oe),oe.__input=V,g(re);var Ce=v(re,2),ge=v(_(Ce));B(ge),ge.__input=V,g(Ce),g(ye);var pe=v(ye,2),_e=v(_(pe),2),ce=v(_(_e));B(ce),ce.__input=V,g(_e);var Le=v(_e,2),Me=v(_(Le));B(Me),Me.__input=V,g(Le),g(pe);var ee=v(pe,2),me=v(_(ee),2),Pe=v(_(me));B(Pe),Pe.__input=V,g(me);var De=v(me,2),be=v(_(De));B(be),be.__input=V,g(De),g(ee);var Oe=v(ee,2),Fe=v(_(Oe),2),o=v(_(Fe));B(o),g(Fe);var b=v(Fe,2),I=v(_(b));B(I),g(b);var Ye=v(b,2);Ye.__click=le,g(Oe);var it=v(Oe,2),Tt=v(_(it),2);Tt.__click=[ci,t,e],g(it),g(ke),g(Y),H(Y,x=>d=x,()=>d),et(()=>{Qe(Y,"active",t.active),je(Q,"src",e().src)}),q(oe,()=>e().settings.tileSize.x,x=>e(e().settings.tileSize.x=x,!0)),q(ge,()=>e().settings.tileSize.y,x=>e(e().settings.tileSize.y=x,!0)),q(ce,()=>e().settings.tileGap.x,x=>e(e().settings.tileGap.x=x,!0)),q(Me,()=>e().settings.tileGap.y,x=>e(e().settings.tileGap.y=x,!0)),q(Pe,()=>e().settings.startOffset.x,x=>e(e().settings.startOffset.x=x,!0)),q(be,()=>e().settings.startOffset.y,x=>e(e().settings.startOffset.y=x,!0)),$e(o,()=>k(u),x=>K(u,x)),$e(I,()=>k(h),x=>K(h,x)),ze(s,Y),Ae()}Ve(["input","click"]);var hi=Ee('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function fi(s,t){Ie(t,!0);let e,i=Re(t,"atlantes",27,()=>X([])),a=Re(t,"activeAtlas",15);async function n(r){if(e.files)for(let u of e.files){let h=await d(u),C=X({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const L=new G(h,C,u.name);await L.loadImg(),i().push(L),a(L)}}async function d(r){return new Promise(u=>{const h=new FileReader;h.onload=()=>u(h.result),h.readAsDataURL(r)})}function f(r){a(r)}function m(r){r==a()&&(G.selectedTiles=[]);let u=i().indexOf(r);if(!(u<0)){for(i().splice(u,1);u>=i().length;)u--;u<0||a(i()[u])}}var p=hi(),c=pt(p);c.__change=n,H(c,r=>e=r,()=>e);var y=v(c,2);ai(y,20,i,r=>r,(r,u)=>{const h=Qt(()=>a()==u);vi(r,{get atlas(){return u},activate:f,remove:m,get active(){return k(h)}})}),g(y),ze(s,p),Ae()}Ve(["change"]);var ui=Ee('<div class="tile-info svelte-1j7fr4h"><div class="tile-base-info svelte-1j7fr4h"><span class="tile-id svelte-1j7fr4h"> </span> <span class="tile-type svelte-1j7fr4h"> </span> <span class="tile-name svelte-1j7fr4h">name: <input type="text"></span> <div class="tile-preview svelte-1j7fr4h"><canvas width="64" height="64"></canvas></div></div></div>');function xi(s,t){Ie(t,!0);let e=Re(t,"tile",15),i;We(()=>{const h=i.getContext("2d");h.imageSmoothingEnabled=!1,h.clearRect(0,0,i.width,i.height),j.drawTile(e(),h,{x:0,y:0},{x:i.width,y:i.height})});var a=ui(),n=_(a),d=_(n),f=_(d);g(d);var m=v(d,2),p=_(m);g(m);var c=v(m,2),y=v(_(c));B(y),g(c);var r=v(c,2),u=_(r);H(u,h=>i=h,()=>i),g(r),g(n),g(a),et(()=>{ct(f,`id: ${e().id??""}`),ct(p,`type: ${e().type??""}`)}),q(y,()=>e().name,h=>e(e().name=h,!0)),ze(s,a),Ae()}var yi=Ee('<div id="sheet-wrapper" class="svelte-cnh3hz"><fieldset class="svelte-cnh3hz"><fieldset class="svelte-cnh3hz"><legend>Tile Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset class="svelte-cnh3hz"><legend>Sheet Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset class="svelte-cnh3hz"><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-cnh3hz"><canvas id="sheet-canvas" class="svelte-cnh3hz"></canvas> <canvas id="overlay-canvas" class="svelte-cnh3hz"></canvas></div> <div id="tile-info-wrapper" class="svelte-cnh3hz"><div id="tile-info" class="svelte-cnh3hz"><!></div></div></div>');function gi(s,t){Ie(t,!0);let e=X({x:20,y:20}),i=X({x:16,y:16}),a=Re(t,"sheet",27,()=>X(new ri(e,i))),n,d,f,m,p,c,y=ne(void 0),r=ne(!0),u=ne(X({x:0,y:0})),h=!1,C=!1;tt(()=>{c=new wt(d),c.addEventListener("draw",N),c.addEventListener("pointerdown",L),c.addEventListener("pointermove",w),c.addEventListener("pointerup",z),m=d.getContext("2d"),J(),p=f.getContext("2d"),c.addCtxToSync(p),N()});function L(o){if(o.detail.event.button===0)h=!0;else if(o.detail.event.button===2){C=!0;const b=S(o.detail.pos);b&&a().setTile(void 0,b)}}function w(o){if(K(u,X(o.detail.pos)),C){const b=S(o.detail.pos);b&&a().setTile(void 0,b)}h&&W(),c.draw()}function z(o){o.detail.event.button===0?(h=!1,W()):o.detail.event.button===2&&(C=!1)}function W(){const o=S(k(u));if(!o){K(y,void 0);return}if(G.selectedTiles.length>0)for(let b=0;b<G.selectedTiles.length;b++)for(let I=0;I<G.selectedTiles[b].length;I++)G.selectedTiles[b][I]&&(o.x+I>=a().mapSize.x||o.y+b>=a().mapSize.y||a().setTile(G.selectedTiles[b][I],{x:o.x+I,y:o.y+b}));else{let b=a().getTile(o);b||(b=j.newTile("rule"),a().setTile(b,o)),K(y,X(b))}}function S(o){const b={x:Math.floor(o.x/i.x),y:Math.floor(o.y/i.y)};if(!(b.x<0||b.y<0)&&!(b.x>=a().mapSize.x||b.y>=a().mapSize.y))return b}function N(){a().render(m),m.strokeStyle="rgba(0, 0, 0, 1)",m.lineWidth=1;const o=new Path2D;for(let b=0;b<e.y;b++)for(let I=0;I<e.x;I++)o.moveTo(I*i.x,b*i.y+i.y),o.lineTo(I*i.x,b*i.y),o.lineTo(I*i.x+i.x,b*i.y);o.moveTo(0,e.y*i.y),o.lineTo(e.x*i.x,e.y*i.y),o.lineTo(e.x*i.x,0),k(r)&&m.stroke(o),V()}function V(){const o=S(k(u));if(o){p.imageSmoothingEnabled=!1;for(let b=0;b<G.selectedTiles.length;b++)for(let I=0;I<G.selectedTiles[b].length;I++){if(o.x+I>=a().mapSize.x||o.y+b>=a().mapSize.y)continue;const Ye={x:(o.x+I)*a().tileSize.x,y:(o.y+b)*a().tileSize.y};j.drawTile(G.selectedTiles[b][I],p,Ye,i)}}}function J(){d.width=n.clientWidth,f.width=n.clientWidth,d.height=n.clientHeight,f.height=n.clientHeight}function le(){J(),c.reset()}var Y=yi(),Q=_(Y),$=_(Q),xe=v(_($),2),He=v(_(xe));B(He),g(xe);var ke=v(xe,2),ye=v(_(ke));B(ye),g(ke),g($);var re=v($,2),oe=v(_(re),2),Ce=v(_(oe));B(Ce),g(oe);var ge=v(oe,2),pe=v(_(ge));B(pe),g(ge),g(re);var _e=v(re,2),ce=v(_(_e),2),Le=v(_(ce));B(Le),g(ce);var Me=v(ce,2);Me.__click=le,g(_e),g(Q);var ee=v(Q,2),me=_(ee);H(me,o=>d=o,()=>d);var Pe=v(me,2);H(Pe,o=>f=o,()=>f),g(ee),H(ee,o=>n=o,()=>n);var De=v(ee,2),be=_(De),Oe=_(be);{var Fe=o=>{xi(o,{get tile(){return k(y)}})};ti(Oe,o=>{k(y)&&o(Fe)})}g(be),g(De),g(Y),q(He,()=>i.x,o=>i.x=o),q(ye,()=>i.y,o=>i.y=o),q(Ce,()=>e.x,o=>e.x=o),q(pe,()=>e.y,o=>e.y=o),$e(Le,()=>k(r),o=>K(r,o)),ze(s,Y),Ae()}Ve(["click"]);var pi=Ee('<button>update</button> <canvas width="500" height="500"></canvas>',1);function _i(s,t){Ie(t,!0);let e,i;tt(()=>{i=e.getContext("2d")}),We(()=>{t.map.render(i)});function a(){t.map.render(i)}var n=pi(),d=pt(n);d.__click=a;var f=v(d,2);H(f,m=>e=m,()=>e),ze(s,n),Ae()}Ve(["click"]);var mi=Ee('<div id="outer-wrapper" class="svelte-1ctsb4x"><h1 class="svelte-1ctsb4x"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1ctsb4x"><div class="tab svelte-1ctsb4x" id="tab-atlas"><h2 class="svelte-1ctsb4x">Tile Atlas</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab shown svelte-1ctsb4x" id="tab-sheet"><h2 class="svelte-1ctsb4x">Tile Sheet</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div> <div class="tab svelte-1ctsb4x" id="tab-map"><h2 class="svelte-1ctsb4x">Tile Map</h2> <div class="tab-content svelte-1ctsb4x"><!></div></div></div></div>');function Ii(s,t){Ie(t,!0);let e=ne(X([])),i,a=ne(!0),n,d=ne(void 0),f;We(()=>{i.addEventListener("pointerup",()=>{K(a,!0)}),n.addEventListener("pointerup",()=>{K(a,!1)})});let m=new oi({x:5,y:5},{x:64,y:64},[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);We(()=>{j.setAtlantes(k(e))});var p=mi();ei(S=>{$t.title="FUDGE Tilemap Editor"});var c=v(_(p),2),y=_(c),r=v(_(y),2),u=_(r);fi(u,{get atlantes(){return k(e)},set atlantes(S){K(e,X(S))},get activeAtlas(){return k(d)},set activeAtlas(S){K(d,X(S))}}),g(r),g(y),H(y,S=>i=S,()=>i);var h=v(y,2),C=v(_(h),2),L=_(C);gi(L,{get sheet(){return f},get selectedAtlas(){return k(d)}}),g(C),g(h);var w=v(h,2),z=v(_(w),2),W=_(z);_i(W,{map:m}),g(z),g(w),H(w,S=>n=S,()=>n),g(c),g(p),et(()=>{Qe(y,"shown",k(a)),Qe(w,"shown",!k(a))}),ze(s,p),Ae()}export{Ii as component};
