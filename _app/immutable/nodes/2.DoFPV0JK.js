var Qe=Object.defineProperty;var ke=a=>{throw TypeError(a)};var Ze=(a,e,t)=>e in a?Qe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Le=(a,e,t)=>Ze(a,typeof e!="symbol"?e+"":e,t),ze=(a,e,t)=>e.has(a)||ke("Cannot "+t);var r=(a,e,t)=>(ze(a,e,"read from private field"),t?t.call(a):e.get(a)),A=(a,e,t)=>e.has(a)?ke("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),z=(a,e,t,s)=>(ze(a,e,"write to private field"),s?s.call(a,t):e.set(a,t),t);import{t as ve,b as de}from"../chunks/KWiXXxW5.js";import{s as Me,a as Oe,b as $e,c as we,u as je,D as et,k as _e,w as O,g as tt,l as at,N,a1 as st,aj as it,ak as Re,j as pe,m as te,n as lt,al as Be,v as Ve,am as rt,aq as ye,r as We,ar as nt,a4 as ft,L as De,as as ot,at as vt,q as dt,au as ut,G as ht,av as ct,aw as gt,f as _t,i as pt,ax as yt,ay as mt,R as xt,az as bt,aA as wt,C as Tt,V as Et,x as ue,A as ae,ag as T,ai as y,ah as b,af as Ye,z as he,I as qe,ao as Ge,O as me}from"../chunks/CCR6oj6N.js";import{p as Fe,b as j,a as fe}from"../chunks/apz_SVJy.js";import{d as Ue}from"../chunks/B4Gdbx0_.js";import{o as At}from"../chunks/CxuClGhS.js";let Ce=!1;function Xe(){Ce||(Ce=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function It(a){var e=$e,t=we;Me(null),Oe(null);try{return a()}finally{Me(e),Oe(t)}}function St(a,e,t,s=t){a.addEventListener(e,()=>It(t));const i=a.__on_r;i?a.__on_r=()=>{i(),s(!0)}:a.__on_r=()=>s(!0),Xe()}function kt(a,e){return e}function Lt(a,e,t,s){for(var i=[],l=e.length,f=0;f<l;f++)vt(e[f].e,i,!0);var d=l>0&&i.length===0&&t!==null;if(d){var c=t.parentNode;dt(c),c.append(t),s.clear(),D(a,e[0].prev,e[l-1].next)}ut(i,()=>{for(var u=0;u<l;u++){var n=e[u];d||(s.delete(n.k),D(a,n.prev,n.next)),ht(n.e,!d)}})}function zt(a,e,t,s,i,l=null){var f=a,d={flags:e,items:new Map,first:null};{var c=a;f=O?_e(tt(c)):c.appendChild(je())}O&&at();var u=null,n=!1,p=st(()=>{var o=t();return pt(o)?o:o==null?[]:We(o)});et(()=>{var o=N(p),h=o.length;if(n&&h===0)return;n=h===0;let g=!1;if(O){var E=f.data===it;E!==(h===0)&&(f=Re(),_e(f),pe(!1),g=!0)}if(O){for(var I=null,_,w=0;w<h;w++){if(te.nodeType===8&&te.data===lt){f=te,g=!0,pe(!1);break}var P=o[w],M=s(P,w);_=Ke(te,d,I,null,P,M,w,i,e,t),d.items.set(M,_),I=_}h>0&&_e(Re())}O||Mt(o,d,f,i,e,s,t),l!==null&&(h===0?u?Be(u):u=Ve(()=>l(f)):u!==null&&rt(u,()=>{u=null})),g&&pe(!0),N(p)}),O&&(f=te)}function Mt(a,e,t,s,i,l,f){var d=a.length,c=e.items,u=e.first,n=u,p,o=null,h=[],g=[],E,I,_,w;for(w=0;w<d;w+=1){if(E=a[w],I=l(E,w),_=c.get(I),_===void 0){var P=n?n.e.nodes_start:t;o=Ke(P,e,o,o===null?e.first:o.next,E,I,w,s,i,f),c.set(I,o),h=[],g=[],n=o.next;continue}if(Ot(_,E,w),_.e.f&ye&&Be(_.e),_!==n){if(p!==void 0&&p.has(_)){if(h.length<g.length){var M=g[0],S;o=M.prev;var Y=h[0],q=h[h.length-1];for(S=0;S<h.length;S+=1)Pe(h[S],M,t);for(S=0;S<g.length;S+=1)p.delete(g[S]);D(e,Y.prev,q.next),D(e,o,Y),D(e,q,M),n=M,o=q,w-=1,h=[],g=[]}else p.delete(_),Pe(_,n,t),D(e,_.prev,_.next),D(e,_,o===null?e.first:o.next),D(e,o,_),o=_;continue}for(h=[],g=[];n!==null&&n.k!==I;)n.e.f&ye||(p??(p=new Set)).add(n),g.push(n),n=n.next;if(n===null)continue;_=n}h.push(_),o=_,n=_.next}if(n!==null||p!==void 0){for(var F=p===void 0?[]:We(p);n!==null;)n.e.f&ye||F.push(n),n=n.next;var le=F.length;if(le>0){var ee=d===0?t:null;Lt(e,F,ee,c)}}we.first=e.first&&e.first.e,we.last=o&&o.e}function Ot(a,e,t,s){nt(a.v,e),a.i=t}function Ke(a,e,t,s,i,l,f,d,c,u){var n=(c&ct)!==0,p=(c&gt)===0,o=n?p?ft(i):De(i):i,h=c&ot?De(f):f,g={i:h,v:o,k:l,a:null,e:null,prev:t,next:s};try{return g.e=Ve(()=>d(a,o,h,u),O),g.e.prev=t&&t.e,g.e.next=s&&s.e,t===null?e.first=g:(t.next=g,t.e.next=g.e),s!==null&&(s.prev=g,s.e.prev=g.e),g}finally{}}function Pe(a,e,t){for(var s=a.next?a.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=a.e.nodes_start;l!==s;){var f=_t(l);i.before(l),l=f}}function D(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function X(a){if(O){var e=!1,t=()=>{if(!e){if(e=!0,a.hasAttribute("value")){var s=a.value;J(a,"value",null),a.value=s}if(a.hasAttribute("checked")){var i=a.checked;J(a,"checked",null),a.checked=i}}};a.__on_r=t,yt(t),Xe()}}function J(a,e,t,s){var i=a.__attributes??(a.__attributes={});O&&(i[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="style"&&"__styles"in a&&(a.__styles={}),e==="loading"&&(a[mt]=t),t==null?a.removeAttribute(e):typeof t!="string"&&Rt(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var Ne=new Map;function Rt(a){var e=Ne.get(a.nodeName);if(e)return e;Ne.set(a.nodeName,e=[]);for(var t,s=a,i=Element.prototype;i!==s;){t=bt(s);for(var l in t)t[l].set&&e.push(l);s=xt(s)}return e}function He(a,e,t){if(t){if(a.classList.contains(e))return;a.classList.add(e)}else{if(!a.classList.contains(e))return;a.classList.remove(e)}}function K(a,e,t=e){var s=wt();St(a,"input",i=>{var l=i?a.defaultValue:a.value;if(l=xe(a)?be(l):l,t(l),s&&l!==(l=e())){var f=a.selectionStart,d=a.selectionEnd;a.value=l??"",d!==null&&(a.selectionStart=f,a.selectionEnd=Math.min(d,a.value.length))}}),(O&&a.defaultValue!==a.value||Tt(e)==null&&a.value)&&t(xe(a)?be(a.value):a.value),Et(()=>{var i=e();xe(a)&&i===be(a.value)||a.type==="date"&&!i&&!a.value||i!==a.value&&(a.value=i??"")})}function xe(a){var e=a.type;return e==="number"||e==="range"}function be(a){return a===""?null:+a}var m,H,Q,se,B,R,V;const oe=class oe{constructor(e,t={},s=e){A(this,m);A(this,H);A(this,Q);A(this,se);A(this,B);A(this,R,{x:0,y:0});A(this,V,{x:0,y:0});if(oe.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");z(this,Q,e),z(this,m,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),z(this,H,s),this.loadImg()}async loadImg(){if(r(this,B))return r(this,B);const e=document.createElement("img");return z(this,B,new Promise(t=>{e.addEventListener("load",()=>{z(this,R,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=r(this,Q),z(this,se,e),r(this,B)}get img(){return r(this,se)}get src(){return r(this,Q)}get id(){return r(this,H)}get dimensions(){return structuredClone(r(this,R))}get settings(){return r(this,m)}set settings(e){z(this,m,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:r(this,m).startOffset.x+(r(this,m).tileSize.x+r(this,m).tileGap.x)*(t%r(this,V).x),y:r(this,m).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/r(this,V).x),w:r(this,m).tileSize.x,h:r(this,m).tileSize.y}}createTiles(e){let t=0;const s=[];let i=0,l=0;for(let f=r(this,m).startOffset.y;f<r(this,R).y&&f+r(this,m).tileSize.y<=r(this,R).y;f+=r(this,m).tileSize.y+r(this,m).tileGap.y){i=0;for(let d=r(this,m).startOffset.x;d<r(this,R).x&&d+r(this,m).tileSize.x<=r(this,R).x;d+=r(this,m).tileSize.x+r(this,m).tileGap.x)s.push({type:"basic",id:e++,atlasId:r(this,H),indexInAtlas:t++,name:`${r(this,H)}_${t}`}),i++;l++}return r(this,V).x=i,r(this,V).y=l,s}};m=new WeakMap,H=new WeakMap,Q=new WeakMap,se=new WeakMap,B=new WeakMap,R=new WeakMap,V=new WeakMap,Le(oe,"existingIDs",new Set);let Te=oe;var G,C,Z,$,W,ie;class Dt{constructor(e,t,s,i){A(this,G);A(this,C);A(this,Z);A(this,$,new Map);A(this,W,new Map);A(this,ie,new Map);z(this,G,e),z(this,C,t),z(this,Z,i),this.setAtlantes(s),r(this,ie).set("basic",this.drawBasicTile)}setAtlantes(e){for(let s of e)r(this,W).set(s.id,s);r(this,$).clear();let t=1;for(let s of r(this,W).values()){let i=s.createTiles(t);t+=i.length,i.forEach(l=>r(this,$).set(l.id,l))}}async loadAtlantes(){const e=[];for(let t of r(this,W).values())e.push(t.loadImg());await Promise.all(e)}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<r(this,G).x;t++)for(let s=0;s<r(this,G).y;s++){const i=this.getTile(t,s);i&&(i.type=="basic"?r(this,ie).get("basic").call(this,e,i,s,t):i.type)}}getTile(e,t){return r(this,$).get(r(this,Z)[t*r(this,G).x+e])}setTile(e,t,s){let i=typeof s=="number"?s:s.id;r(this,Z)[t*r(this,G).x+e]=i}drawBasicTile(e,t,s,i){const l=r(this,W).get(t.atlasId);let{x:f,y:d,w:c,h:u}=l.getTilePosition(t.indexInAtlas);e.drawImage(l.img,f,d,c,u,r(this,C).x*i,r(this,C).y*s,r(this,C).x,r(this,C).y)}}G=new WeakMap,C=new WeakMap,Z=new WeakMap,$=new WeakMap,W=new WeakMap,ie=new WeakMap;var Gt=ve('<fieldset class="atlas-display"><fieldset><legend>Tile Size</legend> <label>width <input type="number" min="0" class="svelte-1h52ffh"></label> <label>height <input type="number" min="0" class="svelte-1h52ffh"></label></fieldset> <fieldset><legend>Tile Gap</legend> <label>width <input type="number" class="svelte-1h52ffh"></label> <label>height <input type="number" class="svelte-1h52ffh"></label></fieldset> <fieldset><legend>Offset</legend> <label>width <input type="number" class="svelte-1h52ffh"></label> <label>height <input type="number" width="5" class="svelte-1h52ffh"></label></fieldset> <div class="canvas-wrapper svelte-1h52ffh"><canvas></canvas> <canvas class="canvas-overlay svelte-1h52ffh"></canvas></div></fieldset>');function Ct(a,e){ue(e,!0);let t=Fe(e,"atlas",15),s,i,l,f=[],d,c;ae(()=>{i.addEventListener("pointermove",u),i.addEventListener("pointerleave",n),i.addEventListener("pointerup",p),l=i.getContext("2d")}),ae(()=>{const v=s.getContext("2d");v.clearRect(0,0,s.width,s.height),v.drawImage(t().img,0,0),v.lineWidth=1,v.strokeStyle="rgba(0, 0, 0, 0.5)",v.textAlign="right",f=t().createTiles(1);for(let x of f){let{x:k,y:L,w:U,h:ne}=t().getTilePosition(x);v.strokeRect(k,L,U,ne),v.fillText(x.id.toString(),k+U-1,L+ne-1,U)}});function u(v){const x=h(v);if(!x)return n();c=x,o()}function n(){c=void 0,o()}function p(v){const x=h(v);x&&(d=x,o())}function o(){if(l.clearRect(0,0,i.width,i.height),c){l.fillStyle="rgba(255, 255, 255, 0.5)";let{x:v,y:x,w:k,h:L}=t().getTilePosition(c);l.fillRect(v,x,k,L)}if(d){l.strokeStyle="rgba(255, 0, 0, 1)",l.lineWidth=1;let{x:v,y:x,w:k,h:L}=t().getTilePosition(d);l.strokeRect(v,x,k,L)}}function h(v){const x=i.getBoundingClientRect(),k=v.clientX-x.left,L=v.clientY-x.top;return g(k,L)}function g(v,x){for(let k of f){let{x:L,y:U,w:ne,h:Je}=t().getTilePosition(k);if(v>L&&v<L+ne&&x>U&&x<U+Je)return k}}var E=Gt(),I=T(E),_=y(T(I),2),w=y(T(_));X(w),b(_);var P=y(_,2),M=y(T(P));X(M),b(P),b(I);var S=y(I,2),Y=y(T(S),2),q=y(T(Y));X(q),b(Y);var F=y(Y,2),le=y(T(F));X(le),b(F),b(S);var ee=y(S,2),ce=y(T(ee),2),Ee=y(T(ce));X(Ee),b(ce);var Ae=y(ce,2),Ie=y(T(Ae));X(Ie),b(Ae),b(ee);var Se=y(ee,2),re=T(Se);j(re,v=>s=v,()=>s);var ge=y(re,2);j(ge,v=>i=v,()=>i),b(Se),b(E),Ye(()=>{J(re,"width",t().img.naturalWidth),J(re,"height",t().img.naturalHeight),J(ge,"width",t().img.naturalWidth),J(ge,"height",t().img.naturalHeight)}),K(w,()=>t().settings.tileSize.x,v=>t(t().settings.tileSize.x=v,!0)),K(M,()=>t().settings.tileSize.y,v=>t(t().settings.tileSize.y=v,!0)),K(q,()=>t().settings.tileGap.x,v=>t(t().settings.tileGap.x=v,!0)),K(le,()=>t().settings.tileGap.y,v=>t(t().settings.tileGap.y=v,!0)),K(Ee,()=>t().settings.startOffset.x,v=>t(t().settings.startOffset.x=v,!0)),K(Ie,()=>t().settings.startOffset.y,v=>t(t().settings.startOffset.y=v,!0)),de(a,E),he()}var Pt=ve('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function Nt(a,e){ue(e,!0);let t,s=Fe(e,"atlantes",27,()=>fe([]));async function i(u){if(t.files)for(let n of t.files){let p=await l(n),o=fe({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const h=new Te(p,o,Math.random().toString());await h.loadImg(),s().push(h)}}async function l(u){return new Promise(n=>{const p=new FileReader;p.onload=()=>n(p.result),p.readAsDataURL(u)})}var f=Pt(),d=qe(f);d.__change=i,j(d,u=>t=u,()=>t);var c=y(d,2);zt(c,21,s,kt,(u,n)=>{Ct(u,{get atlas(){return N(n)}})}),b(c),de(a,f),he()}Ue(["change"]);var Ht=ve('<button>update</button> <canvas width="500" height="500"></canvas>',1);function Bt(a,e){ue(e,!0);let t,s;At(()=>{s=t.getContext("2d")}),ae(()=>{e.map.render(s)});function i(){e.map.render(s)}var l=Ht(),f=qe(l);f.__click=i;var d=y(f,2);j(d,c=>t=c,()=>t),de(a,l),he()}Ue(["click"]);var Vt=ve('<div id="outer-wrapper" class="svelte-1a6ydla"><h1 class="svelte-1a6ydla"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1a6ydla"><div class="tab svelte-1a6ydla" id="tab-atlas"><h2 class="svelte-1a6ydla">Tile Atlas</h2> <div class="tab-content svelte-1a6ydla"><!></div></div> <div class="tab shown svelte-1a6ydla" id="tab-sheet"><h2 class="svelte-1a6ydla">Tile Sheet</h2> <div class="tab-content svelte-1a6ydla"></div></div> <div class="tab svelte-1a6ydla" id="tab-map"><h2 class="svelte-1a6ydla">Tile Map</h2> <div class="tab-content svelte-1a6ydla"><!></div></div></div></div>');function Kt(a,e){ue(e,!0);let t=Ge(fe([])),s,i=Ge(!0),l;ae(()=>{s.addEventListener("pointerup",()=>{me(i,!0)}),l.addEventListener("pointerup",()=>{me(i,!1)})});let f=new Dt({x:5,y:5},{x:64,y:64},[],[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);ae(()=>{f.setAtlantes(N(t))});var d=Vt(),c=y(T(d),2),u=T(c),n=y(T(u),2),p=T(n);Nt(p,{get atlantes(){return N(t)},set atlantes(E){me(t,fe(E))}}),b(n),b(u),j(u,E=>s=E,()=>s);var o=y(u,4),h=y(T(o),2),g=T(h);Bt(g,{map:f}),b(h),b(o),j(o,E=>l=E,()=>l),b(c),b(d),Ye(()=>{He(u,"shown",N(i)),He(o,"shown",!N(i))}),de(a,d),he()}export{Kt as component};
