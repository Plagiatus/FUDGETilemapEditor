var yt=Object.defineProperty;var tt=i=>{throw TypeError(i)};var pt=(i,e,t)=>e in i?yt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var $=(i,e,t)=>pt(i,typeof e!="symbol"?e+"":e,t),it=(i,e,t)=>e.has(i)||tt("Cannot "+t);var r=(i,e,t)=>(it(i,e,"read from private field"),t?t.call(i):e.get(i)),O=(i,e,t)=>e.has(i)?tt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),R=(i,e,t,a)=>(it(i,e,"write to private field"),a?a.call(i,t):e.set(i,t),t);import{t as Ee,a as Ie}from"../chunks/hIg5T22g.js";import{i as xt,b as mt,s as Xe,h as H,j as bt,p as _t,v as k,a0 as wt,P as Tt,Q as at,R as Ue,f as Oe,aj as St,V as ot,d as dt,W as It,as as qe,an as ct,m as st,at as kt,a7 as Et,I as lt,O as At,au as zt,av as Mt,am as Lt,aw as Ct,e as Dt,ax as Pt,ay as Ot,ag as Gt,az as Nt,aA as Rt,N as Bt,aB as Yt,aC as Ft,a as ft,Y as vt,z as Re,u as ke,aq as ae,C as m,F as u,D as p,A as $e,K as Z,B as Be,g as ht,x as Ht,aD as Vt}from"../chunks/DTLesvzz.js";import{a as Wt,l as ut,d as je,e as Xt,s as Ut,b as qt}from"../chunks/TTt9i3EO.js";import{p as He,b as K,a as V,i as Kt}from"../chunks/DcMo27e_.js";import{o as Qt}from"../chunks/DvFFM99j.js";function Jt(i,e){return e}function Zt(i,e,t,a){for(var s=[],n=e.length,f=0;f<n;f++)Mt(e[f].e,s,!0);var _=n>0&&s.length===0&&t!==null;if(_){var g=t.parentNode;Lt(g),g.append(t),a.clear(),j(i,e[0].prev,e[n-1].next)}Ct(s,()=>{for(var T=0;T<n;T++){var v=e[T];_||(a.delete(v.k),j(i,v.prev,v.next)),Dt(v.e,!_)}})}function $t(i,e,t,a,s,n=null){var f=i,_={flags:e,items:new Map,first:null};{var g=i;f=H?Xe(bt(g)):g.appendChild(xt())}H&&_t();var T=null,v=!1,x=wt(()=>{var d=t();return At(d)?d:d==null?[]:ct(d)});mt(()=>{var d=k(x),y=d.length;if(v&&y===0)return;v=y===0;let b=!1;if(H){var C=f.data===Tt;C!==(y===0)&&(f=at(),Xe(f),Ue(!1),b=!0)}if(H){for(var D=null,c,E=0;E<y;E++){if(Oe.nodeType===8&&Oe.data===St){f=Oe,b=!0,Ue(!1);break}var G=d[E],A=a(G,E);c=gt(Oe,_,D,null,G,A,E,s,e,t),_.items.set(A,c),D=c}y>0&&Xe(at())}H||jt(d,_,f,s,e,a,t),n!==null&&(y===0?T?ot(T):T=dt(()=>n(f)):T!==null&&It(T,()=>{T=null})),b&&Ue(!0),k(x)}),H&&(f=Oe)}function jt(i,e,t,a,s,n,f){var _=i.length,g=e.items,T=e.first,v=T,x,d=null,y=[],b=[],C,D,c,E;for(E=0;E<_;E+=1){if(C=i[E],D=n(C,E),c=g.get(D),c===void 0){var G=v?v.e.nodes_start:t;d=gt(G,e,d,d===null?e.first:d.next,C,D,E,a,s,f),g.set(D,d),y=[],b=[],v=d.next;continue}if(ei(c,C,E),c.e.f&qe&&ot(c.e),c!==v){if(x!==void 0&&x.has(c)){if(y.length<b.length){var A=b[0],N;d=A.prev;var W=y[0],Q=y[y.length-1];for(N=0;N<y.length;N+=1)nt(y[N],A,t);for(N=0;N<b.length;N+=1)x.delete(b[N]);j(e,W.prev,Q.next),j(e,d,W),j(e,Q,A),v=A,d=Q,E-=1,y=[],b=[]}else x.delete(c),nt(c,v,t),j(e,c.prev,c.next),j(e,c,d===null?e.first:d.next),j(e,d,c),d=c;continue}for(y=[],b=[];v!==null&&v.k!==D;)v.e.f&qe||(x??(x=new Set)).add(v),b.push(v),v=v.next;if(v===null)continue;c=v}y.push(c),d=c,v=c.next}if(v!==null||x!==void 0){for(var X=x===void 0?[]:ct(x);v!==null;)v.e.f&qe||X.push(v),v=v.next;var U=X.length;if(U>0){var F=_===0?t:null;Zt(e,X,F,g)}}st.first=e.first&&e.first.e,st.last=d&&d.e}function ei(i,e,t,a){kt(i.v,e),i.i=t}function gt(i,e,t,a,s,n,f,_,g,T){var v=(g&Pt)!==0,x=(g&Ot)===0,d=v?x?Et(s):lt(s):s,y=g&zt?lt(f):f,b={i:y,v:d,k:n,a:null,e:null,prev:t,next:a};try{return b.e=dt(()=>_(i,d,y,T),H),b.e.prev=t&&t.e,b.e.next=a&&a.e,t===null?e.first=b:(t.next=b,t.e.next=b.e),a!==null&&(a.prev=b,a.e.prev=b.e),b}finally{}}function nt(i,e,t){for(var a=i.next?i.next.e.nodes_start:t,s=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==a;){var f=Gt(n);s.before(n),n=f}}function j(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Y(i){if(H){var e=!1,t=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var a=i.value;re(i,"value",null),i.value=a}if(i.hasAttribute("checked")){var s=i.checked;re(i,"checked",null),i.checked=s}}};i.__on_r=t,Nt(t),Wt()}}function re(i,e,t,a){var s=i.__attributes??(i.__attributes={});H&&(s[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[Rt]=t),t==null?i.removeAttribute(e):typeof t!="string"&&ti(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var rt=new Map;function ti(i){var e=rt.get(i.nodeName);if(e)return e;rt.set(i.nodeName,e=[]);for(var t,a=i,s=Element.prototype;s!==a;){t=Yt(a);for(var n in t)t[n].set&&e.push(n);a=Bt(a)}return e}function Je(i,e,t){if(t){if(i.classList.contains(e))return;i.classList.add(e)}else{if(!i.classList.contains(e))return;i.classList.remove(e)}}function q(i,e,t=e){var a=Ft();ut(i,"input",s=>{var n=s?i.defaultValue:i.value;if(n=Ke(i)?Qe(n):n,t(n),a&&n!==(n=e())){var f=i.selectionStart,_=i.selectionEnd;i.value=n??"",_!==null&&(i.selectionStart=f,i.selectionEnd=Math.min(_,i.value.length))}}),(H&&i.defaultValue!==i.value||ft(e)==null&&i.value)&&t(Ke(i)?Qe(i.value):i.value),vt(()=>{var s=e();Ke(i)&&s===Qe(i.value)||i.type==="date"&&!s&&!i.value||s!==i.value&&(i.value=s??"")})}function Ze(i,e,t=e){ut(i,"change",a=>{var s=a?i.defaultChecked:i.checked;t(s)}),(H&&i.defaultChecked!==i.checked||ft(e)==null)&&t(i.checked),vt(()=>{var a=e();i.checked=!!a})}function Ke(i){var e=i.type;return e==="number"||e==="range"}function Qe(i){return i===""?null:+i}var L,oe,we,Ne,de,J,ee,Te;const Ge=class Ge{constructor(e,t={},a=e){O(this,L);O(this,oe);O(this,we);O(this,Ne);O(this,de);O(this,J,{x:0,y:0});O(this,ee,{x:0,y:0});O(this,Te);if(Ge.existingIDs.has(a))throw Error("A Tile Atlas with this ID already exists.");R(this,we,e),R(this,L,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),R(this,oe,a),this.loadImg()}async loadImg(){if(r(this,de))return r(this,de);const e=document.createElement("img");return R(this,de,new Promise(t=>{e.addEventListener("load",()=>{R(this,J,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=r(this,we),R(this,Ne,e),r(this,de)}get img(){return r(this,Ne)}get src(){return r(this,we)}get id(){return r(this,oe)}get dimensions(){return structuredClone(r(this,J))}get tileAmount(){return structuredClone(r(this,ee))}get settings(){return r(this,L)}set settings(e){R(this,L,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:r(this,L).startOffset.x+(r(this,L).tileSize.x+r(this,L).tileGap.x)*(t%r(this,ee).x),y:r(this,L).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/r(this,ee).x),w:r(this,L).tileSize.x,h:r(this,L).tileSize.y}}createTiles(){let e=0,t=0;const a=[];let s=0,n=0;for(let f=r(this,L).startOffset.y;f<r(this,J).y&&f+r(this,L).tileSize.y<=r(this,J).y;f+=r(this,L).tileSize.y+r(this,L).tileGap.y){s=0;for(let _=r(this,L).startOffset.x;_<r(this,J).x&&_+r(this,L).tileSize.x<=r(this,J).x;_+=r(this,L).tileSize.x+r(this,L).tileGap.x)a.push({type:"basic",id:e++,atlasId:r(this,oe),indexInAtlas:t++,name:`${r(this,oe)}_${t}`}),s++;n++}return r(this,ee).x=s,r(this,ee).y=n,R(this,Te,[...a]),a}getTiles(){return r(this,Te)||this.createTiles(),r(this,Te)}};L=new WeakMap,oe=new WeakMap,we=new WeakMap,Ne=new WeakMap,de=new WeakMap,J=new WeakMap,ee=new WeakMap,Te=new WeakMap,$(Ge,"existingIDs",new Set),$(Ge,"selectedTiles",[]);let B=Ge;var ce,fe,te;class ii{constructor(e,t){O(this,ce,[]);O(this,fe,{x:20,y:20});O(this,te,{x:64,y:64});this.mapSize=e,this.tileSize=t}get mapSize(){return r(this,fe)}set mapSize(e){R(this,fe,e)}get tileSize(){return r(this,te)}set tileSize(e){R(this,te,e)}setTile(e,t){r(this,ce)[t.y]||(r(this,ce)[t.y]=[]),r(this,ce)[t.y][t.x]=e}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<r(this,fe).y;t++)for(let a=0;a<r(this,fe).x;a++){const s=this.getTile({x:a,y:t});s&&se.drawTile(s,e,{x:r(this,te).x*a,y:r(this,te).y*t},r(this,te))}}getTile(e){var t;return(t=r(this,ce)[e.y])==null?void 0:t[e.x]}}ce=new WeakMap,fe=new WeakMap,te=new WeakMap;var ie,ve,Se;class ai{constructor(e,t,a){O(this,ie);O(this,ve);O(this,Se);R(this,ie,e),R(this,ve,t),R(this,Se,a.map(s=>typeof s=="number"?se.getTile(s):s))}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<r(this,ie).x;t++)for(let a=0;a<r(this,ie).y;a++){const s=this.getTile(t,a);s&&se.drawTile(s,e,{x:r(this,ve).x*t,y:r(this,ve).y*t},r(this,ve))}}getTile(e,t){return r(this,Se)[t*r(this,ie).x+e]}setTile(e,t,a){r(this,Se)[t*r(this,ie).x+e]=a}}ie=new WeakMap,ve=new WeakMap,Se=new WeakMap;const P=class P{constructor(){if(P.Instance)return P.Instance;P.renderMethod.set("basic",P.drawBasicTile),P.renderMethod.set("rule",P.drawRuleTile)}static setAtlantes(e){for(const t of e)this.atlantes.set(t.id,t);this.recalculateTileIds()}static recalculateTileIds(){let e=1;const t=new Map;for(let a of this.atlantes.values())a.getTiles().forEach(n=>{n.id=e++,t.set(n.id,n)});for(let a of this.tileIndex.values())a.type!=="basic"&&(a.id=t.size+1,t.set(a.id,a));this.tileIndex=t}static addTile(e){this.tileIndex.set(e.id,e)}static newTile(e,t=""){this.recalculateTileIds();let a=this.tileIndex.size;for(;this.tileIndex.has(a);)a++;let s={type:e,default:void 0,id:a,name:t,rules:[]};return this.addTile(s),s}static getTile(e){return this.tileIndex.get(e)}static drawTile(e,t,a,s){var n;if(typeof e=="number"&&(e=this.tileIndex.get(e)),!!e){if(!P.renderMethod.has(e.type))throw new Error(`Cannot draw tile type "${e.type}": No known renderer.`);(n=P.renderMethod.get(e.type))==null||n(e,t,a,s)}}static drawRuleTile(e,t,a,s){}};$(P,"renderMethod",new Map),$(P,"atlantes",new Map),$(P,"tileIndex",new Map),$(P,"drawBasicTile",(e,t,a,s)=>{const n=P.atlantes.get(e.atlasId);if(!n)throw new Error(`Atlas "${e.atlasId}" not found.`);let{x:f,y:_,w:g,h:T}=n.getTilePosition(e.indexInAtlas);t.drawImage(n.img,f,_,g,T,a.x,a.y,s.x,s.y)}),$(P,"Instance",new P);let se=P;var si=Ee('<fieldset class="atlas-display svelte-1lh5lbv"><img class="img-preview svelte-1lh5lbv" alt=""> <div class="canvas-wrapper svelte-1lh5lbv"><canvas></canvas> <canvas class="canvas-overlay svelte-1lh5lbv"></canvas></div> <div class="settings-wrapper svelte-1lh5lbv"><fieldset><legend>Tile Size</legend> <label>width <input type="number" min="0" class="svelte-1lh5lbv"></label> <label>height <input type="number" min="0" class="svelte-1lh5lbv"></label></fieldset> <fieldset><legend>Tile Gap</legend> <label>width <input type="number" class="svelte-1lh5lbv"></label> <label>height <input type="number" class="svelte-1lh5lbv"></label></fieldset> <fieldset><legend>Offset</legend> <label>width <input type="number" class="svelte-1lh5lbv"></label> <label>height <input type="number" width="5" class="svelte-1lh5lbv"></label></fieldset> <fieldset><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label></fieldset></div></fieldset>');function li(i,e){Re(e,!0);let t=He(e,"atlas",15),a,s,n,f,_=[],g=new Set,T,v=ae(!0),x=ae(!0);ke(()=>{n.addEventListener("click",()=>{e.activate(t()),d()}),s.addEventListener("pointermove",y),s.addEventListener("pointerleave",b),s.addEventListener("pointerup",C),s.addEventListener("contextmenu",o=>o.preventDefault()),f=s.getContext("2d")});function d(){if(g.size==0){B.selectedTiles=[];return}const o=t().tileAmount,w={x:1/0,y:1/0},z={x:-1/0,y:-1/0};g.forEach(M=>{const I={x:M.indexInAtlas%o.x,y:Math.floor(M.indexInAtlas/o.x)};w.x>I.x&&(w.x=I.x),w.y>I.y&&(w.y=I.y),z.x<I.x&&(z.x=I.x),z.y<I.y&&(z.y=I.y)}),B.selectedTiles=Array.from({length:z.y-w.y+1},()=>[]),g.forEach(M=>{const I={x:M.indexInAtlas%o.x-w.x,y:Math.floor(M.indexInAtlas/o.x)-w.y};B.selectedTiles[I.y][I.x]=M})}ke(()=>{const o=a.getContext("2d");o.clearRect(0,0,a.width,a.height),o.drawImage(t().img,0,0),o.lineWidth=1,o.strokeStyle="rgba(0, 0, 0, 0.5)",o.textAlign="right",_=t().createTiles();for(let w of _){let{x:z,y:M,w:I,h:_e}=t().getTilePosition(w);k(x)&&o.strokeRect(z,M,I,_e),k(v)&&o.fillText(w.id.toString(),z+I-1,M+_e-1,I)}});function y(o){const w=c(o);if(!w)return b();T=w,D()}function b(){T=void 0,D()}function C(o){const w=c(o);w&&(o.ctrlKey?g.has(w)?g.delete(w):g.add(w):g.has(w)&&g.size===1?g.clear():(g.clear(),g.add(w)),D(),d())}function D(){if(f.clearRect(0,0,s.width,s.height),T){f.fillStyle="rgba(255, 255, 255, 0.5)";let{x:o,y:w,w:z,h:M}=t().getTilePosition(T);f.fillRect(o,w,z,M)}for(let o of g.values()){f.strokeStyle="rgba(255, 0, 0, 1)",f.lineWidth=1;let{x:w,y:z,w:M,h:I}=t().getTilePosition(o);f.strokeRect(w,z,M,I)}}function c(o){const w=s.getBoundingClientRect(),z=o.clientX-w.left,M=o.clientY-w.top;return E(z,M)}function E(o,w){for(let z of _){let{x:M,y:I,w:_e,h:Ve}=t().getTilePosition(z);if(o>M&&o<M+_e&&w>I&&w<I+Ve)return z}}var G=si(),A=m(G),N=u(A,2),W=m(N);K(W,o=>a=o,()=>a);var Q=u(W,2);K(Q,o=>s=o,()=>s),p(N);var X=u(N,2),U=m(X),F=u(m(U),2),Ye=u(m(F));Y(Ye),p(F);var Ae=u(F,2),Fe=u(m(Ae));Y(Fe),p(Ae),p(U);var le=u(U,2),ne=u(m(le),2),he=u(m(ne));Y(he),p(ne);var ue=u(ne,2),ze=u(m(ue));Y(ze),p(ue),p(le);var ge=u(le,2),ye=u(m(ge),2),pe=u(m(ye));Y(pe),p(ye);var xe=u(ye,2),Me=u(m(xe));Y(Me),p(xe),p(ge);var Le=u(ge,2),me=u(m(Le),2),Ce=u(m(me));Y(Ce),p(me);var be=u(me,2),De=u(m(be));Y(De),p(be),p(Le),p(X),p(G),K(G,o=>n=o,()=>n),$e(()=>{Je(G,"active",e.active),re(A,"src",t().src),re(W,"width",t().img.naturalWidth),re(W,"height",t().img.naturalHeight),re(Q,"width",t().img.naturalWidth),re(Q,"height",t().img.naturalHeight)}),q(Ye,()=>t().settings.tileSize.x,o=>t(t().settings.tileSize.x=o,!0)),q(Fe,()=>t().settings.tileSize.y,o=>t(t().settings.tileSize.y=o,!0)),q(he,()=>t().settings.tileGap.x,o=>t(t().settings.tileGap.x=o,!0)),q(ze,()=>t().settings.tileGap.y,o=>t(t().settings.tileGap.y=o,!0)),q(pe,()=>t().settings.startOffset.x,o=>t(t().settings.startOffset.x=o,!0)),q(Me,()=>t().settings.startOffset.y,o=>t(t().settings.startOffset.y=o,!0)),Ze(Ce,()=>k(v),o=>Z(v,o)),Ze(De,()=>k(x),o=>Z(x,o)),Ie(i,G),Be()}var ni=Ee('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function ri(i,e){Re(e,!0);let t,a=He(e,"atlantes",27,()=>V([])),s=He(e,"activeAtlas",15);async function n(x){if(t.files)for(let d of t.files){let y=await f(d),b=V({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const C=new B(y,b,Math.random().toString());await C.loadImg(),a().push(C),s(C)}}async function f(x){return new Promise(d=>{const y=new FileReader;y.onload=()=>d(y.result),y.readAsDataURL(x)})}function _(x){s(x)}var g=ni(),T=ht(g);T.__change=n,K(T,x=>t=x,()=>t);var v=u(T,2);$t(v,21,a,Jt,(x,d)=>{const y=Ht(()=>s()==k(d));li(x,{get atlas(){return k(d)},activate:_,get active(){return k(y)}})}),p(v),Ie(i,g),Be()}je(["change"]);var oi=Ee('<div id="tile-info" class="svelte-8wdc43"><canvas></canvas> </div>'),di=Ee('<div id="sheet-wrapper" class="svelte-8wdc43"><fieldset><fieldset><legend>Tile Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset><legend>Sheet Size</legend> <label>width<input type="number" min="0"></label> <label>height<input type="number" min="0"></label></fieldset> <fieldset><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-8wdc43"><canvas id="sheet-canvas" class="svelte-8wdc43"></canvas> <canvas id="overlay-canvas" class="svelte-8wdc43"></canvas></div> <div id="tile-info-wrapper" class="svelte-8wdc43"><!></div></div>');function ci(i,e){Re(e,!0);let t=V({x:20,y:20}),a=V({x:16,y:16}),s=He(e,"sheet",27,()=>V(new ii(t,a))),n,f,_,g,T,v=ae(void 0),x=ae(!0),d,y=ae(V({x:0,y:0})),b=!1,C=!1,D=!1,c={scale:1,translate:{x:0,y:0}};ke(()=>{n.addEventListener("pointermove",E),n.addEventListener("pointerleave",G),n.addEventListener("pointerup",N),n.addEventListener("pointerdown",A),n.addEventListener("contextmenu",h=>h.preventDefault()),g=n.getContext("2d");let l=n.getBoundingClientRect();n.width=l.width,f.width=l.width,n.height=l.height,f.height=l.height,T=f.getContext("2d"),a.x&&a.y&&(d=void 0),F()});function E(l){const h=X(l);if(b&&(c.translate.x+=l.movementX,c.translate.y+=l.movementY),D){const S=U(h);S&&s().setTile(void 0,S)}C&&W(),F()}function G(l){}function A(l){const h=X(l);if(l.button===0&&(C=!0,l.preventDefault()),l.button===1&&(b=!0,l.preventDefault()),l.button===2){D=!0;const S=U(h);S&&s().setTile(void 0,S),l.preventDefault()}}function N(l){X(l),l.button===0?(C=!1,W()):l.button===1?b=!1:l.button===2&&(D=!1),F()}function W(){const l=U(k(y));if(l)if(B.selectedTiles.length>0)for(let h=0;h<B.selectedTiles.length;h++)for(let S=0;S<B.selectedTiles[h].length;S++)B.selectedTiles[h][S]&&(l.x+S>=s().mapSize.x||l.y+h>=s().mapSize.y||s().setTile(B.selectedTiles[h][S],{x:l.x+S,y:l.y+h}));else{let h=s().getTile(l);h||(h=se.newTile("rule"),s().setTile(h,k(y))),Z(v,V(h))}}function Q(l){l.preventDefault();const h=n.getBoundingClientRect(),S={x:l.clientX-h.left,y:l.clientY-h.top},Pe=-Math.sign(l.deltaY),We=c.scale;c.scale*=Math.pow(2,Pe);const et=c.scale/We;c.translate.x=S.x+(c.translate.x-S.x)*et,c.translate.y=S.y+(c.translate.y-S.y)*et,F()}function X(l){const h=n.getBoundingClientRect(),S={x:(l.clientX-h.left-c.translate.x)/c.scale,y:(l.clientY-h.top-c.translate.y)/c.scale};return Z(y,V(S)),S}function U(l){const h={x:Math.floor(l.x/a.x),y:Math.floor(l.y/a.y)};if(!(h.x<0||h.y<0)&&!(h.x>=s().mapSize.x||h.y>=s().mapSize.y))return h}function F(){if(Ae(g),s().render(g),g.strokeStyle="rgba(0, 0, 0, 1)",g.lineWidth=1,!d){d=new Path2D;for(let l=0;l<t.y;l++)for(let h=0;h<t.x;h++)d.moveTo(h*a.x,l*a.y+a.y),d.lineTo(h*a.x,l*a.y),d.lineTo(h*a.x+a.x,l*a.y);d.moveTo(0,t.y*a.y),d.lineTo(t.x*a.x,t.y*a.y),d.lineTo(t.x*a.x,0)}k(x)&&g.stroke(d),Ye()}function Ye(){Ae(T);const l=U(k(y));if(l)for(let h=0;h<B.selectedTiles.length;h++)for(let S=0;S<B.selectedTiles[h].length;S++){if(l.x+S>=s().mapSize.x||l.y+h>=s().mapSize.y)continue;const Pe={x:(l.x+S)*s().tileSize.x,y:(l.y+h)*s().tileSize.y};se.drawTile(B.selectedTiles[h][S],T,Pe,a)}}function Ae(l){l.reset(),l.translate(c.translate.x,c.translate.y),l.scale(c.scale,c.scale),l.clearRect(0,0,n.width,n.height)}function Fe(){c.scale=1,c.translate.x=0,c.translate.y=0,F()}var le=di(),ne=m(le),he=m(ne),ue=u(m(he),2),ze=u(m(ue));Y(ze),p(ue);var ge=u(ue,2),ye=u(m(ge));Y(ye),p(ge),p(he);var pe=u(he,2),xe=u(m(pe),2),Me=u(m(xe));Y(Me),p(xe);var Le=u(xe,2),me=u(m(Le));Y(me),p(Le),p(pe);var Ce=u(pe,2),be=u(m(Ce),2),De=u(m(be));Y(De),p(be);var o=u(be,2);o.__click=Fe,p(Ce),p(ne);var w=u(ne,2),z=m(w);K(z,l=>n=l,()=>n);var M=u(z,2);K(M,l=>f=l,()=>f),p(w);var I=u(w,2),_e=m(I);{var Ve=l=>{var h=oi(),S=m(h);K(S,We=>_=We,()=>_);var Pe=u(S);p(h),$e(()=>Ut(Pe,` ${k(v).id??""}, ${k(v).type??""}`)),Ie(l,h)};Kt(_e,l=>{k(v)&&l(Ve)})}p(I),p(le),q(ze,()=>a.x,l=>a.x=l),q(ye,()=>a.y,l=>a.y=l),q(Me,()=>t.x,l=>t.x=l),q(me,()=>t.y,l=>t.y=l),Ze(De,()=>k(x),l=>Z(x,l)),Xt("wheel",z,Q),Ie(i,le),Be()}je(["click"]);var fi=Ee('<button>update</button> <canvas width="500" height="500"></canvas>',1);function vi(i,e){Re(e,!0);let t,a;Qt(()=>{a=t.getContext("2d")}),ke(()=>{e.map.render(a)});function s(){e.map.render(a)}var n=fi(),f=ht(n);f.__click=s;var _=u(f,2);K(_,g=>t=g,()=>t),Ie(i,n),Be()}je(["click"]);var hi=Ee('<div id="outer-wrapper" class="svelte-1m8kp7h"><h1 class="svelte-1m8kp7h"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-1m8kp7h"><div class="tab svelte-1m8kp7h" id="tab-atlas"><h2 class="svelte-1m8kp7h">Tile Atlas</h2> <div class="tab-content svelte-1m8kp7h"><!></div></div> <div class="tab shown svelte-1m8kp7h" id="tab-sheet"><h2 class="svelte-1m8kp7h">Tile Sheet</h2> <div class="tab-content svelte-1m8kp7h"><!></div></div> <div class="tab svelte-1m8kp7h" id="tab-map"><h2 class="svelte-1m8kp7h">Tile Map</h2> <div class="tab-content svelte-1m8kp7h"><!></div></div></div></div>');function _i(i,e){Re(e,!0);let t=ae(V([])),a,s=ae(!0),n,f=ae(void 0),_;ke(()=>{a.addEventListener("pointerup",()=>{Z(s,!0)}),n.addEventListener("pointerup",()=>{Z(s,!1)})});let g=new ai({x:5,y:5},{x:64,y:64},[1,2,2,2,3,9,10,10,10,11,9,10,10,10,11,9,10,10,10,11,17,18,18,18,19]);ke(()=>{se.setAtlantes(k(t))});var T=hi();qt(A=>{Vt.title="FUDGE Tilemap Editor"});var v=u(m(T),2),x=m(v),d=u(m(x),2),y=m(d);ri(y,{get atlantes(){return k(t)},set atlantes(A){Z(t,V(A))},get activeAtlas(){return k(f)},set activeAtlas(A){Z(f,V(A))}}),p(d),p(x),K(x,A=>a=A,()=>a);var b=u(x,2),C=u(m(b),2),D=m(C);ci(D,{get sheet(){return _},get selectedAtlas(){return k(f)}}),p(C),p(b);var c=u(b,2),E=u(m(c),2),G=m(E);vi(G,{map:g}),p(E),p(c),K(c,A=>n=A,()=>n),p(v),p(T),$e(()=>{Je(x,"shown",k(s)),Je(c,"shown",!k(s))}),Ie(i,T),Be()}export{_i as component};
