var Wt=Object.defineProperty;var pt=i=>{throw TypeError(i)};var Yt=(i,e,t)=>e in i?Wt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var ee=(i,e,t)=>Yt(i,typeof e!="symbol"?e+"":e,t),xt=(i,e,t)=>e.has(i)||pt("Cannot "+t);var o=(i,e,t)=>(xt(i,e,"read from private field"),t?t.call(i):e.get(i)),H=(i,e,t)=>e.has(i)?pt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),j=(i,e,t,s)=>(xt(i,e,"write to private field"),s?s.call(i,t):e.set(i,t),t);import{t as ye,a as he}from"../chunks/BwxUIiUG.js";import{s as _t,g as mt,j as jt,k as ot,l as qt,b as Ht,q as tt,h as se,r as Ut,v as Xt,Q as w,ai as Jt,a7 as Kt,a8 as bt,p as it,c as Ye,w as Qt,a9 as kt,a as Et,aa as Zt,at as st,A as Ft,af as ei,a0 as wt,i as ti,au as ht,av as ii,z as si,aw as ai,d as li,ax as gt,ay as ni,o as ri,az as It,ad as oi,aA as St,aB as ci,aC as ui,aD as di,a6 as fi,aE as vi,aF as hi,G as Je,ac as Ct,C as $e,Y as g,V as Ge,F as Ne,W as z,X as S,ar as ae,a3 as te,f as Pt,S as gi,J as ct,aG as yi}from"../chunks/DsVg9zyT.js";import{d as Ve,s as ut,a as pi}from"../chunks/CSUlgdZ8.js";import{p as Re,a as V,s as me,c as xi,d as qe,b as le,e as We,i as Dt,m as _i}from"../chunks/D1FPw6M6.js";import{w as Mt,o as Ze,g as Rt}from"../chunks/BPnQOLfX.js";let Tt=!1;function Lt(){Tt||(Tt=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function mi(i){var e=jt,t=ot;_t(null),mt(null);try{return i()}finally{_t(e),mt(t)}}function $t(i,e,t,s=t){i.addEventListener(e,()=>mi(t));const a=i.__on_r;a?i.__on_r=()=>{a(),s(!0)}:i.__on_r=()=>s(!0),Lt()}function bi(i,e){return e}function wi(i,e,t,s){for(var a=[],l=e.length,c=0;c<l;c++)ii(e[c].e,a,!0);var d=l>0&&a.length===0&&t!==null;if(d){var f=t.parentNode;si(f),f.append(t),s.clear(),we(i,e[0].prev,e[l-1].next)}ai(a,()=>{for(var I=0;I<l;I++){var y=e[I];d||(s.delete(y.k),we(i,y.prev,y.next)),li(y.e,!d)}})}function dt(i,e,t,s,a,l=null){var c=i,d={flags:e,items:new Map,first:null},f=(e&It)!==0;if(f){var I=i;c=se?tt(Ut(I)):I.appendChild(qt())}se&&Xt();var y=null,x=!1,v=Jt(()=>{var m=t();return ti(m)?m:m==null?[]:Ft(m)});Ht(()=>{var m=w(v),r=m.length;if(x&&r===0)return;x=r===0;let T=!1;if(se){var A=c.data===Kt;A!==(r===0)&&(c=bt(),tt(c),it(!1),T=!0)}if(se){for(var M=null,L,R=0;R<r;R++){if(Ye.nodeType===8&&Ye.data===Qt){c=Ye,T=!0,it(!1);break}var k=m[R],E=s(k,R);L=Nt(Ye,d,M,null,k,E,R,a,e,t),d.items.set(E,L),M=L}r>0&&tt(bt())}se||Si(m,d,c,a,e,s,t),l!==null&&(r===0?y?kt(y):y=Et(()=>l(c)):y!==null&&Zt(y,()=>{y=null})),T&&it(!0),w(v)}),se&&(c=Ye)}function Si(i,e,t,s,a,l,c){var O,ie,Q,Z;var d=(a&ci)!==0,f=(a&(gt|ht))!==0,I=i.length,y=e.items,x=e.first,v=x,m,r=null,T,A=[],M=[],L,R,k,E;if(d)for(E=0;E<I;E+=1)L=i[E],R=l(L,E),k=y.get(R),k!==void 0&&((O=k.a)==null||O.measure(),(T??(T=new Set)).add(k));for(E=0;E<I;E+=1){if(L=i[E],R=l(L,E),k=y.get(R),k===void 0){var W=v?v.e.nodes_start:t;r=Nt(W,e,r,r===null?e.first:r.next,L,R,E,s,a,c),y.set(R,r),A=[],M=[],v=r.next;continue}if(f&&Ti(k,L,E,a),k.e.f&st&&(kt(k.e),d&&((ie=k.a)==null||ie.unfix(),(T??(T=new Set)).delete(k))),k!==v){if(m!==void 0&&m.has(k)){if(A.length<M.length){var J=M[0],Y;r=J.prev;var U=A[0],K=A[A.length-1];for(Y=0;Y<A.length;Y+=1)zt(A[Y],J,t);for(Y=0;Y<M.length;Y+=1)m.delete(M[Y]);we(e,U.prev,K.next),we(e,r,U),we(e,K,J),v=J,r=K,E-=1,A=[],M=[]}else m.delete(k),zt(k,v,t),we(e,k.prev,k.next),we(e,k,r===null?e.first:r.next),we(e,r,k),r=k;continue}for(A=[],M=[];v!==null&&v.k!==R;)v.e.f&st||(m??(m=new Set)).add(v),M.push(v),v=v.next;if(v===null)continue;k=v}A.push(k),r=k,v=k.next}if(v!==null||m!==void 0){for(var F=m===void 0?[]:Ft(m);v!==null;)v.e.f&st||F.push(v),v=v.next;var C=F.length;if(C>0){var G=a&It&&I===0?t:null;if(d){for(E=0;E<C;E+=1)(Q=F[E].a)==null||Q.measure();for(E=0;E<C;E+=1)(Z=F[E].a)==null||Z.fix()}wi(e,F,G,y)}}d&&oi(()=>{var P;if(T!==void 0)for(k of T)(P=k.a)==null||P.apply()}),ot.first=e.first&&e.first.e,ot.last=r&&r.e}function Ti(i,e,t,s){s&gt&&St(i.v,e),s&ht?St(i.i,t):i.i=t}function Nt(i,e,t,s,a,l,c,d,f,I){var y=(f&gt)!==0,x=(f&ni)===0,v=y?x?ei(a):wt(a):a,m=f&ht?wt(c):c,r={i:m,v,k:l,a:null,e:null,prev:t,next:s};try{return r.e=Et(()=>d(i,v,m,I),se),r.e.prev=t&&t.e,r.e.next=s&&s.e,t===null?e.first=r:(t.next=r,t.e.next=r.e),s!==null&&(s.prev=r,s.e.prev=r.e),r}finally{}}function zt(i,e,t){for(var s=i.next?i.next.e.nodes_start:t,a=e?e.e.nodes_start:t,l=i.e.nodes_start;l!==s;){var c=ri(l);a.before(l),l=c}}function we(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Le(i){if(se){var e=!1,t=()=>{if(!e){if(e=!0,i.hasAttribute("value")){var s=i.value;He(i,"value",null),i.value=s}if(i.hasAttribute("checked")){var a=i.checked;He(i,"checked",null),i.checked=a}}};i.__on_r=t,ui(t),Lt()}}function He(i,e,t,s){var a=i.__attributes??(i.__attributes={});se&&(a[e]=i.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&i.nodeName==="LINK")||a[e]!==(a[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[di]=t),t==null?i.removeAttribute(e):typeof t!="string"&&zi(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var At=new Map;function zi(i){var e=At.get(i.nodeName);if(e)return e;At.set(i.nodeName,e=[]);for(var t,s=i,a=Element.prototype;a!==s;){t=vi(s);for(var l in t)t[l].set&&e.push(l);s=fi(s)}return e}function Ai(i,e,t){var s=i.__className,a=ki(e);se&&i.className===a?i.__className=a:(s!==a||se&&i.className!==a)&&(e==null?i.removeAttribute("class"):i.className=a,i.__className=a)}function ki(i,e){return(i??"")+""}function ft(i,e,t){if(t){if(i.classList.contains(e))return;i.classList.add(e)}else{if(!i.classList.contains(e))return;i.classList.remove(e)}}function Ei(i,e,t,s){var a=i.__styles??(i.__styles={});a[e]!==t&&(a[e]=t,t==null?i.style.removeProperty(e):i.style.setProperty(e,t,""))}function vt(i,e,t=e){var s=hi();$t(i,"input",a=>{var l=a?i.defaultValue:i.value;if(l=at(i)?lt(l):l,t(l),s&&l!==(l=e())){var c=i.selectionStart,d=i.selectionEnd;i.value=l??"",d!==null&&(i.selectionStart=c,i.selectionEnd=Math.min(d,i.value.length))}}),(se&&i.defaultValue!==i.value||Je(e)==null&&i.value)&&t(at(i)?lt(i.value):i.value),Ct(()=>{var a=e();at(i)&&a===lt(i.value)||i.type==="date"&&!a&&!i.value||a!==i.value&&(i.value=a??"")})}function Ke(i,e,t=e){$t(i,"change",s=>{var a=s?i.defaultChecked:i.checked;t(a)}),(se&&i.defaultChecked!==i.checked||Je(e)==null)&&t(i.checked),Ct(()=>{var s=e();i.checked=!!s})}function at(i){var e=i.type;return e==="number"||e==="range"}function lt(i){return i===""?null:+i}const ge=Mt([]),Fe=Mt();var Ae=(i=>(i[i.UNSET=0]="UNSET",i[i.SAME=1]="SAME",i[i.DIFFERENT=2]="DIFFERENT",i))(Ae||{}),B,Se,Ie,Xe,Ce,xe,Te,Be;const je=class je{constructor(e,t={},s=e){H(this,B);H(this,Se);H(this,Ie);H(this,Xe);H(this,Ce);H(this,xe,{x:0,y:0});H(this,Te,{x:0,y:0});H(this,Be);if(je.existingIDs.has(s))throw Error("A Tile Atlas with this ID already exists.");j(this,Ie,e),j(this,B,{startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16},...t}),j(this,Se,s),this.loadImg()}async loadImg(){if(o(this,Ce))return o(this,Ce);const e=document.createElement("img");return j(this,Ce,new Promise(t=>{e.addEventListener("load",()=>{j(this,xe,{x:e.naturalWidth,y:e.naturalHeight}),t()})})),e.src=o(this,Ie),j(this,Xe,e),o(this,Ce)}get img(){return o(this,Xe)}get src(){return o(this,Ie)}get id(){return o(this,Se)}get dimensions(){return structuredClone(o(this,xe))}get tileAmount(){return structuredClone(o(this,Te))}get settings(){return o(this,B)}set settings(e){j(this,B,e)}getTile(e){}getTilePosition(e){let t=typeof e=="number"?e:e.indexInAtlas;return{x:o(this,B).startOffset.x+(o(this,B).tileSize.x+o(this,B).tileGap.x)*(t%o(this,Te).x),y:o(this,B).startOffset.y+(this.settings.tileSize.y+this.settings.tileGap.y)*Math.floor(t/o(this,Te).x),w:o(this,B).tileSize.x,h:o(this,B).tileSize.y}}createTiles(){if(o(this,B).tileSize.x<1||o(this,B).tileSize.y<1)return[];let e=0,t=0;const s=[];let a=0,l=0;for(let c=o(this,B).startOffset.y;c<o(this,xe).y&&c+o(this,B).tileSize.y<=o(this,xe).y;c+=o(this,B).tileSize.y+o(this,B).tileGap.y){a=0;for(let d=o(this,B).startOffset.x;d<o(this,xe).x&&d+o(this,B).tileSize.x<=o(this,xe).x;d+=o(this,B).tileSize.x+o(this,B).tileGap.x)s.push({type:"basic",id:e++,atlasId:o(this,Se),indexInAtlas:t++,name:`${o(this,Se)}_${t}`}),a++;l++}return o(this,Te).x=a,o(this,Te).y=l,j(this,Be,[...s]),s}getTiles(){return o(this,Be)||this.createTiles(),o(this,Be)}serialize(){return{src:o(this,Ie),id:o(this,Se),settings:o(this,B)}}static deserialize(e){return new je(e.src,e.settings,e.id)}};B=new WeakMap,Se=new WeakMap,Ie=new WeakMap,Xe=new WeakMap,Ce=new WeakMap,xe=new WeakMap,Te=new WeakMap,Be=new WeakMap,ee(je,"existingIDs",new Set);let Qe=je;var Pe,De,ue;class Fi{constructor(e,t){H(this,Pe,[]);H(this,De,{x:20,y:20});H(this,ue,{x:64,y:64});this.mapSize=e,this.tileSize=t}get mapSize(){return o(this,De)}set mapSize(e){j(this,De,e)}get tileSize(){return o(this,ue)}set tileSize(e){j(this,ue,e)}setTile(e,t){o(this,Pe)[t.y]||(o(this,Pe)[t.y]=[]),o(this,Pe)[t.y][t.x]=e}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<o(this,De).y;t++)for(let s=0;s<o(this,De).x;s++){const a=this.getTile({x:s,y:t});if(!a)continue;const l={x:o(this,ue).x*s,y:o(this,ue).y*t};a.type==="basic"?X.drawTile(a,e,l,o(this,ue)):a.type==="rule"&&(X.drawTile(a.default,e,l,o(this,ue)),this.drawRuleOverlay(e,l,o(this,ue)))}}getTile(e){var t;return(t=o(this,Pe)[e.y])==null?void 0:t[e.x]}drawRuleOverlay(e,t,s){e.strokeStyle="white",e.fillStyle="black",e.font=`bold ${s.y*.8}px sans-serif`,e.strokeText("⚙",t.x+1,t.y+s.y-1,s.x),e.fillText("⚙",t.x+1,t.y+s.y-1,s.x)}}Pe=new WeakMap,De=new WeakMap,ue=new WeakMap;var de,fe,ve,_e,ze;const q=class q{constructor(e,t,s){H(this,ve);H(this,_e);H(this,ze);j(this,ve,e),j(this,_e,t),j(this,ze,s.map(a=>typeof a=="number"?q.getTile(a):a))}static recalculateTileIds(){let e=1;const t=new Map;for(let s of o(this,de).values())s.getTiles().forEach(l=>{l.id=e++,t.set(l.id,l)});for(let s of o(this,fe).values())if(s.type!=="basic"){if(s.type==="rule"&&!s.default&&s.rules.length===0)continue;s.id=t.size+1,t.set(s.id,s)}j(this,fe,t)}static exportSpecialTiles(){const e=[];for(let t of o(this,fe).values())t.type!=="basic"&&t.type==="rule"&&e.push({type:t.type,default:t.default.id,id:t.id,name:t.name,rules:t.rules.map(s=>{var a;return{neighborFilter:s.neighborFilter,tile:(a=s.tile)==null?void 0:a.id}})});return e}static addAtlas(e){o(this,de).set(e.id,e),this.recalculateTileIds()}static setAtlantes(e){o(this,de).clear();for(const t of e)o(this,de).set(t.id,t);this.recalculateTileIds()}static getAtlas(e){return o(this,de).get(e)}static getTile(e){return o(this,fe).get(e)}static addTile(e){o(this,fe).set(e.id,e)}static createTile(e,t=""){let s=o(this,fe).size||1;for(;o(this,fe).has(s);)s++;let a={type:e,default:void 0,id:s,name:t,rules:[]};return this.addTile(a),a}set tileSize(e){j(this,_e,e)}set mapSize(e){j(this,ve,e)}getTileToDrawFromRuleTile(e,t){e:for(let s of e.rules){const a=Math.sqrt(s.neighborFilter.length),l=Math.floor(a/2);for(let c=0;c<a;c++)for(let d=0;d<a;d++)if(!this.checkRule(s.neighborFilter[c*a+d],{x:t.x+d-l,y:t.y+c-l},e.id))continue e;return s.tile}return e.default}checkRule(e,t,s){if(e===0)return!0;const a=this.getTileAt(t.x,t.y);return!!(e===1&&a&&a.id===s||e===2&&(!a||a.id!==s))}render(e){e.imageSmoothingEnabled=!1;for(let t=0;t<o(this,ve).x;t++)for(let s=0;s<o(this,ve).y;s++){let a=this.getTileAt(t,s);a&&(a.type==="rule"&&(a=this.getTileToDrawFromRuleTile(a,{x:t,y:s})),q.drawTile(a,e,{x:o(this,_e).x*t,y:o(this,_e).y*s},o(this,_e)))}}getTileAt(e,t){return o(this,ze)[t*o(this,ve).x+e]}setTileAt(e,t,s){o(this,ze)[t*o(this,ve).x+e]=s}reset(){j(this,ze,[])}serialize(){q.recalculateTileIds();const e={};return e.map={mapSize:o(this,ve),tileSize:o(this,_e),tiles:o(this,ze).map(t=>t==null?void 0:t.id)},e.atlantes=[],o(q,de).values().forEach(t=>{e.atlantes.push(t.serialize())}),e.tiles=q.exportSpecialTiles(),e}static async deserialize(e){const t=e.atlantes.map(s=>Qe.deserialize(s));return await Promise.all(t.map(s=>s.loadImg())),q.setAtlantes(t),e.tiles.forEach(s=>{if(s.type==="rule"){const a={type:"rule",default:q.getTile(s.default),id:s.id,name:s.name,rules:s.rules.map(l=>({neighborFilter:l.neighborFilter,tile:q.getTile(l.tile)}))};q.addTile(a)}}),new q(e.map.mapSize,e.map.tileSize,e.map.tiles)}};de=new WeakMap,fe=new WeakMap,ve=new WeakMap,_e=new WeakMap,ze=new WeakMap,H(q,de,new Map),H(q,fe,new Map),ee(q,"drawBasicTile",(e,t,s,a)=>{const l=o(q,de).get(e.atlasId);if(!l){t.fillStyle="red",t.textAlign="center",t.font=`bold ${a.y*.8}px sans-serif`,t.fillText("!",s.x+.5*a.x,s.y+a.y*.8,a.x),console.error(`Atlas "${e.atlasId}" not found.`);return}let{x:c,y:d,w:f,h:I}=l.getTilePosition(e.indexInAtlas);t.drawImage(l.img,c,d,f,I,s.x,s.y,a.x,a.y)}),ee(q,"drawTile",(e,t,s,a)=>{e&&q.drawBasicTile(e,t,s,a)});let X=q;class yt extends EventTarget{constructor(t){super();ee(this,"canvas");ee(this,"ctx");ee(this,"translation",{x:0,y:0});ee(this,"scale",1);ee(this,"scaleSettings",{factor:2,min:1/16,max:16});ee(this,"syncedCtx",new Set);ee(this,"pointerdown",t=>{switch(t.button){}this.dispatchEventFromEvent(t),t.preventDefault()});ee(this,"pointermove",t=>{t.preventDefault();const s=this.getButtonsFromEvent(t);s.includes(0),s.includes(1),s.includes(2)&&(this.translation.x+=t.movementX,this.translation.y+=t.movementY,this.draw()),this.dispatchEventFromEvent(t)});ee(this,"pointerup",t=>{switch(this.dispatchEventFromEvent(t),t.button){}t.preventDefault()});ee(this,"zoom",t=>{t.preventDefault();const s=this.canvasPosFromMousePos({x:t.clientX,y:t.clientY},!1),a=-Math.sign(t.deltaY),l=this.scale,c=Math.min(this.scaleSettings.max,Math.max(this.scaleSettings.min,this.scale*Math.pow(this.scaleSettings.factor,a))),d=c/l;this.translation.x=s.x+(this.translation.x-s.x)*d,this.translation.y=s.y+(this.translation.y-s.y)*d,this.scale=c,this.draw()});this.canvas=t,this.ctx=t.getContext("2d"),this.installListeners();const s=t.getBoundingClientRect();t.width=s.width,t.height=s.height,this.syncedCtx.add(this.ctx)}installListeners(){this.canvas.addEventListener("pointerdown",this.pointerdown),this.canvas.addEventListener("pointermove",this.pointermove),this.canvas.addEventListener("pointerup",this.pointerup),this.canvas.addEventListener("wheel",this.zoom),this.canvas.addEventListener("contextmenu",t=>t.preventDefault())}getButtonsFromEvent(t){const s=[];for(let a=0;a<5;a++)t.buttons&1<<a&&s.push(a);return s}dispatchEventFromEvent(t){const s=this.canvasPosFromMousePos({x:t.clientX,y:t.clientY},!0);this.dispatchEvent(new CustomEvent(t.type,{detail:{pos:s,event:t}}))}canvasPosFromMousePos(t,s){const a=this.canvas.getBoundingClientRect(),l={x:t.x-a.left,y:t.y-a.top};return s&&(l.x=(l.x-this.translation.x)/this.scale,l.y=(l.y-this.translation.y)/this.scale),l}draw(){for(let t of this.syncedCtx.values())t.clearRect(0,0,t.canvas.width,t.canvas.height),t.reset(),t.translate(this.translation.x,this.translation.y),t.scale(this.scale,this.scale);this.dispatchEvent(new CustomEvent("draw"))}reset(){this.scale=1,this.translation.x=0,this.translation.y=0,this.draw()}addCtxToSync(t){this.syncedCtx.add(t)}}var Ii=ye('<fieldset class="svelte-mlfuo7"><legend> </legend> <label>width <input type="number" min="0" class="svelte-mlfuo7"></label> <label>height <input type="number" min="0" class="svelte-mlfuo7"></label></fieldset>');function Me(i,e){$e(e,!0);let t=Re(e,"vector",31,()=>V({x:0,y:0}));var s=Ii(),a=z(s),l=z(a,!0);S(a);var c=g(a,2),d=g(z(c));Le(d),d.__change=function(...y){var x;(x=e.change)==null||x.apply(this,y)},S(c);var f=g(c,2),I=g(z(f));Le(I),I.__change=function(...y){var x;(x=e.change)==null||x.apply(this,y)},S(f),S(s),Ge(()=>ut(l,e.legend)),vt(d,()=>t().x,y=>t(t().x=y,!0)),vt(I,()=>t().y,y=>t(t().y=y,!0)),he(i,s),Ne()}Ve(["change"]);function Ot(i,e){const t={lineWidth:1,style:"rgba(0, 0, 0, 1)",tileAmount:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:0,y:0},...e};i.strokeStyle=t.style,i.lineWidth=t.lineWidth;const s=new Path2D;for(let a=0;a<t.tileAmount.y;a++)for(let l=0;l<t.tileAmount.x;l++)s.moveTo(l*t.tileSize.x,a*t.tileSize.y+t.tileSize.y),s.lineTo(l*t.tileSize.x,a*t.tileSize.y),s.lineTo(l*t.tileSize.x+t.tileSize.x,a*t.tileSize.y);s.moveTo(0,t.tileAmount.y*t.tileSize.y),s.lineTo(t.tileAmount.x*t.tileSize.x,t.tileAmount.y*t.tileSize.y),s.lineTo(t.tileAmount.x*t.tileSize.x,0),i.stroke(s)}function Ue(i,e){i.width=e.clientWidth,i.height=e.clientHeight}var Ci=(i,e,t)=>{e.remove(t())},Pi=ye('<fieldset class="atlas-display svelte-kpjacb"><img class="img-preview svelte-kpjacb" alt=""> <div class="canvas-wrapper svelte-kpjacb"><canvas></canvas> <canvas class="canvas-overlay svelte-kpjacb"></canvas></div> <div class="settings-wrapper svelte-kpjacb"><!> <!> <!> <fieldset class="svelte-kpjacb"><legend>Display Settings</legend> <label>show numbers <input type="checkbox"></label> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset> <fieldset class="svelte-kpjacb"><legend>Danger Zone</legend> <button>Remove</button></fieldset></div></fieldset>');function Di(i,e){$e(e,!0);const[t,s]=We(),a=()=>qe(ge,"$selectedTilesAtlas",t);let l=Re(e,"atlas",15),c,d,f,I,y,x,v,m=[],r=new Set,T,A=ae(!1),M=ae(!0);Ze(()=>{I.addEventListener("click",()=>{e.active||(e.activate(l()),L())}),v=new yt(f),v.addEventListener("draw",R),v.addEventListener("pointermove",k),v.addEventListener("pointerup",W),f.addEventListener("pointerleave",E),y=f.getContext("2d"),x=d.getContext("2d"),v.addCtxToSync(x),K(),v.draw()});function L(){if(r.size==0)return me(ge,[]),v.draw();const b=l().tileAmount,u={x:1/0,y:1/0},h={x:-1/0,y:-1/0};r.forEach(_=>{const $={x:_.indexInAtlas%b.x,y:Math.floor(_.indexInAtlas/b.x)};u.x>$.x&&(u.x=$.x),u.y>$.y&&(u.y=$.y),h.x<$.x&&(h.x=$.x),h.y<$.y&&(h.y=$.y)}),me(ge,Array.from({length:h.y-u.y+1},()=>[])),r.forEach(_=>{const $={x:_.indexInAtlas%b.x-u.x,y:Math.floor(_.indexInAtlas/b.x)-u.y};xi(ge,Je(a)[$.y][$.x]=_,Je(a))}),v.draw()}function R(){x.imageSmoothingEnabled=!1,x.drawImage(l().img,0,0),x.lineWidth=1,x.strokeStyle="rgba(0, 0, 0, 0.5)",x.textAlign="right",m=l().getTiles();for(let b of m){let{x:u,y:h,w:_,h:$}=l().getTilePosition(b);w(M)&&x.strokeRect(u,h,_,$),w(A)&&x.fillText(b.id.toString(),u+_-1,h+$-1,_)}J()}function k(b){const u=Y(b.detail.pos.x,b.detail.pos.y);if(!u)return E();T=u,v.draw()}function E(){T=void 0,v.draw()}function W(b){if(b.detail.event.button!==0)return;const u=Y(b.detail.pos.x,b.detail.pos.y);if(!u)return r.clear(),L();b.detail.event.ctrlKey?r.has(u)?r.delete(u):r.add(u):r.has(u)&&r.size===1?r.clear():(r.clear(),r.add(u)),L()}function J(){if(T){y.fillStyle="rgba(255, 255, 255, 0.5)";let{x:b,y:u,w:h,h:_}=l().getTilePosition(T);y.fillRect(b,u,h,_)}for(let b of r.values()){y.strokeStyle="rgba(255, 0, 0, 1)",y.fillStyle="rgba(255, 0, 0, 0.25)",y.lineWidth=1;let{x:u,y:h,w:_,h:$}=l().getTilePosition(b);y.fillRect(u,h,_,$),y.strokeRect(u,h,_,$)}}function Y(b,u){for(let h of m){let{x:_,y:$,w:et,h:Vt}=l().getTilePosition(h);if(b>_&&b<_+et&&u>$&&u<$+Vt)return h}}function U(){l().createTiles(),v.draw()}function K(){Ue(d,c),Ue(f,c)}function F(){K(),v.reset()}var C=Pi(),G=z(C),O=g(G,2),ie=z(O);le(ie,b=>d=b,()=>d);var Q=g(ie,2);le(Q,b=>f=b,()=>f),S(O),le(O,b=>c=b,()=>c);var Z=g(O,2),P=z(Z);Me(P,{legend:"Tile Size",change:U,get vector(){return l().settings.tileSize},set vector(b){l(l().settings.tileSize=b,!0)}});var N=g(P,2);Me(N,{legend:"Tile Gap",change:U,get vector(){return l().settings.tileGap},set vector(b){l(l().settings.tileGap=b,!0)}});var ne=g(N,2);Me(ne,{legend:"Offset",change:U,get vector(){return l().settings.startOffset},set vector(b){l(l().settings.startOffset=b,!0)}});var re=g(ne,2),pe=g(z(re),2),oe=g(z(pe));Le(oe),S(pe);var ce=g(pe,2),ke=g(z(ce));Le(ke),S(ce);var Oe=g(ce,2);Oe.__click=F,S(re);var be=g(re,2),Ee=g(z(be),2);Ee.__click=[Ci,e,l],S(be),S(Z),S(C),le(C,b=>I=b,()=>I),Ge(()=>{ft(C,"active",e.active),He(G,"src",l().src)}),Ke(oe,()=>w(A),b=>te(A,b)),Ke(ke,()=>w(M),b=>te(M,b)),he(i,C),Ne(),s()}Ve(["click"]);var Mi=ye('<input type="file" name="import" id="import" accept="image/png" multiple> <div id="atlantes-wrapper"></div>',1);function Ri(i,e){$e(e,!0);const[t,s]=We();let a,l=Re(e,"atlantes",27,()=>V([])),c=Re(e,"activeAtlas",15);async function d(r){if(a.files)for(let T of a.files){let A=await f(T),M=V({startOffset:{x:0,y:0},tileGap:{x:0,y:0},tileSize:{x:16,y:16}});const L=new Qe(A,M,T.name);await L.loadImg(),l().push(L),c(L)}}async function f(r){return new Promise(T=>{const A=new FileReader;A.onload=()=>T(A.result),A.readAsDataURL(r)})}function I(r){c(r)}function y(r){r==c()&&me(ge,[]);let T=l().indexOf(r);if(!(T<0)){for(l().splice(T,1);T>=l().length;)T--;T<0||c(l()[T])}}var x=Mi(),v=Pt(x);v.__change=d,le(v,r=>a=r,()=>a);var m=g(v,2);dt(m,20,l,r=>r,(r,T)=>{const A=gi(()=>c()==T);Di(r,{get atlas(){return T},activate:I,remove:y,get active(){return w(A)}})}),S(m),he(i,x),Ne(),s()}Ve(["change"]);function Li(i,e){const t=V({neighborFilter:Array(9).fill(Ae.UNSET)});e().rules.push(t)}var $i=(i,e)=>{e()},Ni=(i,e,t)=>{e(t,-1)},Oi=(i,e,t)=>{e(t,1)},Gi=(i,e,t)=>{e(t)},Bi=ye("<button></button>"),Vi=ye('<div class="tile-rule svelte-1lu0swp"><div class="tile-rule-order svelte-1lu0swp"><button>^</button> <button>v</button></div> <div class="tile-rule-data"><div class="tile-rule-image svelte-1lu0swp"></div> <button>set tile</button></div> <div class="tile-neighbors svelte-1lu0swp"></div></div>'),Wi=ye('<button>set tile</button> <div class="tile-rules svelte-1lu0swp">Rules <!></div> <button>Add Rule</button>',1),Yi=ye('<div class="tile-info svelte-1lu0swp"><div class="tile-base-info svelte-1lu0swp"><span class="tile-id svelte-1lu0swp"> </span> <span class="tile-type svelte-1lu0swp"> </span> <span class="tile-name svelte-1lu0swp">name: <input type="text"></span> <div class="tile-preview svelte-1lu0swp"><canvas width="64" height="64"></canvas></div></div> <!></div>');function ji(i,e){$e(e,!0);const[t,s]=We(),a=()=>qe(ge,"$selectedTilesAtlas",t);let l=Re(e,"tile",15),c,d;Ze(()=>{d=c.getContext("2d"),d.imageSmoothingEnabled=!1,d.clearRect(0,0,c.width,c.height)}),ct(()=>{l().type==="basic"?f(X.drawTile,l()):l().type==="rule"&&f(X.drawTile,l().default)});function f(F,C){d.clearRect(0,0,c.width,c.height);const G={x:0,y:0},O={x:c.width,y:c.height};F(C,d,G,O)}function I(F){return F===Ae.SAME?"same":F===Ae.DIFFERENT?"different":"none"}function y(F,C){F[C]=(F[C]+1)%Object.keys(Ae).filter(G=>isNaN(Number(G))).length}function x(F,C){if(l().type!=="rule")return;let G=l().rules.indexOf(F);G<0||l().rules.splice(G+C,0,...l().rules.splice(G,1))}function v(F){if(!F)return"";let C=X.getAtlas(F.atlasId);if(!C)return"";let G=C.getTilePosition(F.indexInAtlas),O={x:50/C.settings.tileSize.x,y:50/C.settings.tileSize.y};return`background-image: url(${C.src}); background-position: -${G.x*O.x}px -${G.y*O.y}px; background-size: ${C.dimensions.x*O.x}px ${C.dimensions.y*O.y}px`}function m(F){if(a().length<=0)return;let C=a()[0][0];C&&(F.tile=C)}function r(){if(l().type!=="rule"||a().length<=0)return;let F=a()[0][0];F&&(l(l().default=F,!0),f(X.drawTile,l().default))}var T=Yi(),A=z(T),M=z(A),L=z(M);S(M);var R=g(M,2),k=z(R);S(R);var E=g(R,2),W=g(z(E));Le(W),S(E);var J=g(E,2),Y=z(J);le(Y,F=>c=F,()=>c),S(J),S(A);var U=g(A,2);{var K=F=>{var C=Wi(),G=Pt(C);G.__click=[$i,r];var O=g(G,2),ie=g(z(O));dt(ie,18,()=>l().rules,Z=>Z,(Z,P,N)=>{var ne=Vi(),re=z(ne),pe=z(re);pe.__click=[Ni,x,P];var oe=g(pe,2);oe.__click=[Oi,x,P],S(re);var ce=g(re,2),ke=z(ce),Oe=g(ke,2);Oe.__click=[Gi,m,P],S(ce);var be=g(ce,2);dt(be,21,()=>P.neighborFilter,bi,(Ee,b,u,h)=>{var _=Bi();_.__click=()=>y(P.neighborFilter,u),He(_,"aria-label",`change neighbor rule ${u??""}`),Ge(($,et)=>{Ai(_,`tile-rule-button ${$??""} svelte-1lu0swp`),_.disabled=et,Ei(_,"grid-area","b"+u)},[()=>I(w(b)),()=>u===Math.floor(P.neighborFilter.length/2)]),he(Ee,_)}),S(be),S(ne),Ge(Ee=>{pe.disabled=w(N)===0,oe.disabled=w(N)===l().rules.length-1,He(ke,"style",Ee)},[()=>v(P.tile)]),he(Z,ne)}),S(O);var Q=g(O,2);Q.__click=[Li,l],he(F,C)};Dt(U,F=>{l().type==="rule"&&F(K)})}S(T),Ge(()=>{ut(L,`id: ${l().id??""}`),ut(k,`type: ${l().type??""}`)}),vt(W,()=>l().name,F=>l(l().name=F,!0)),he(i,T),Ne(),s()}Ve(["click"]);const n=Ae.UNSET,p=Ae.SAME,D=Ae.DIFFERENT;function qi(){const i=Rt(ge);if(nt(20)){let e=X.createTile("rule");e.default=i[1][1];let t=V(Hi(i));return e.rules=t,e}else if(nt(16)){let e=X.createTile("rule");e.default=i[1][1];let t=V(Bt(i));return e.rules=t,e}else if(nt(9)){let e=X.createTile("rule");e.default=i[1][1];let t=V(Gt(i));return e.rules=t,e}}function nt(i){const e=Rt(ge);switch(i){case 9:return e.length!==3||e[0].length!==3?!1:rt(e,{start:{x:0,y:0},size:{x:3,y:3}});case 16:return e.length!==4||e[0].length!==4?!1:rt(e,{start:{x:0,y:0},size:{x:4,y:4}});case 20:return e.length!==4||e[0].length!==6?!1:rt(e,{start:{x:0,y:0},size:{x:4,y:4}},{start:{x:4,y:0},size:{x:2,y:2}})}return!1}function rt(i,...e){for(let t of e)for(let s=t.start.y;s<t.start.y+t.size.y;s++)for(let a=t.start.x;a<t.start.x+t.size.x;a++)if(!i[s]||!i[s][a])return!1;return!0}function Gt(i){return[{tile:i[0][0],neighborFilter:[n,D,n,D,n,p,n,p,n]},{tile:i[0][1],neighborFilter:[n,D,n,p,n,p,n,p,n]},{tile:i[0][2],neighborFilter:[n,D,n,p,n,D,n,p,n]},{tile:i[1][0],neighborFilter:[n,p,n,D,n,p,n,p,n]},{tile:i[1][1],neighborFilter:[n,p,n,p,n,p,n,p,n]},{tile:i[1][2],neighborFilter:[n,p,n,p,n,D,n,p,n]},{tile:i[2][0],neighborFilter:[n,p,n,D,n,p,n,D,n]},{tile:i[2][1],neighborFilter:[n,p,n,p,n,p,n,D,n]},{tile:i[2][2],neighborFilter:[n,p,n,p,n,D,n,D,n]}]}function Bt(i){return[{tile:i[3][3],neighborFilter:[n,D,n,D,n,D,n,D,n]},{tile:i[0][3],neighborFilter:[n,D,n,D,n,D,n,p,n]},{tile:i[1][3],neighborFilter:[n,p,n,D,n,D,n,p,n]},{tile:i[2][3],neighborFilter:[n,p,n,D,n,D,n,D,n]},{tile:i[3][0],neighborFilter:[n,D,n,D,n,p,n,D,n]},{tile:i[3][1],neighborFilter:[n,D,n,p,n,p,n,D,n]},{tile:i[3][2],neighborFilter:[n,D,n,p,n,D,n,D,n]},...Gt(i)]}function Hi(i){return[{tile:i[0][4],neighborFilter:[n,p,n,p,n,p,n,p,D]},{tile:i[0][5],neighborFilter:[n,p,n,p,n,p,D,p,n]},{tile:i[1][4],neighborFilter:[n,p,D,p,n,p,n,p,n]},{tile:i[1][5],neighborFilter:[D,p,n,p,n,p,n,p,n]},...Bt(i)]}var Ui=ye('<div id="sheet-wrapper" class="svelte-14bijwv"><fieldset class="svelte-14bijwv"><!> <!> <fieldset class="svelte-14bijwv"><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button></fieldset></fieldset> <div id="sheet-canvas-wrapper" class="svelte-14bijwv"><canvas id="sheet-canvas" class="svelte-14bijwv"></canvas> <canvas id="overlay-canvas" class="svelte-14bijwv"></canvas></div> <div id="tile-info-wrapper" class="svelte-14bijwv"><div id="tile-info" class="svelte-14bijwv"><!></div></div></div>');function Xi(i,e){$e(e,!0);const[t,s]=We(),a=()=>qe(Fe,"$selectedTileSheet",t),l=()=>qe(ge,"$selectedTilesAtlas",t);let c=ae(V({x:20,y:20})),d=ae(V({x:16,y:16})),f=Re(e,"sheet",27,()=>V(new Fi(w(c),w(d)))),I,y,x,v,m,r,T=ae(void 0),A=ae(!0),M=ae(V({x:0,y:0})),L=!1,R=!1;Ze(()=>{r=new yt(y),r.addEventListener("draw",K),r.addEventListener("pointerdown",k),r.addEventListener("pointermove",E),r.addEventListener("pointerup",W),v=y.getContext("2d"),C(),m=x.getContext("2d"),r.addCtxToSync(m),K()});function k(u){if(u.detail.event.button===0)L=!0;else if(u.detail.event.button===2){R=!0;const h=U(u.detail.pos);h&&f().setTile(void 0,h)}}function E(u){if(te(M,V(u.detail.pos)),R){const h=U(u.detail.pos);h&&f().setTile(void 0,h)}L&&J(u),r.draw()}function W(u){u.detail.event.button===0?(L=!1,J(u)):u.detail.event.button===2&&(R=!1),r.draw()}function J(u){const h=U(w(M));if(!h){me(Fe,void 0);return}if(l().length>0)if(u.detail.event.shiftKey){const _=qi();if(!_)return;f().setTile(_,h),me(Fe,_)}else Y(h);else{let _=f().getTile(h);if(_)me(Fe,_);else{let $=V(X.createTile("rule"));f().setTile($,h),me(Fe,$)}te(T,V(h))}}function Y(u){for(let h=0;h<l().length;h++)for(let _=0;_<l()[h].length;_++)l()[h][_]&&(u.x+_>=f().mapSize.x||u.y+h>=f().mapSize.y||f().setTile(l()[h][_],{x:u.x+_,y:u.y+h}))}function U(u){const h={x:Math.floor(u.x/w(d).x),y:Math.floor(u.y/w(d).y)};if(!(h.x<0||h.y<0)&&!(h.x>=f().mapSize.x||h.y>=f().mapSize.y))return h}function K(){f().render(v),w(A)&&Ot(v,{tileSize:w(d),tileAmount:w(c)}),F()}function F(){const u=U(w(M));if(u){m.imageSmoothingEnabled=!1;for(let h=0;h<l().length;h++)for(let _=0;_<l()[h].length;_++){if(u.x+_>=f().mapSize.x||u.y+h>=f().mapSize.y)continue;const $={x:(u.x+_)*f().tileSize.x,y:(u.y+h)*f().tileSize.y};X.drawTile(l()[h][_],m,$,w(d))}}a()&&w(T)&&(m.fillStyle="rgba(255, 0, 0, 0.5)",m.fillRect(w(T).x*f().tileSize.x,w(T).y*f().tileSize.y,f().tileSize.x,f().tileSize.y))}function C(){Ue(x,I),Ue(y,I)}function G(){C(),r.reset()}function O(){r.draw()}var ie=Ui(),Q=z(ie),Z=z(Q);Me(Z,{legend:"Tile Size",change:O,get vector(){return w(d)},set vector(u){te(d,V(u))}});var P=g(Z,2);Me(P,{legend:"Sheet Size",change:O,get vector(){return w(c)},set vector(u){te(c,V(u))}});var N=g(P,2),ne=g(z(N),2),re=g(z(ne));Le(re),S(ne);var pe=g(ne,2);pe.__click=G,S(N),S(Q);var oe=g(Q,2),ce=z(oe);le(ce,u=>y=u,()=>y);var ke=g(ce,2);le(ke,u=>x=u,()=>x),S(oe),le(oe,u=>I=u,()=>I);var Oe=g(oe,2),be=z(Oe),Ee=z(be);{var b=u=>{ji(u,{get tile(){return _i(),a()},set tile(h){me(Fe,h)}})};Dt(Ee,u=>{a()&&u(b)})}S(be),S(Oe),S(ie),Ke(re,()=>w(A),u=>te(A,u)),he(i,ie),Ne(),s()}Ve(["click"]);async function Ji(i,e){const t=JSON.stringify(e().serialize());await navigator.clipboard.writeText(t)}var Ki=ye('<div id="map-display" class="svelte-1tr63jx"><div class="map-display-settings"><!> <!> <fieldset><legend>Display Settings</legend> <label>show lines <input type="checkbox"></label> <button>reset view</button> <button>reset map</button> <button>export map</button> <button>import map</button></fieldset></div> <div id="map-display-canvas-wrapper" class="svelte-1tr63jx"><canvas></canvas></div></div>');function Qi(i,e){$e(e,!0);const[t,s]=We(),a=()=>qe(Fe,"$selectedTileSheet",t);let l=Re(e,"map",7),c=ae(V({x:20,y:20})),d=ae(V({x:16,y:16})),f,I,y,x,v=ae(!0);Ze(()=>{x=new yt(f),x.addEventListener("draw",T),x.addEventListener("pointerup",m),y=f.getContext("2d"),M(),A()});function m(P){if(P.detail.event.button===0){if(!a())return;const N=r(P.detail.pos);if(!N)return;l().setTileAt(N.x,N.y,a())}else if(P.detail.event.button===2){const N=r(P.detail.pos);if(!N)return;l().setTileAt(N.x,N.y,void 0)}x.draw()}function r(P){const N={x:Math.floor(P.x/w(d).x),y:Math.floor(P.y/w(d).y)};if(!(N.x<0||N.y<0)&&!(N.x>=w(c).x||N.y>=w(c).y))return N}function T(){l().render(y),w(v)&&Ot(y,{tileAmount:w(c),tileSize:w(d)})}function A(){l().tileSize=w(d),l().mapSize=w(c),x.draw()}function M(){Ue(f,I)}function L(){M(),x.reset()}function R(){l().reset(),x.draw()}async function k(){let P=await navigator.clipboard.readText(),N=await X.deserialize(JSON.parse(P));console.log(N),l(N),x.draw()}var E=Ki(),W=z(E),J=z(W);Me(J,{legend:"Tile Size",change:A,get vector(){return w(d)},set vector(P){te(d,V(P))}});var Y=g(J,2);Me(Y,{legend:"Map Size",change:A,get vector(){return w(c)},set vector(P){te(c,V(P))}});var U=g(Y,2),K=g(z(U),2),F=g(z(K));Le(F),S(K);var C=g(K,2);C.__click=L;var G=g(C,2);G.__click=R;var O=g(G,2);O.__click=[Ji,l];var ie=g(O,2);ie.__click=k,S(U),S(W);var Q=g(W,2),Z=z(Q);le(Z,P=>f=P,()=>f),S(Q),le(Q,P=>I=P,()=>I),S(E),Ke(F,()=>w(v),P=>te(v,P)),he(i,E),Ne(),s()}Ve(["click"]);var Zi=ye('<div id="outer-wrapper" class="svelte-6c91tk"><h1 class="svelte-6c91tk"><a href="https://github.com/hs-furtwangen/FUDGE" target="_blank" rel="noopener noreferrer">FUDGE</a> Tilemap Editor</h1> <div class="tabs svelte-6c91tk"><div class="tab svelte-6c91tk" id="tab-atlas"><h2 class="svelte-6c91tk">Tile Atlas</h2> <div class="tab-content svelte-6c91tk"><!></div></div> <div class="tab shown svelte-6c91tk" id="tab-sheet"><h2 class="svelte-6c91tk">Tile Sheet</h2> <div class="tab-content svelte-6c91tk"><!></div></div> <div class="tab svelte-6c91tk" id="tab-map"><h2 class="svelte-6c91tk">Tile Map</h2> <div class="tab-content svelte-6c91tk"><!></div></div></div></div>');function ns(i,e){$e(e,!0);const[t,s]=We();let a=ae(V([])),l,c=ae(!0),d,f=ae(void 0),I;ct(()=>{l.addEventListener("pointerup",()=>{te(c,!0)}),d.addEventListener("pointerup",()=>{te(c,!1),me(ge,[])})});let y=new X({x:5,y:5},{x:64,y:64},[]);ct(()=>{X.setAtlantes(w(a))});var x=Zi();pi(W=>{yi.title="FUDGE Tilemap Editor"});var v=g(z(x),2),m=z(v),r=g(z(m),2),T=z(r);Ri(T,{get atlantes(){return w(a)},set atlantes(W){te(a,V(W))},get activeAtlas(){return w(f)},set activeAtlas(W){te(f,V(W))}}),S(r),S(m),le(m,W=>l=W,()=>l);var A=g(m,2),M=g(z(A),2),L=z(M);Xi(L,{get sheet(){return I}}),S(M),S(A);var R=g(A,2),k=g(z(R),2),E=z(k);Qi(E,{map:y}),S(k),S(R),le(R,W=>d=W,()=>d),S(v),S(x),Ge(()=>{ft(m,"shown",w(c)),ft(R,"shown",!w(c))}),he(i,x),Ne(),s()}export{ns as component};
